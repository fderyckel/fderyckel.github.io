<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>QUANT dira-t-on?</title>
<link>https://fderyckel.github.io/blog.html/blog.html</link>
<atom:link href="https://fderyckel.github.io/blog.html/blog.xml" rel="self" type="application/rss+xml"/>
<description>Curating notes from a Quant learning journey.</description>
<generator>quarto-1.3.450</generator>
<lastBuildDate>Mon, 15 Apr 2024 17:00:00 GMT</lastBuildDate>
<item>
  <title>Defining Success</title>
  <dc:creator>Francois de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/machine-learning-part1/metrics/index.html</link>
  <description><![CDATA[ 




<p>When evaluating models for a given ML algorithm, we need to define in advance what would be our metric to measure success.</p>
<p>There are so many ways out there to measure which hyper-parameters performed best for our mode. We’ll bring up some of the most used one.</p>
<section id="setting-up-a-model" class="level1">
<h1>Setting up a model</h1>
</section>
<section id="the-metrics" class="level1">
<h1>The metrics</h1>
<section id="accuracy" class="level2">
<h2 class="anchored" data-anchor-id="accuracy">Accuracy</h2>
<p>Shortcomings:</p>
<ul>
<li>for imbalanced dataset, we can have good accuracy by just predicting most observation with the most frequent class. For instance in the case of a rare disease or big financial meltdown, we can just predict</li>
</ul>
</section>
<section id="precision" class="level2">
<h2 class="anchored" data-anchor-id="precision">Precision</h2>
<p>If you call it true, is it indeed true? In other words, the proportion of predicted positive that are actually positive.</p>
</section>
<section id="recall" class="level2">
<h2 class="anchored" data-anchor-id="recall">Recall</h2>
<p>If there is a positive, did the model predict a positive.</p>
</section>
<section id="f1-score" class="level2">
<h2 class="anchored" data-anchor-id="f1-score">F1 score</h2>
<p>It is the <strong>harmonic mean</strong> of both precision and recall. The harmonic mean penalizes model that have very low precision or recall. Which wouldn’t be the case with arithmetic mean.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B2%20%5Ccdot%20Precision%20%5Ccdot%20Recall%7D%7BPrecision%20+%20Recall%7D"></p>


</section>
</section>

 ]]></description>
  <category>sklearn</category>
  <category>tidymodel</category>
  <guid>https://fderyckel.github.io/blog.html/posts/machine-learning-part1/metrics/index.html</guid>
  <pubDate>Mon, 15 Apr 2024 17:00:00 GMT</pubDate>
</item>
<item>
  <title>Xgboost</title>
  <dc:creator>Francois de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/machine-learning-part2/xgboost/index.html</link>
  <description><![CDATA[ 




<p>Using Xgboost from a quant perspective. We do a whole cycle of model building on a financial time-series. We’ll again show how to do it with both framework <em>Sklearn</em> for Python and <em>tidymodel</em> for R.</p>
<p>We have taken a stock, but this can be applied on an index, or commodity futures, etc.</p>
<section id="setting-up-the-data-frame" class="level1">
<h1>Setting up the data frame</h1>
<p>We are just loading the data set and doing the initial cleaning so the features engineering can be achieved smoothly.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true">Python</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false">R</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-hash="index_cache/html/py_setting_up_5e3c8b246daa56a3aaec0117b59459b5">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt </span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-4"></span>
<span id="cb1-5">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'../../../raw_data/AA.csv'</span>)</span>
<span id="cb1-6">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'date'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'date'</span>])</span>
<span id="cb1-7">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.sort_values(by <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'date'</span>, inplace <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb1-8">df.set_index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'date'</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-9"></span>
<span id="cb1-10">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'open'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'high'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'low'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'volume'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'adjClose'</span>]]</span>
<span id="cb1-11"></span>
<span id="cb1-12">df.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             open   high    low  close   volume  adjClose
date                                                     
2001-01-02  80.50  80.95  76.60  77.50  1592010     57.23
2001-01-03  77.50  80.50  75.24  78.55  2011985     58.01
2001-01-04  78.55  81.25  77.65  81.10  1992468     59.89
2001-01-05  81.10  81.70  78.85  79.60  1623845     58.78
2001-01-08  79.60  85.91  79.00  80.80  3073616     59.67</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">df.describe()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              open         high  ...        volume     adjClose
count  5821.000000  5821.000000  ...  5.821000e+03  5821.000000
mean     46.372343    47.097133  ...  6.519558e+06    40.404558
std      24.755757    25.075361  ...  5.452542e+06    18.945874
min       5.500000     5.950000  ...  4.254680e+05     5.360000
25%      24.990000    25.420000  ...  2.656970e+06    23.620000
50%      38.260000    38.780000  ...  5.129900e+06    36.270000
75%      69.210000    69.980000  ...  8.773242e+06    56.910000
max     115.010000   117.190000  ...  1.007518e+08    96.360000

[8 rows x 6 columns]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">df.isnull().<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>open        0
high        0
low         0
close       0
volume      0
adjClose    0
dtype: int64</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-hash="index_cache/html/r_setting_up_762b7e82dae93f30220a6b4f78c7075c">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readr)</span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb7-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(skimr)</span>
<span id="cb7-4"></span>
<span id="cb7-5">dfr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'../../../raw_data/AA.csv'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(date, open, high, low, close, volume, adjClose)</span>
<span id="cb7-7"></span>
<span id="cb7-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">skim</span>(dfr)</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">dfr</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">5821</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Date</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: Date</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">min</th>
<th style="text-align: left;">max</th>
<th style="text-align: left;">median</th>
<th style="text-align: right;">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">date</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2001-01-02</td>
<td style="text-align: left;">2024-02-22</td>
<td style="text-align: left;">2012-07-27</td>
<td style="text-align: right;">5821</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">open</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">46.37</td>
<td style="text-align: right;">24.76</td>
<td style="text-align: right;">5.50</td>
<td style="text-align: right;">24.99</td>
<td style="text-align: right;">38.26</td>
<td style="text-align: right;">69.21</td>
<td style="text-align: right;">115.01</td>
<td style="text-align: left;">▇▇▃▅▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">high</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">47.10</td>
<td style="text-align: right;">25.08</td>
<td style="text-align: right;">5.95</td>
<td style="text-align: right;">25.42</td>
<td style="text-align: right;">38.78</td>
<td style="text-align: right;">69.98</td>
<td style="text-align: right;">117.19</td>
<td style="text-align: left;">▇▇▃▅▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">low</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">45.57</td>
<td style="text-align: right;">24.38</td>
<td style="text-align: right;">5.16</td>
<td style="text-align: right;">24.53</td>
<td style="text-align: right;">37.72</td>
<td style="text-align: right;">68.03</td>
<td style="text-align: right;">111.88</td>
<td style="text-align: left;">▇▇▃▅▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">close</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">46.33</td>
<td style="text-align: right;">24.74</td>
<td style="text-align: right;">5.48</td>
<td style="text-align: right;">25.01</td>
<td style="text-align: right;">38.26</td>
<td style="text-align: right;">69.04</td>
<td style="text-align: right;">113.78</td>
<td style="text-align: left;">▇▇▃▅▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">volume</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6519558.18</td>
<td style="text-align: right;">5452542.48</td>
<td style="text-align: right;">425468.00</td>
<td style="text-align: right;">2656970.00</td>
<td style="text-align: right;">5129900.00</td>
<td style="text-align: right;">8773242.00</td>
<td style="text-align: right;">100751769.00</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">adjClose</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">40.40</td>
<td style="text-align: right;">18.95</td>
<td style="text-align: right;">5.36</td>
<td style="text-align: right;">23.62</td>
<td style="text-align: right;">36.27</td>
<td style="text-align: right;">56.91</td>
<td style="text-align: right;">96.36</td>
<td style="text-align: left;">▆▇▅▅▁</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="feature-engineering" class="level1">
<h1>Feature engineering</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" aria-controls="tabset-2-1" aria-selected="true">Python</a></li><li class="nav-item"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" aria-controls="tabset-2-2" aria-selected="false">R</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" aria-labelledby="tabset-2-1-tab">
<div class="cell" data-hash="index_cache/html/unnamed-chunk-3_96f60ca94c4ccb24a60ae52669086b9d">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'returns'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.log(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'adjClose'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'adjClose'</span>].shift(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb8-2">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ret_1m'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'returns'</span>].rolling(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span>
<span id="cb8-3"></span>
<span id="cb8-4">feature_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb8-5"></span>
<span id="cb8-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> r <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">81</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>): </span>
<span id="cb8-7">  df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ret_'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(r)] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'returns'</span>].rolling(r).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span>
<span id="cb8-8">  df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'std_'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(r)] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'returns'</span>].rolling(r).std()</span>
<span id="cb8-9">  feature_list.append(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ret_'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(r))</span>
<span id="cb8-10">  feature_list.append(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'std_'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(r))</span>
<span id="cb8-11"></span>
<span id="cb8-12">df1a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df</span>
<span id="cb8-13"></span>
<span id="cb8-14">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o_c'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'open'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>]</span>
<span id="cb8-15">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'h_l'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'high'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'low'</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>]</span>
<span id="cb8-16">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ret_21d'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.log(df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>].shift(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>))</span>
<span id="cb8-17">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'roll_sd_ret21d_1Y'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ret_21d'</span>].rolling(window <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">251</span>).std()</span>
<span id="cb8-18">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'volum_sma200'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'volume'</span>].rolling(window <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>).mean()</span>
<span id="cb8-19">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'perc_above_volu_sma200'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.log(df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'volume'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'volum_sma200'</span>])</span>
<span id="cb8-20">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'roll_sd_volum_1Y'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'volume'</span>].rolling(window <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">251</span>).std()</span>
<span id="cb8-21">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sma50'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>].rolling(window <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>).mean()</span>
<span id="cb8-22">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'perc_above_sma50'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.log(df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sma50'</span>])</span>
<span id="cb8-23">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sma200'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>].rolling(window <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>).mean()</span>
<span id="cb8-24">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'perc_above_sma200'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.log(df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sma200'</span>])</span>
<span id="cb8-25">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'roll_corr_sma50_sma200'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sma200'</span>].rolling(window <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">252</span>).corr(df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sma50'</span>])</span>
<span id="cb8-26"></span>
<span id="cb8-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># setting up a target variable. </span></span>
<span id="cb8-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># is the stock above 5% in 2 weeks time. </span></span>
<span id="cb8-29">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'target'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.where(df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>].shift(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">41</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.01</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb8-30"></span>
<span id="cb8-31">df1a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a.drop([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'open'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'high'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'low'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'adjClose'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'volume'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sma50'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sma200'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'volum_sma200'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'returns'</span>], axis <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-32">df1a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a.dropna()</span>
<span id="cb8-33"></span>
<span id="cb8-34">target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'target'</span>]</span>
<span id="cb8-35">df1a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a.drop([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'target'</span>], axis <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-36"></span>
<span id="cb8-37"></span>
<span id="cb8-38">df.dropna(inplace <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)  </span>
<span id="cb8-39"></span>
<span id="cb8-40">df1a.values</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[ 0.15564846,  0.21637398,  0.04071166, ...,  0.05192485,
        -0.27383066,  0.86749277],
       [ 0.1761608 ,  0.22536981,  0.03979403, ...,  0.03793276,
        -0.28789777,  0.87185623],
       [ 0.123086  ,  0.19948936,  0.0422375 , ...,  0.00811607,
        -0.31777658,  0.87606062],
       ...,
       [-0.03425118, -0.09976226,  0.04401878, ..., -0.09835741,
        -0.12808572,  0.89240416],
       [-0.05395427,  0.04088161,  0.03663959, ..., -0.05392038,
        -0.0805411 ,  0.88992296],
       [-0.06992937,  0.00469569,  0.03579207, ..., -0.06330803,
        -0.08669331,  0.8874239 ]])</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" aria-labelledby="tabset-2-2-tab">

</div>
</div>
</div>
</section>
<section id="base-model" class="level1">
<h1>Base Model</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" aria-controls="tabset-3-1" aria-selected="true">Python</a></li><li class="nav-item"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" aria-controls="tabset-3-2" aria-selected="false">R</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" aria-labelledby="tabset-3-1-tab">
<div class="cell" data-hash="index_cache/html/unnamed-chunk-5_2f1c487307f28582273edae61f229fd8">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.model_selection <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> (train_test_split, RandomizedSearchCV, TimeSeriesSplit)</span>
<span id="cb10-2"></span>
<span id="cb10-3">x_train, x_test, y_train, y_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train_test_split(df1a, target, test_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, random_state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>, shuffle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb10-4"></span>
<span id="cb10-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Train set size is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(x_train)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> and test set size is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(x_test)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train set size is 4296 and test set size is 1075</code></pre>
</div>
</div>
<p>Let’s now fit a basic model without any tuning</p>
<div class="cell" data-hash="index_cache/html/py_xgboost_base_model_8cdd8c3e38cb97d56c6f11e58a244656">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> xgboost <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> XGBClassifier</span>
<span id="cb12-2"></span>
<span id="cb12-3">model_xgb <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> XGBClassifier(verbosity <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, random_state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb12-4">model_xgb.fit(x_train, y_train)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</a></style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, device=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=None, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              multi_strategy=None, n_estimators=None, n_jobs=None,
              num_parallel_tree=None, random_state=42, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;XGBClassifier<span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, device=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=None, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              multi_strategy=None, n_estimators=None, n_jobs=None,
              num_parallel_tree=None, random_state=42, ...)</pre></div> </div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"></span>
<span id="cb13-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># and now go onto prediction </span></span>
<span id="cb13-3">y_pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model_xgb.predict(x_test)</span>
<span id="cb13-4"></span>
<span id="cb13-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># or we can also use probability prediction</span></span>
<span id="cb13-6">y_pred_proba <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model_xgb.predict_proba(x_test)</span></code></pre></div>
</div>
<p>And we can check our result on this basic xgboost model</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-7_c7d372dc03342f4d1e87bf7a1bbacef4">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.metrics <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> accuracy_score, roc_auc_score, roc_curve</span>
<span id="cb14-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.metrics <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ConfusionMatrixDisplay, classification_report, RocCurveDisplay</span>
<span id="cb14-3"></span>
<span id="cb14-4">acc_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> accuracy_score(y_train, model_xgb.predict(x_train))</span>
<span id="cb14-5">acc_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> accuracy_score(y_test, model_xgb.predict(x_test))</span>
<span id="cb14-6"></span>
<span id="cb14-7"></span>
<span id="cb14-8">disp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ConfusionMatrixDisplay.from_estimator(</span>
<span id="cb14-9">        model_xgb,</span>
<span id="cb14-10">        x_test,</span>
<span id="cb14-11">        y_test,</span>
<span id="cb14-12">        display_labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model_xgb.classes_,</span>
<span id="cb14-13">        cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>plt.cm.Blues</span>
<span id="cb14-14">    )</span>
<span id="cb14-15">disp.ax_.set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Confusion matrix'</span>)</span>
<span id="cb14-16">plt.show()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/machine-learning-part2/xgboost/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-8_ab747d9e41f2a641199091ccbcca8edf">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(classification_report(y_test, y_pred))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.49      0.85      0.62       537
           1       0.46      0.13      0.21       538

    accuracy                           0.49      1075
   macro avg       0.48      0.49      0.42      1075
weighted avg       0.48      0.49      0.42      1075</code></pre>
</div>
</div>
<p>And the ROC curve</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-9_48d709c9f54e0174efb1a9d65e3903c0">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#plt.clf()</span></span>
<span id="cb17-2">disp_roc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RocCurveDisplay.from_estimator(</span>
<span id="cb17-3">            model_xgb,</span>
<span id="cb17-4">            x_test,</span>
<span id="cb17-5">            y_test,</span>
<span id="cb17-6">            name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'XGBoost'</span>)</span>
<span id="cb17-7">disp_roc.ax_.set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ROC Curve'</span>)</span>
<span id="cb17-8">plt.plot([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--'</span>)</span>
<span id="cb17-9">plt.show()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/machine-learning-part2/xgboost/index_files/figure-html/unnamed-chunk-9-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" aria-labelledby="tabset-3-2-tab">

</div>
</div>
</div>
</section>
<section id="hyperparameters-and-fine-tuning" class="level1">
<h1>Hyperparameters and fine tuning</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" aria-controls="tabset-4-1" aria-selected="true">Python</a></li><li class="nav-item"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" aria-controls="tabset-4-2" aria-selected="false">R</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" aria-labelledby="tabset-4-1-tab">
<div class="cell" data-hash="index_cache/html/unnamed-chunk-10_8702d7cb2716d6469fbc4e8380152273">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.model_selection <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> TimeSeriesSplit</span>
<span id="cb18-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.model_selection <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RandomizedSearchCV</span>
<span id="cb18-3"></span>
<span id="cb18-4">tscv <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TimeSeriesSplit(n_splits <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, gap <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>)</span>
<span id="cb18-5">model_xgb.get_params()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'objective': 'binary:logistic', 'base_score': None, 'booster': None, 'callbacks': None, 'colsample_bylevel': None, 'colsample_bynode': None, 'colsample_bytree': None, 'device': None, 'early_stopping_rounds': None, 'enable_categorical': False, 'eval_metric': None, 'feature_types': None, 'gamma': None, 'grow_policy': None, 'importance_type': None, 'interaction_constraints': None, 'learning_rate': None, 'max_bin': None, 'max_cat_threshold': None, 'max_cat_to_onehot': None, 'max_delta_step': None, 'max_depth': None, 'max_leaves': None, 'min_child_weight': None, 'missing': nan, 'monotone_constraints': None, 'multi_strategy': None, 'n_estimators': None, 'n_jobs': None, 'num_parallel_tree': None, 'random_state': 42, 'reg_alpha': None, 'reg_lambda': None, 'sampling_method': None, 'scale_pos_weight': None, 'subsample': None, 'tree_method': None, 'validate_parameters': None, 'verbosity': 1}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1">param_grid <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'learning_rate'</span>: [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.20</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.30</span>],</span>
<span id="cb20-2">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'max_depth'</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>],</span>
<span id="cb20-3">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'min_child_weight'</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>],</span>
<span id="cb20-4">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gamma'</span>: [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span> , <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>],</span>
<span id="cb20-5">              <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'colsample_bytree'</span>: [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> , <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>]}</span>
<span id="cb20-6">            </span>
<span id="cb20-7">xv_xgb <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RandomizedSearchCV(model_xgb, param_grid, n_iter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, scoring <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'f1'</span>, cv <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tscv, verbose <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb20-8"></span>
<span id="cb20-9">xv_xgb.fit(x_train, y_train, verbose <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</a></style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomizedSearchCV(cv=TimeSeriesSplit(gap=23, max_train_size=None, n_splits=5, test_size=None),
                   estimator=XGBClassifier(base_score=None, booster=None,
                                           callbacks=None,
                                           colsample_bylevel=None,
                                           colsample_bynode=None,
                                           colsample_bytree=None, device=None,
                                           early_stopping_rounds=None,
                                           enable_categorical=False,
                                           eval_metric=None, feature_types=None,
                                           gamma=None, grow_policy=...
                                           monotone_constraints=None,
                                           multi_strategy=None,
                                           n_estimators=None, n_jobs=None,
                                           num_parallel_tree=None,
                                           random_state=42, ...),
                   n_iter=100,
                   param_distributions={'colsample_bytree': [0.3, 0.4, 0.5,
                                                             0.7],
                                        'gamma': [0.0, 0.1, 0.2, 0.3, 0.4],
                                        'learning_rate': [0.05, 0.1, 0.15, 0.2,
                                                          0.25, 0.3],
                                        'max_depth': [3, 4, 5, 6, 8, 10, 12,
                                                      15],
                                        'min_child_weight': [1, 3, 5, 7]},
                   scoring='f1', verbose=1)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox"><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;RandomizedSearchCV<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.model_selection.RandomizedSearchCV.html">?<span>Documentation for RandomizedSearchCV</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>RandomizedSearchCV(cv=TimeSeriesSplit(gap=23, max_train_size=None, n_splits=5, test_size=None),
                   estimator=XGBClassifier(base_score=None, booster=None,
                                           callbacks=None,
                                           colsample_bylevel=None,
                                           colsample_bynode=None,
                                           colsample_bytree=None, device=None,
                                           early_stopping_rounds=None,
                                           enable_categorical=False,
                                           eval_metric=None, feature_types=None,
                                           gamma=None, grow_policy=...
                                           monotone_constraints=None,
                                           multi_strategy=None,
                                           n_estimators=None, n_jobs=None,
                                           num_parallel_tree=None,
                                           random_state=42, ...),
                   n_iter=100,
                   param_distributions={'colsample_bytree': [0.3, 0.4, 0.5,
                                                             0.7],
                                        'gamma': [0.0, 0.1, 0.2, 0.3, 0.4],
                                        'learning_rate': [0.05, 0.1, 0.15, 0.2,
                                                          0.25, 0.3],
                                        'max_depth': [3, 4, 5, 6, 8, 10, 12,
                                                      15],
                                        'min_child_weight': [1, 3, 5, 7]},
                   scoring='f1', verbose=1)</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox"><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">estimator: XGBClassifier</label><div class="sk-toggleable__content fitted"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, device=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=None, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              multi_strategy=None, n_estimators=None, n_jobs=None,
              num_parallel_tree=None, random_state=42, ...)</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox"><label for="sk-estimator-id-4" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">XGBClassifier</label><div class="sk-toggleable__content fitted"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, device=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=None, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=None, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              multi_strategy=None, n_estimators=None, n_jobs=None,
              num_parallel_tree=None, random_state=42, ...)</pre></div> </div></div></div></div></div></div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">xv_xgb.best_params_</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'min_child_weight': 7, 'max_depth': 12, 'learning_rate': 0.1, 'gamma': 0.1, 'colsample_bytree': 0.7}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1">xv_xgb.best_score_</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.5009456435677468</code></pre>
</div>
</div>
<p>Now we need to train the model based on the best paramaters fromt the cross-validation process.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-11_21342ef472f66c4a59d196253c6462e4">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.model_selection <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> cross_val_score</span>
<span id="cb25-2"></span>
<span id="cb25-3">model_xgb_tuned <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> XGBClassifier(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>xv_xgb.best_params_)</span>
<span id="cb25-4"></span>
<span id="cb25-5">model_xgb_tuned.fit(x_train, y_train, </span>
<span id="cb25-6">                    eval_set <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [(x_train, y_train), (x_test, y_test)],         </span>
<span id="cb25-7">                    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#eval_metric = 'precision', </span></span>
<span id="cb25-8">                    verbose <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-3 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-3 {
  color: var(--sklearn-color-text);
}

#sk-container-id-3 pre {
  padding: 0;
}

#sk-container-id-3 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-3 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-3 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-3 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-3 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-3 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-3 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-3 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-3 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-3 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-3 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-3 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-3 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-3 div.sk-label label.sk-toggleable__label,
#sk-container-id-3 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-3 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-3 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-3 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-3 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-3 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-3 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-3 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-3 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-3 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</a></style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=0.7, device=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=0.1, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=0.1, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=12, max_leaves=None,
              min_child_weight=7, missing=nan, monotone_constraints=None,
              multi_strategy=None, n_estimators=None, n_jobs=None,
              num_parallel_tree=None, random_state=None, ...)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" checked=""><label for="sk-estimator-id-5" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;XGBClassifier<span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=0.7, device=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=None, feature_types=None,
              gamma=0.1, grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=0.1, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=12, max_leaves=None,
              min_child_weight=7, missing=nan, monotone_constraints=None,
              multi_strategy=None, n_estimators=None, n_jobs=None,
              num_parallel_tree=None, random_state=None, ...)</pre></div> </div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1">eval_results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model_xgb_tuned.evals_result()</span>
<span id="cb26-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#eval_results</span></span>
<span id="cb26-3"></span>
<span id="cb26-4">score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cross_val_score(model_xgb_tuned, x_train, y_train, cv <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tscv)</span>
<span id="cb26-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Mean CV score for: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>score<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>mean()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:0.4}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean CV score for: 0.4961</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" aria-labelledby="tabset-4-2-tab">

</div>
</div>
</div>
</section>
<section id="feature-importance" class="level1">
<h1>Feature importance</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" aria-controls="tabset-5-1" aria-selected="true">Python</a></li><li class="nav-item"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" aria-controls="tabset-5-2" aria-selected="false">R</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" aria-labelledby="tabset-5-1-tab">

</div>
<div id="tabset-5-2" class="tab-pane" aria-labelledby="tabset-5-2-tab">

</div>
</div>
</div>


</section>

 ]]></description>
  <category>xgboost</category>
  <category>tidymodel</category>
  <guid>https://fderyckel.github.io/blog.html/posts/machine-learning-part2/xgboost/index.html</guid>
  <pubDate>Sun, 14 Apr 2024 17:00:00 GMT</pubDate>
</item>
<item>
  <title>Value at Risk using Python</title>
  <dc:creator>Francois de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/risk-portfolio/03-var/index.html</link>
  <description><![CDATA[ 




<p>Computing Value at Risk (VaR) using Python.</p>
<p>VaR is the maximum amount loss that can happen within a confidence interval over a pre-dertermined interval. If the 1-day 95% confidence Interval Var is $100; this means that 95% of the time, under ‘normal’ market conditions, we do not expect to loose more than $100 per day for our portfolio.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-3"></span>
<span id="cb1-4">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'../../../raw_data/FDX.csv'</span>, index_col <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, parse_dates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-5">returns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'adjClose'</span>].pct_change().dropna()</span></code></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(df)</span>
<span id="cb2-2"></span>
<span id="cb2-3">df</span>
<span id="cb2-4"></span>
<span id="cb2-5">returns</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  open        high         low       close    adjClose  \
date                                                                     
2023-03-09  211.080000  213.310000  207.300000  207.830000  207.830002   
2023-03-08  205.900000  209.970000  205.390000  209.540000  209.539993   
2023-03-07  209.720000  209.720000  206.160000  206.320000  206.320007   
2023-03-06  209.600000  211.890000  209.350000  210.130000  210.130005   
2023-03-03  208.460000  210.100000  207.130000  209.080000  209.080002   
...                ...         ...         ...         ...         ...   
2001-01-08   36.671723   37.013253   36.432653   36.825411   36.835415   
2001-01-05   38.165914   38.165914   36.722953   37.406011   37.416172   
2001-01-04   36.714414   38.422061   36.458267   37.790232   37.800480   
2001-01-03   32.624599   35.228761   32.445296   35.057997   35.067524   
2001-01-02   33.683341   34.127329   32.616061   32.616061   32.624928   

             volume  unadjustedVolume    change  changePercent    vwap  \
date                                                                     
2023-03-09  1953078           1918911 -3.250000       -1.54000  210.08   
2023-03-08  1073890           1073900  3.640000        1.77000  208.29   
2023-03-07  1527138           1526900 -3.400000       -1.62000  207.00   
2023-03-06  2148072           2148000  0.530000        0.25286  210.52   
2023-03-03  1612507           1612300  0.620000        0.29742  208.87   
...             ...               ...       ...            ...     ...   
2001-01-08  1120700           1120700  0.153688        0.41909   36.76   
2001-01-05  1485800           1485800 -0.759903       -1.99000   37.43   
2001-01-04  3410600           3410600  1.075820        2.93000   37.56   
2001-01-03  2203000           2203000  2.433400        7.46000   34.24   
2001-01-02   936600            936600 -1.067280       -3.17000   33.12   

                     label  changeOverTime  
date                                        
2023-03-09    March 09, 23       -0.015400  
2023-03-08    March 08, 23        0.017700  
2023-03-07    March 07, 23       -0.016200  
2023-03-06    March 06, 23        0.002529  
2023-03-03    March 03, 23        0.002974  
...                    ...             ...  
2001-01-08  January 08, 01        0.004191  
2001-01-05  January 05, 01       -0.019900  
2001-01-04  January 04, 01        0.029300  
2001-01-03  January 03, 01        0.074600  
2001-01-02  January 02, 01       -0.031700  

[5581 rows x 12 columns]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>date
2023-03-08    0.008228
2023-03-07   -0.015367
2023-03-06    0.018466
2023-03-03   -0.004997
2023-03-02   -0.010283
                ...   
2001-01-08    0.020345
2001-01-05    0.015766
2001-01-04    0.010271
2001-01-03   -0.072300
2001-01-02   -0.069654
Name: adjClose, Length: 5580, dtype: float64</code></pre>
</div>
</div>



 ]]></description>
  <category>statistics</category>
  <category>code</category>
  <category>analysis</category>
  <guid>https://fderyckel.github.io/blog.html/posts/risk-portfolio/03-var/index.html</guid>
  <pubDate>Tue, 13 Feb 2024 17:00:00 GMT</pubDate>
</item>
<item>
  <title>quantitative Methods</title>
  <dc:creator>Francois de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/quant-part2/05-quantitative-methods/index.html</link>
  <description><![CDATA[ 




<p>Starting here a few examples on how to graph functions, how to solve equations and differential equations with computational methods.</p>
<section id="basic-graphs-of-a-functions." class="level1">
<h1>Basic graphs of a functions.</h1>
<p>Let’s take the function <img src="https://latex.codecogs.com/png.latex?Q(t)%20=%2010%20e%5E%7B-%20%5Cfrac%7Bt%7D%7B10%7D%7D"> We want to graph this in the interval 0-40 for instance and know what is the value of <img src="https://latex.codecogs.com/png.latex?Q"> when <img src="https://latex.codecogs.com/png.latex?t=30">.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb5-2">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb5-4">df_point <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb5-5"></span>
<span id="cb5-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x, y)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_point, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x, y), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_point, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, y<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">+0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x = 30, y = '</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(y, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part2/05-quantitative-methods/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="graphing-slope-fields-from-differential-equations" class="level1">
<h1>Graphing slope fields from differential equations</h1>
<p>Solving <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7BdN%7D%7Bdt%7D%20=%20r%20%5Ccdot%20N%20%5Ccdot%20%5Cleft(%201%20-%20%5Cfrac%7BN%7D%7BK%7D%20%5Cright)"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(deSolve)</span>
<span id="cb7-2"></span>
<span id="cb7-3">model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(time, y, parms) {</span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(y, parms)), {</span>
<span id="cb7-5">    dN <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> r <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> N <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>K)</span>
<span id="cb7-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(dN)</span>
<span id="cb7-7">  })</span>
<span id="cb7-8">}</span>
<span id="cb7-9"></span>
<span id="cb7-10"></span>
<span id="cb7-11">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb7-12">parms <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb7-13">times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb7-14"></span>
<span id="cb7-15">out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(y, times, model, parms)</span>
<span id="cb7-16"></span>
<span id="cb7-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(out)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part2/05-quantitative-methods/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Solving <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7BdS%7D%7Bdt%7D%20=%208%20-%20%5Cfrac%7BS(t)%7D%7B4+t%7D"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(t, S, parms) {</span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(S, parms)), {</span>
<span id="cb8-3">    dS <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> S<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>t)</span>
<span id="cb8-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(dS)</span>
<span id="cb8-5">  })</span>
<span id="cb8-6">}</span>
<span id="cb8-7"></span>
<span id="cb8-8">S0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span></span>
<span id="cb8-9">times <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb8-10"></span>
<span id="cb8-11">out <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ode</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>S0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> times, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">func =</span> model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parms=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>)</span>
<span id="cb8-12"></span>
<span id="cb8-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(out)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part2/05-quantitative-methods/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># finding S(t) for specific value of time</span></span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb9-3">yo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>(out) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'1'</span>)</span>
<span id="cb9-4"></span>
<span id="cb9-5">yo <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  t         S        
  &lt;deSolve&gt; &lt;deSolve&gt;
1 20        98.66667 </code></pre>
</div>
</div>
</section>
<section id="using-python" class="level1">
<h1>Using Python</h1>
<section id="eulers-method" class="level2">
<h2 class="anchored" data-anchor-id="eulers-method">Euler’s method</h2>
<p>Let’s define <img src="https://latex.codecogs.com/png.latex?y'%20=%20f(x,%20y)"> and a small increment <img src="https://latex.codecogs.com/png.latex?h"> which is a small steps on the interval <img src="https://latex.codecogs.com/png.latex?%5Bx_0,%20b%5D">. We obtain <img src="https://latex.codecogs.com/png.latex?h"> by dividing that interval in <img src="https://latex.codecogs.com/png.latex?n"> eaual parts. Hence <img src="https://latex.codecogs.com/png.latex?h%20=%20%5Cfrac%7Bb%20-%20x_0%7D%7Bn%7D">. Finally, we approximate <img src="https://latex.codecogs.com/png.latex?y"> in the following way: <img src="https://latex.codecogs.com/png.latex?y_%7Bi+1%7D%20=%20y_i%20+%20h%20%5Ccdot%20f(x_i,%20y_i)"> We need a starting point: <img src="https://latex.codecogs.com/png.latex?y(x_0)%20=%20y_0"> and <img src="https://latex.codecogs.com/png.latex?x_0%20=%200"> and <img src="https://latex.codecogs.com/png.latex?x_1%20=%20x_0%20+%20h"> and so on.</p>
<section id="problem-1" class="level3">
<h3 class="anchored" data-anchor-id="problem-1">Problem 1</h3>
<p>Approximate the function <img src="https://latex.codecogs.com/png.latex?y'%20+%202y%20=%20x%5E3%20%5Ccdot%20e%5E%7B-2x%7D"> at <img src="https://latex.codecogs.com/png.latex?x%20=%201.7"> using increment of <img src="https://latex.codecogs.com/png.latex?h%20=%200.01">. This is an initial-value problem with <img src="https://latex.codecogs.com/png.latex?y(0)%20=%201"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb11-2"></span>
<span id="cb11-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#defining the function first </span></span>
<span id="cb11-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> f(x, y): </span>
<span id="cb11-5">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x))</span>
<span id="cb11-6"></span>
<span id="cb11-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># defining the recurisve loop to approximate y'</span></span>
<span id="cb11-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## in our problem: h = 0.01, xn = 1.7</span></span>
<span id="cb11-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> euler_method(f, x0, y0, h, xn): </span>
<span id="cb11-10">  n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.rint(xn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> h).astype(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>)</span>
<span id="cb11-11">  x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(x0, xn, n) </span>
<span id="cb11-12">  y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(n) </span>
<span id="cb11-13">  y[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> y0 </span>
<span id="cb11-14">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n):  </span>
<span id="cb11-15">    y[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> y[i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> h <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> f(x[i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], y[i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) </span>
<span id="cb11-16">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> x, y</span>
<span id="cb11-17">  </span>
<span id="cb11-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># approximatinig our ODE</span></span>
<span id="cb11-19">x0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb11-20">y0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb11-21">h<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span></span>
<span id="cb11-22">xn<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.7</span></span>
<span id="cb11-23">x, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> euler_method(f, x0, y0, h, xn)</span></code></pre></div>
</div>
<p>And bonus we could add some graphs to it</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb12-2">plt.clf()</span>
<span id="cb12-3">plt.plot(x, y)</span>
<span id="cb12-4">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x'</span>)</span>
<span id="cb12-5">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y'</span>)</span>
<span id="cb12-6">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Approximate solution to an ODE using Euler</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\'</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">s method'</span> )</span>
<span id="cb12-7">plt.show()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part2/05-quantitative-methods/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>
</section>

 ]]></description>
  <category>graph</category>
  <category>code</category>
  <guid>https://fderyckel.github.io/blog.html/posts/quant-part2/05-quantitative-methods/index.html</guid>
  <pubDate>Sat, 20 Jan 2024 17:00:00 GMT</pubDate>
</item>
<item>
  <title>05 - Arima</title>
  <dc:creator>François de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/time-series/05-arima/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This post is about introducing ARIMA using the CPI data and various R framework for time series. Autoregressive because it is based on past value and moving average to smooth the time series data.</p>
<p>Our <a href="../../../posts/time-series/03-autocorrelation/index.html">previous post</a> on autocorrelation and partial autocorelation could be considered as prior material.</p>
<p>Autoregression is a class of linear model where the outcome variable is regressed on its previous values (lagged observations). <img src="https://latex.codecogs.com/png.latex?Y_t%20=%20%5Cdelta%20+%20%5Cphi_1%20Y_%7Bt-1%7D%20+%20%5Cphi_2%20Y_%7Bt-2%7D%20+%20%5Ccdots%20+%20%5Cphi_p%20Y_%7Bt-p%7D%20+%20%5Cepsilon_t"> This AR model used <img src="https://latex.codecogs.com/png.latex?p"> lags, hence we say it is of order <img src="https://latex.codecogs.com/png.latex?p">.</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5Cdelta"> is an intercept like term</li>
<li><img src="https://latex.codecogs.com/png.latex?Y_%7Bt-i%7D"> are the regressors (time series own lagged observations) with parameters <img src="https://latex.codecogs.com/png.latex?%5Cphi_%7Bt-i%7D"></li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cepsilon"> is the error term</li>
</ul>
<p>Moving Average (MA) is another class of linear model where the outcome variable is regressed using its own previous error terms. <img src="https://latex.codecogs.com/png.latex?Y_t%20=%20%5Cmu%20+%20%20%5Ctheta_1%20%5Cepsilon_%7Bt-1%7D%20+%20%5Ctheta_2%20%5Cepsilon_%7Bt-2%7D%20+%20%5Ccdots%20+%20%5Ctheta_q%20%5Cepsilon_%7Bt-q%7D%20+%20%5Cepsilon_t"> This MA model used <img src="https://latex.codecogs.com/png.latex?q"> lags, hence we say it is of order <img src="https://latex.codecogs.com/png.latex?q">.</p>
<p>Putting it all together, the outcome variable of an ARIMA model can be predicted: <img src="https://latex.codecogs.com/png.latex?Y_t%20=%20%5C%7B%5Cdelta%20+%20%5Cphi_1%20Y_%7Bt-1%7D%20+%20%5Cphi_2%20Y_%7Bt-2%7D%20+%20%5Ccdots%20+%20%5Cphi_p%20Y_%7Bt-p%7D%20+%20%5Cepsilon_t%20%5C%7D%20+%20%5C%7B%5Cmu%20+%20%20%5Ctheta_1%20%5Cepsilon_%7Bt-1%7D%20+%20%5Ctheta_2%20%5Cepsilon_%7Bt-2%7D%20+%20%5Ccdots%20+%20%5Ctheta_q%20%5Cepsilon_%7Bt-q%7D%20+%20%5Cepsilon_t%20%5C%7D"> This can be simplify into: <img src="https://latex.codecogs.com/png.latex?Y_t%20=%20%5Cdelta%20+%20%5Csum_%7Bi=1%7D%5Ep%20%5Cphi_i%20Y_%7Bt-i%7D%20+%20%5Csum_%7Bj=1%7D%5Eq%20%5Ctheta_j%20%5Cepsilon_%7Bt-j%7D%20+%20%5Cepsilon_t"></p>
<p>The parameters of an ARIMA model are (p, d, q) :</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?p"> - Autoregressive. The number of lagged observations in the model. Use the previous <img src="https://latex.codecogs.com/png.latex?n"> observations as predictors.</li>
<li><img src="https://latex.codecogs.com/png.latex?d"> - Integrated. The number of times the data is differenced to make the data stationary<br>
</li>
<li><img src="https://latex.codecogs.com/png.latex?q"> - the size of the moving average. Use previous errors to predict <img src="https://latex.codecogs.com/png.latex?Y_t"></li>
</ul>
<p>To apply an ARIMA model to a set of data, we will use the US CPI Energy component that we downloaded on the <a href="https://fred.stlouisfed.org/series/CPIENGSL">FED St-Louis website</a>.</p>
</section>
<section id="application-using-r" class="level1">
<h1>Application using R</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(modeltime)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(timetk)</span>
<span id="cb1-6"></span>
<span id="cb1-7">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'../../../raw_data/CPI_energy.csv'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> DATE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cpi_energy =</span> CPIENGNS)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glimpse</span>(df)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 803
Columns: 2
$ date       &lt;date&gt; 1957-01-01, 1957-02-01, 1957-03-01, 1957-04-01, 1957-05-01…
$ cpi_energy &lt;dbl&gt; 21.3, 21.5, 21.6, 21.5, 21.4, 21.4, 21.5, 21.4, 21.5, 21.4,…</code></pre>
</div>
</div>
<section id="arima-using-the-base-r-framework" class="level2">
<h2 class="anchored" data-anchor-id="arima-using-the-base-r-framework">ARIMA using the base R framework</h2>
<p>We need first to convert our df into a ts object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">df_ts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ts</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cpi_energy, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1957</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">01</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">frequency =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>))</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str</span>(df_ts)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Time-Series [1:803] from 1957 to 2024: 21.3 21.5 21.6 21.5 21.4 21.4 21.5 21.4 21.5 21.4 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ts.plot</span>(df_ts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Date'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Energy CPI'</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/time-series/05-arima/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It is usually a wise idea to check for outliers? An easy way to do this is using a boxplot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">boxplot</span>(df_ts)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/time-series/05-arima/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We use the ACF to determine the MA parameter (q) of the ARIMA model.</p>
<ul>
<li>Significant spikes at specific lags in the ACF plot suggest potential MA terms at those lags</li>
<li>An ACF plot that cuts off sharply after a few lags often indicates a suitable MA model</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">acf</span>(df_ts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lag.max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/time-series/05-arima/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggacf</span>(df_ts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">num_lags =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/time-series/05-arima/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Data is clearly not stationary. We will need to use differentiation to make it stationary.</p>
<p>The PCAF helps determine the AR (Autoregressive) order (p) in an ARIMA model.</p>
<ul>
<li>Significant spikes at specific lags in the PACF plot suggest potential AR terms at those lags</li>
<li>A PACF plot that cuts off sharply after a few lags often indicates a suitable AR model</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pacf</span>(df_ts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lag.max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/time-series/05-arima/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This can be confirm with Augmented Dickey Fuller test</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">tseries<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">adf.test</span>(df_ts)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'quantmod':
  method            from
  as.zoo.data.frame zoo </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  df_ts
Dickey-Fuller = -2.4123, Lag order = 9, p-value = 0.4038
alternative hypothesis: stationary</code></pre>
</div>
</div>
<p>adf test confirm non-stationarity of our ts. We can differentiate our ts to make it stationary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">diff_ts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> df_ts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lag =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ts.plot</span>(diff_ts)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/time-series/05-arima/index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">tseries<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">adf.test</span>(diff_ts)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tseries::adf.test(diff_ts): p-value smaller than printed p-value</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Augmented Dickey-Fuller Test

data:  diff_ts
Dickey-Fuller = -9.4624, Lag order = 9, p-value = 0.01
alternative hypothesis: stationary</code></pre>
</div>
</div>
<p>We can create our training and testing set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">train_ts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df_ts[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">793</span>]</span></code></pre></div>
</div>
<p>We can now use ARIMA model using 1 and 1 for parameter (all we could see from acf)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">result <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arima</span>(train_ts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">order =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb18-2">result</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
arima(x = train_ts, order = c(0, 1, 2))

Coefficients:
         ma1     ma2
      0.5197  0.0884
s.e.  0.0356  0.0361

sigma^2 estimated as 17.24:  log likelihood = -2251.54,  aic = 4509.07</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tsdiag</span>(result)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/time-series/05-arima/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(result, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$pred
Time Series:
Start = 794 
End = 796 
Frequency = 1 
[1] 290.5702 292.0037 292.0037

$se
Time Series:
Start = 794 
End = 796 
Frequency = 1 
[1]  4.152615  7.554318 10.082648</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">result_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arima</span>(df_ts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">order =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb23-2">result_df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
arima(x = df_ts, order = c(0, 1, 2))

Coefficients:
         ma1     ma2
      0.5033  0.0834
s.e.  0.0347  0.0358

sigma^2 estimated as 17.52:  log likelihood = -2286.24,  aic = 4578.49</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(result_df, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$pred
          Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov      Dec
2023                                                  273.7094
2024 273.2768                                                 

$se
          Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov      Dec
2023                                                  4.185297
2024 7.556805                                                 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">result_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arima</span>(df_ts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">order =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb27-2">result_df</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
arima(x = df_ts, order = c(4, 1, 1))

Coefficients:
         ar1      ar2     ar3      ar4      ma1
      1.1419  -0.4870  0.1896  -0.1582  -0.6576
s.e.  0.0776   0.0626  0.0531   0.0362   0.0722

sigma^2 estimated as 16.92:  log likelihood = -2272.35,  aic = 4556.69</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(result_df, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$pred
          Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov      Dec
2023                                                  272.8635
2024 270.8238                                                 

$se
          Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov      Dec
2023                                                  4.112985
2024 7.361178                                                 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">forecast<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">auto.arima</span>(df_ts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trace =</span> T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stepwise =</span> F, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">approximation =</span> F)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 ARIMA(0,1,0)                               : 4762.801
 ARIMA(0,1,0)            with drift         : 4761.123
 ARIMA(0,1,0)(0,0,1)[12]                    : 4751.105
 ARIMA(0,1,0)(0,0,1)[12] with drift         : 4750.212
 ARIMA(0,1,0)(0,0,2)[12]                    : 4749.802
 ARIMA(0,1,0)(0,0,2)[12] with drift         : 4749.14
 ARIMA(0,1,0)(1,0,0)[12]                    : 4748.883
 ARIMA(0,1,0)(1,0,0)[12] with drift         : 4748.184
 ARIMA(0,1,0)(1,0,1)[12]                    : Inf
 ARIMA(0,1,0)(1,0,1)[12] with drift         : Inf
 ARIMA(0,1,0)(1,0,2)[12]                    : Inf
 ARIMA(0,1,0)(1,0,2)[12] with drift         : Inf
 ARIMA(0,1,0)(2,0,0)[12]                    : 4742.386
 ARIMA(0,1,0)(2,0,0)[12] with drift         : 4742.203
 ARIMA(0,1,0)(2,0,1)[12]                    : Inf
 ARIMA(0,1,0)(2,0,1)[12] with drift         : Inf
 ARIMA(0,1,0)(2,0,2)[12]                    : Inf
 ARIMA(0,1,0)(2,0,2)[12] with drift         : Inf
 ARIMA(0,1,1)                               : 4581.902
 ARIMA(0,1,1)            with drift         : 4581.821
 ARIMA(0,1,1)(0,0,1)[12]                    : 4577.654
 ARIMA(0,1,1)(0,0,1)[12] with drift         : 4577.884
 ARIMA(0,1,1)(0,0,2)[12]                    : 4573.756
 ARIMA(0,1,1)(0,0,2)[12] with drift         : 4574.212
 ARIMA(0,1,1)(1,0,0)[12]                    : 4576.446
 ARIMA(0,1,1)(1,0,0)[12] with drift         : 4576.758
 ARIMA(0,1,1)(1,0,1)[12]                    : Inf
 ARIMA(0,1,1)(1,0,1)[12] with drift         : Inf
 ARIMA(0,1,1)(1,0,2)[12]                    : Inf
 ARIMA(0,1,1)(1,0,2)[12] with drift         : Inf
 ARIMA(0,1,1)(2,0,0)[12]                    : 4568.379
 ARIMA(0,1,1)(2,0,0)[12] with drift         : 4569.08
 ARIMA(0,1,1)(2,0,1)[12]                    : Inf
 ARIMA(0,1,1)(2,0,1)[12] with drift         : Inf
 ARIMA(0,1,1)(2,0,2)[12]                    : Inf
 ARIMA(0,1,1)(2,0,2)[12] with drift         : Inf
 ARIMA(0,1,2)                               : 4578.515
 ARIMA(0,1,2)            with drift         : 4578.734
 ARIMA(0,1,2)(0,0,1)[12]                    : 4575.644
 ARIMA(0,1,2)(0,0,1)[12] with drift         : 4576.08
 ARIMA(0,1,2)(0,0,2)[12]                    : 4572.671
 ARIMA(0,1,2)(0,0,2)[12] with drift         : 4573.279
 ARIMA(0,1,2)(1,0,0)[12]                    : 4574.772
 ARIMA(0,1,2)(1,0,0)[12] with drift         : 4575.261
 ARIMA(0,1,2)(1,0,1)[12]                    : Inf
 ARIMA(0,1,2)(1,0,1)[12] with drift         : Inf
 ARIMA(0,1,2)(1,0,2)[12]                    : Inf
 ARIMA(0,1,2)(1,0,2)[12] with drift         : Inf
 ARIMA(0,1,2)(2,0,0)[12]                    : 4568.289
 ARIMA(0,1,2)(2,0,0)[12] with drift         : 4569.079
 ARIMA(0,1,2)(2,0,1)[12]                    : Inf
 ARIMA(0,1,2)(2,0,1)[12] with drift         : Inf
 ARIMA(0,1,3)                               : 4579.677
 ARIMA(0,1,3)            with drift         : 4580.023
 ARIMA(0,1,3)(0,0,1)[12]                    : 4577.191
 ARIMA(0,1,3)(0,0,1)[12] with drift         : 4577.708
 ARIMA(0,1,3)(0,0,2)[12]                    : 4574.269
 ARIMA(0,1,3)(0,0,2)[12] with drift         : 4574.946
 ARIMA(0,1,3)(1,0,0)[12]                    : 4576.379
 ARIMA(0,1,3)(1,0,0)[12] with drift         : 4576.941
 ARIMA(0,1,3)(1,0,1)[12]                    : Inf
 ARIMA(0,1,3)(1,0,1)[12] with drift         : Inf
 ARIMA(0,1,3)(2,0,0)[12]                    : 4569.998
 ARIMA(0,1,3)(2,0,0)[12] with drift         : 4570.839
 ARIMA(0,1,4)                               : 4581.69
 ARIMA(0,1,4)            with drift         : 4582.053
 ARIMA(0,1,4)(0,0,1)[12]                    : 4579.221
 ARIMA(0,1,4)(0,0,1)[12] with drift         : 4579.733
 ARIMA(0,1,4)(1,0,0)[12]                    : 4578.408
 ARIMA(0,1,4)(1,0,0)[12] with drift         : 4578.96
 ARIMA(0,1,5)                               : 4583.72
 ARIMA(0,1,5)            with drift         : 4584.063
 ARIMA(1,1,0)                               : 4592.114
 ARIMA(1,1,0)            with drift         : 4592.78
 ARIMA(1,1,0)(0,0,1)[12]                    : 4590.795
 ARIMA(1,1,0)(0,0,1)[12] with drift         : 4591.591
 ARIMA(1,1,0)(0,0,2)[12]                    : 4589.897
 ARIMA(1,1,0)(0,0,2)[12] with drift         : 4590.8
 ARIMA(1,1,0)(1,0,0)[12]                    : 4590.336
 ARIMA(1,1,0)(1,0,0)[12] with drift         : 4591.158
 ARIMA(1,1,0)(1,0,1)[12]                    : Inf
 ARIMA(1,1,0)(1,0,1)[12] with drift         : Inf
 ARIMA(1,1,0)(1,0,2)[12]                    : Inf
 ARIMA(1,1,0)(1,0,2)[12] with drift         : Inf
 ARIMA(1,1,0)(2,0,0)[12]                    : 4587.308
 ARIMA(1,1,0)(2,0,0)[12] with drift         : 4588.314
 ARIMA(1,1,0)(2,0,1)[12]                    : Inf
 ARIMA(1,1,0)(2,0,1)[12] with drift         : Inf
 ARIMA(1,1,0)(2,0,2)[12]                    : Inf
 ARIMA(1,1,0)(2,0,2)[12] with drift         : Inf
 ARIMA(1,1,1)                               : 4577.984
 ARIMA(1,1,1)            with drift         : 4578.289
 ARIMA(1,1,1)(0,0,1)[12]                    : 4575.351
 ARIMA(1,1,1)(0,0,1)[12] with drift         : 4575.838
 ARIMA(1,1,1)(0,0,2)[12]                    : 4572.434
 ARIMA(1,1,1)(0,0,2)[12] with drift         : 4573.078
 ARIMA(1,1,1)(1,0,0)[12]                    : 4574.518
 ARIMA(1,1,1)(1,0,0)[12] with drift         : 4575.051
 ARIMA(1,1,1)(1,0,1)[12]                    : Inf
 ARIMA(1,1,1)(1,0,1)[12] with drift         : Inf
 ARIMA(1,1,1)(1,0,2)[12]                    : Inf
 ARIMA(1,1,1)(1,0,2)[12] with drift         : Inf
 ARIMA(1,1,1)(2,0,0)[12]                    : 4568.139
 ARIMA(1,1,1)(2,0,0)[12] with drift         : 4568.95
 ARIMA(1,1,1)(2,0,1)[12]                    : Inf
 ARIMA(1,1,1)(2,0,1)[12] with drift         : Inf
 ARIMA(1,1,2)                               : 4579.966
 ARIMA(1,1,2)            with drift         : 4580.292
 ARIMA(1,1,2)(0,0,1)[12]                    : 4577.355
 ARIMA(1,1,2)(0,0,1)[12] with drift         : 4577.857
 ARIMA(1,1,2)(0,0,2)[12]                    : 4574.418
 ARIMA(1,1,2)(0,0,2)[12] with drift         : 4575.085
 ARIMA(1,1,2)(1,0,0)[12]                    : 4576.524
 ARIMA(1,1,2)(1,0,0)[12] with drift         : 4577.071
 ARIMA(1,1,2)(1,0,1)[12]                    : Inf
 ARIMA(1,1,2)(1,0,1)[12] with drift         : Inf
 ARIMA(1,1,2)(2,0,0)[12]                    : 4570.12
 ARIMA(1,1,2)(2,0,0)[12] with drift         : 4570.951
 ARIMA(1,1,3)                               : 4581.695
 ARIMA(1,1,3)            with drift         : 4582.053
 ARIMA(1,1,3)(0,0,1)[12]                    : 4579.222
 ARIMA(1,1,3)(0,0,1)[12] with drift         : 4579.743
 ARIMA(1,1,3)(1,0,0)[12]                    : 4578.411
 ARIMA(1,1,3)(1,0,0)[12] with drift         : 4578.979
 ARIMA(1,1,4)                               : 4573.756
 ARIMA(1,1,4)            with drift         : 4571.09
 ARIMA(2,1,0)                               : 4579.505
 ARIMA(2,1,0)            with drift         : 4579.69
 ARIMA(2,1,0)(0,0,1)[12]                    : 4577.142
 ARIMA(2,1,0)(0,0,1)[12] with drift         : 4577.505
 ARIMA(2,1,0)(0,0,2)[12]                    : 4575.062
 ARIMA(2,1,0)(0,0,2)[12] with drift         : 4575.574
 ARIMA(2,1,0)(1,0,0)[12]                    : 4576.421
 ARIMA(2,1,0)(1,0,0)[12] with drift         : 4576.826
 ARIMA(2,1,0)(1,0,1)[12]                    : Inf
 ARIMA(2,1,0)(1,0,1)[12] with drift         : Inf
 ARIMA(2,1,0)(1,0,2)[12]                    : Inf
 ARIMA(2,1,0)(1,0,2)[12] with drift         : Inf
 ARIMA(2,1,0)(2,0,0)[12]                    : 4571.428
 ARIMA(2,1,0)(2,0,0)[12] with drift         : 4572.095
 ARIMA(2,1,0)(2,0,1)[12]                    : Inf
 ARIMA(2,1,0)(2,0,1)[12] with drift         : Inf
 ARIMA(2,1,1)                               : 4579.893
 ARIMA(2,1,1)            with drift         : 4580.248
 ARIMA(2,1,1)(0,0,1)[12]                    : 4577.321
 ARIMA(2,1,1)(0,0,1)[12] with drift         : 4577.839
 ARIMA(2,1,1)(0,0,2)[12]                    : 4574.356
 ARIMA(2,1,1)(0,0,2)[12] with drift         : 4575.04
 ARIMA(2,1,1)(1,0,0)[12]                    : 4576.493
 ARIMA(2,1,1)(1,0,0)[12] with drift         : 4577.055
 ARIMA(2,1,1)(1,0,1)[12]                    : Inf
 ARIMA(2,1,1)(1,0,1)[12] with drift         : Inf
 ARIMA(2,1,1)(2,0,0)[12]                    : 4570.052
 ARIMA(2,1,1)(2,0,0)[12] with drift         : 4570.9
 ARIMA(2,1,2)                               : 4581.576
 ARIMA(2,1,2)            with drift         : 4582.003
 ARIMA(2,1,2)(0,0,1)[12]                    : Inf
 ARIMA(2,1,2)(0,0,1)[12] with drift         : Inf
 ARIMA(2,1,2)(1,0,0)[12]                    : Inf
 ARIMA(2,1,2)(1,0,0)[12] with drift         : Inf
 ARIMA(2,1,3)                    : Inf
 ARIMA(2,1,3) with drift         : Inf
 ARIMA(3,1,0)                               : 4581.026
 ARIMA(3,1,0)            with drift         : 4581.307
 ARIMA(3,1,0)(0,0,1)[12]                    : 4578.438
 ARIMA(3,1,0)(0,0,1)[12] with drift         : 4578.91
 ARIMA(3,1,0)(0,0,2)[12]                    : 4575.713
 ARIMA(3,1,0)(0,0,2)[12] with drift         : 4576.374
 ARIMA(3,1,0)(1,0,0)[12]                    : 4577.627
 ARIMA(3,1,0)(1,0,0)[12] with drift         : 4578.148
 ARIMA(3,1,0)(1,0,1)[12]                    : Inf
 ARIMA(3,1,0)(1,0,1)[12] with drift         : Inf
 ARIMA(3,1,0)(2,0,0)[12]                    : 4571.48
 ARIMA(3,1,0)(2,0,0)[12] with drift         : 4572.324
 ARIMA(3,1,1)                               : 4581.285
 ARIMA(3,1,1)            with drift         : 4581.576
 ARIMA(3,1,1)(0,0,1)[12]                    : 4578.762
 ARIMA(3,1,1)(0,0,1)[12] with drift         : 4579.224
 ARIMA(3,1,1)(1,0,0)[12]                    : 4577.945
 ARIMA(3,1,1)(1,0,0)[12] with drift         : 4578.452
 ARIMA(3,1,2)                               : 4568.698
 ARIMA(3,1,2) with drift         : Inf
 ARIMA(4,1,0)                               : 4575.634
 ARIMA(4,1,0)            with drift         : 4575.534
 ARIMA(4,1,0)(0,0,1)[12]                    : 4574.175
 ARIMA(4,1,0)(0,0,1)[12] with drift         : 4574.312
 ARIMA(4,1,0)(1,0,0)[12]                    : 4573.622
 ARIMA(4,1,0)(1,0,0)[12] with drift         : 4573.812
 ARIMA(4,1,1)                               : 4556.801
 ARIMA(4,1,1)            with drift         : 4554.628
 ARIMA(5,1,0)                               : 4561.352
 ARIMA(5,1,0)            with drift         : 4560.508



 Best model: ARIMA(4,1,1)            with drift         </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: df_ts 
ARIMA(4,1,1) with drift 

Coefficients:
         ar1      ar2     ar3      ar4      ma1   drift
      1.1535  -0.4942  0.1912  -0.1603  -0.6749  0.3205
s.e.  0.0758   0.0622  0.0534   0.0365   0.0703  0.1523

sigma^2 = 16.95:  log likelihood = -2270.24
AIC=4554.49   AICc=4554.63   BIC=4587.3</code></pre>
</div>
</div>
</section>
</section>
<section id="using-modeltime-framework" class="level1">
<h1>Using modeltime framework</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_time_series</span>(date, cpi_energy, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.interactive =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/time-series/05-arima/index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>with model time, it is pretty easy to do get the value for arima.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1">cv_splits <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb35-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">time_series_split</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_var =</span> date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">assess =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'13 months'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cumulative =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb35-3"></span>
<span id="cb35-4">cv_splits <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb35-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tk_time_series_cv_plan</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb35-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_time_series_cv_plan</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.date_var =</span> date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.value =</span> cpi_energy, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.interactive =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/time-series/05-arima/index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidymodels)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.1.1 ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ broom        1.0.5     ✔ rsample      1.2.0
✔ dials        1.2.0     ✔ tibble       3.2.1
✔ infer        1.0.5     ✔ tidyr        1.3.0
✔ modeldata    1.2.0     ✔ tune         1.1.2
✔ parsnip      1.1.1     ✔ workflows    1.1.3
✔ purrr        1.0.2     ✔ workflowsets 1.0.1
✔ recipes      1.0.9     ✔ yardstick    1.2.0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ purrr::discard()  masks scales::discard()
✖ dplyr::filter()   masks stats::filter()
✖ dplyr::lag()      masks stats::lag()
✖ yardstick::spec() masks readr::spec()
✖ recipes::step()   masks stats::step()
• Use suppressPackageStartupMessages() to eliminate package startup messages</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(parsnip)</span>
<span id="cb40-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(modeltime)</span>
<span id="cb40-3"></span>
<span id="cb40-4">model_fit_arima <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arima_reg</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb40-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_engine</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'auto_arima'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb40-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fit</span>(cpi_energy <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> date, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">training</span>(cv_splits))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>frequency = 12 observations per 1 year</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1">model_fit_arima</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>parsnip model object

Series: outcome 
ARIMA(0,1,2)(0,0,2)[12] 

Coefficients:
         ma1     ma2    sma1    sma2
      0.5229  0.0895  0.0733  0.0907
s.e.  0.0356  0.0358  0.0400  0.0359

sigma^2 = 16.45:  log likelihood = -2222.54
AIC=4455.07   AICc=4455.15   BIC=4478.42</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>Time-Series</category>
  <guid>https://fderyckel.github.io/blog.html/posts/time-series/05-arima/index.html</guid>
  <pubDate>Mon, 08 Jan 2024 17:00:00 GMT</pubDate>
</item>
<item>
  <title>Hotel forecasting</title>
  <dc:creator>François de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/ts-forecast/hotel-booking/index.html</link>
  <description><![CDATA[ 




<p>Forceasting hotel demands from medium post Data from Kaggle</p>
<section id="python-version" class="level1">
<h1>Python version</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-2"></span>
<span id="cb1-3">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'../../../raw_data/hotel_bookings.csv'</span>)</span>
<span id="cb1-4">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.rename(columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'arrival_date_year'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'year'</span>, </span>
<span id="cb1-5">                          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'arrival_date_month'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'month'</span>, </span>
<span id="cb1-6">                          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'arrival_date_day_of_month'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'day'</span>})</span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># turn the months into numbers</span></span>
<span id="cb1-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> monthToNum(shortMonth):</span>
<span id="cb1-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'January'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'February'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'March'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb1-11">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'April'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'May'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'June'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,</span>
<span id="cb1-12">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'July'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'August'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'September'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, </span>
<span id="cb1-13">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'October'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'November'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'December'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span></span>
<span id="cb1-14">    }[shortMonth]</span>
<span id="cb1-15">    </span>
<span id="cb1-16">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'month'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'month'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(monthToNum)</span>
<span id="cb1-17">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'date'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(df[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'year'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'month'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'day'</span>]])</span>
<span id="cb1-18"></span>
<span id="cb1-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#filter hotel resort and remove cancelations</span></span>
<span id="cb1-20">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'is_canceled'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> (df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'hotel'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Resort Hotel'</span>)]</span>
<span id="cb1-21">t_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.groupby([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'date'</span>])[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'hotel'</span>].count().reset_index().rename(columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'hotel'</span>:<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'date'</span>:<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ds'</span>})</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb2-2"></span>
<span id="cb2-3">plt.plot(t_df.ds, t_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y'</span>])</span>
<span id="cb2-4">plt.show()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/ts-forecast/hotel-booking/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>In a very naive and limited way let’s create a training and testing set (keeping only last month for testing). This is obviously a poor choices as ideally we would need to test multiple months.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">train_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t_df.loc[(t_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ds'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2015-01-01'</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> (t_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ds'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2017-08-01'</span>)]</span>
<span id="cb3-2">test_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t_df.loc[(t_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ds'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2017-08-01'</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> (t_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ds'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2017-09-01'</span>)]</span></code></pre></div>
</div>
<p>Using MAE (Mean Absolute Error) to estimate the suitability our model.</p>
<section id="method-1.-arima." class="level2">
<h2 class="anchored" data-anchor-id="method-1.-arima.">Method 1. Arima.</h2>


</section>
</section>

 ]]></description>
  <category>time-series</category>
  <category>forecasting</category>
  <guid>https://fderyckel.github.io/blog.html/posts/ts-forecast/hotel-booking/index.html</guid>
  <pubDate>Thu, 28 Dec 2023 17:00:00 GMT</pubDate>
</item>
<item>
  <title>KNN</title>
  <dc:creator>François de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/machine-learning-part1/knn/index.html</link>
  <description><![CDATA[ 




<p>Some very basic ML using KNN and python and the tidymodel framework.</p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>KNN stands for <em>K Nearest Neighbor</em>.</p>
<p>KNN is not really a machine learning techniques in the sense that it trains a model. In the case of KNN, there is no training. We are waiting for test data to see what label (or value) will the the new data will get. We then say that KNN is a lazy learner (as opposed to eager learners like SVM or RF). Nonetheless, it is a supervised ML algorithm that can be used for both classification and regression. The intuition behind the model is that observations that are closed to each other (close in terms of distance in a hyperplane) have similar labels (classification) or values (regression).</p>
<p>As mentioned, there is no training phase when using KNN. Instead, there is only prediction.<br>
We take an observation and check the <strong>K</strong> observations next to it. We check the label of the K observations next to our data to be labeled and using a majority voting system we assign the label. For regression, it calculates the average or weighted average of the target values of the K neighbors to predict the value for the input data point.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://fderyckel.github.io/blog.html/posts/machine-learning-part1/knn/knn01.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">KNN illustration</figcaption>
</figure>
</div>
<p>Looking at the above image, we can see that, using k=3, the 3 observations closest to the star (our data to be classified) are all brown circle. Hence we should classify the star as a brown circle instead of an orange rectangle.</p>
<div class="callout callout-style-simple callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Scaling
</div>
</div>
<div class="callout-body-container callout-body">
<p>Because KNN use distance, it is important to scale the data as a pre-processing steps. Otherwise, features with big scale (let’s say price) will skew the distance against features with lower scale (let’s say percentage).</p>
</div>
</div>
<p>Using probability terminology, one can say that KNN method is a direct attempt at approximating the conditional expectation using actual data.</p>
<p>In the case of <strong>regression</strong>, the estimation function could be written as <img src="https://latex.codecogs.com/png.latex?%5Chat%7Bf%7D(x)%20=%20%5Ctext%7BAverage%20%7D%20%5By_i%7Cx_i%20%5Cin%20%5Cmathcal%7BN%7D_k(x)%5D"> where <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BN%7D_k%20(x)"> is the neighborhood of x containing the k-closest observations.</p>
<p>In the case of <strong>classification</strong>, we use a majority voting system.</p>
<section id="pros-cons-of-knn" class="level2">
<h2 class="anchored" data-anchor-id="pros-cons-of-knn">Pros-Cons of KNN</h2>
<section id="pros" class="level3">
<h3 class="anchored" data-anchor-id="pros">Pros</h3>
<ul>
<li>Easy to understand intuition, mathematics (Euclidean Distance)</li>
<li>KNN is non-parametric. It’s not making any assumptions on the the type of distribution of the data</li>
<li>only one parameter to tune</li>
</ul>
</section>
<section id="cons" class="level3">
<h3 class="anchored" data-anchor-id="cons">Cons</h3>
<ul>
<li>non-efficient in terms of memory</li>
<li>non-efficient on speed of execution with new data</li>
<li>not suitable for high dimensional data</li>
<li>not suitable for big data sets</li>
</ul>
</section>
</section>
</section>
<section id="starting-example-with-simple-data" class="level1">
<h1>Starting example with simple data</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true">Python</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false">R</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-hash="index_cache/html/scatterplot1_99c48e654f7984d0c8bd33ea3bc26fe9">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span> , <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>]</span>
<span id="cb1-2">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>]</span>
<span id="cb1-3">classes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb1-4"></span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-7"></span>
<span id="cb1-8">plt.scatter(x, y, c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> classes)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/machine-learning-part1/knn/index_files/figure-html/scatterplot1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now let’s create a KNN object and a new point</p>
<div class="cell" data-hash="index_cache/html/scatterplot2_7abfe7bb22d8aae052fc2b56f0519406">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.neighbors <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> KNeighborsClassifier</span>
<span id="cb2-2"></span>
<span id="cb2-3">knn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> KNeighborsClassifier(n_neighbors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb2-4">knn.fit(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(x, y)), classes)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</a></style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>KNeighborsClassifier(n_neighbors=3)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;KNeighborsClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.neighbors.KNeighborsClassifier.html">?<span>Documentation for KNeighborsClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>KNeighborsClassifier(n_neighbors=3)</pre></div> </div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"></span>
<span id="cb3-2">new_x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb3-3">new_y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb3-4">new_point <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [(new_x, new_y)]</span>
<span id="cb3-5">prediction <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> knn.predict(new_point)</span>
<span id="cb3-6"></span>
<span id="cb3-7">plt.scatter(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> [new_x], y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> [new_y], c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> classes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> [prediction[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]])</span>
<span id="cb3-8">plt.text(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> new_x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> new_y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"new point, class:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>prediction[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/machine-learning-part1/knn/index_files/figure-html/scatterplot2-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-hash="index_cache/html/scatterplot1_r_1fed42550fd363f7d21e8e0bdc879949">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb4-3"></span>
<span id="cb4-4">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span> , <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>), </span>
<span id="cb4-5">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>), </span>
<span id="cb4-6">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">classes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)))</span>
<span id="cb4-7"></span>
<span id="cb4-8"></span>
<span id="cb4-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> classes)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'none'</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/machine-learning-part1/knn/index_files/figure-html/scatterplot1_r-5.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Using the tidymodel framework, we are first creating a recipe, then applying the transformation to the original data. We then apply these transformation to the new points as well. Using ‘parnsip’, we create the KNN object.</p>
<div class="cell" data-hash="index_cache/html/scatterplot2_r_9d37298e6fbcf06c0de0ec938e49eb78">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(recipes)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(parsnip)</span>
<span id="cb5-3"></span>
<span id="cb5-4">df_rec <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">recipe</span>(classes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> ., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_normalize</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>classes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prep</span>()</span>
<span id="cb5-7"></span>
<span id="cb5-8">df_juiced <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">juice</span>(df_rec)</span>
<span id="cb5-9"></span>
<span id="cb5-10">new_point <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>))</span>
<span id="cb5-11"></span>
<span id="cb5-12">df_baked <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bake</span>(df_rec, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">new_data =</span> new_point)</span>
<span id="cb5-13"></span>
<span id="cb5-14">knn_model <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nearest_neighbor</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">neighbors =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_engine</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'kknn'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_mode</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'classification'</span>)</span>
<span id="cb5-17"></span>
<span id="cb5-18">knn_fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> knn_model <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fit</span>(classes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_juiced)</span>
<span id="cb5-19">knn_fit</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>parsnip model object


Call:
kknn::train.kknn(formula = classes ~ ., data = data, ks = min_rows(3,     data, 5))

Type of response variable: nominal
Minimal misclassification: 0.1
Best kernel: optimal
Best k: 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># evaluate the model now on new data </span></span>
<span id="cb7-2">prediction <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">object =</span> knn_fit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">new_data =</span> df_baked)</span>
<span id="cb7-3">new_point_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_cols</span>(new_point, prediction) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">classes =</span> .pred_class)</span>
<span id="cb7-5"></span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(df, new_point_pred), </span>
<span id="cb7-7">       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> classes)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> new_point_pred, </span>
<span id="cb7-10">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'new point, class:'</span>, new_point_pred<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>classes)), </span>
<span id="cb7-11">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nudge_x =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nudge_y =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/machine-learning-part1/knn/index_files/figure-html/scatterplot2_r-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="example-with-synthetic-data" class="level1">
<h1>Example with synthetic data</h1>
<p>In this example, we create a data set of a 1000 observations (using numbers taken from a normal distribution with a sd of 2.). We’ll make 4 clusters of 250 observations. Because the data comes from a normal distribution, there is no need to scale them this time. We’ll then do a usual split 80-20 % for training and testing set. And we’ll test our data using either K = 5 or K = 19. And then check the accuracy score.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" aria-controls="tabset-2-1" aria-selected="true">Python</a></li><li class="nav-item"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" aria-controls="tabset-2-2" aria-selected="false">R</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" aria-labelledby="tabset-2-1-tab">
<div class="cell" data-hash="index_cache/html/scatterplot3_4b3619dd6837ef96842ac46c0733b534">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.datasets <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> make_blobs</span>
<span id="cb8-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.neighbors <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> KNeighborsClassifier</span>
<span id="cb8-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.model_selection <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> train_test_split</span>
<span id="cb8-4"></span>
<span id="cb8-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create our synthetic data</span></span>
<span id="cb8-6">X, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> make_blobs(n_samples <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, n_features <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, </span>
<span id="cb8-7">                  centers <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, cluster_std <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, </span>
<span id="cb8-8">                  random_state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb8-9"></span>
<span id="cb8-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># visualizing the dataset </span></span>
<span id="cb8-11">plt.scatter(X[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> y, s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/machine-learning-part1/knn/index_files/figure-html/scatterplot3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Splitting our dataset into training &amp; testing + running KNN on the data</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-6_f52c9c8b8d333dec9ad240a5161e21eb">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># spliting our data into training and testing</span></span>
<span id="cb9-2">X_train, X_test, y_train, y_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train_test_split(X, y, test_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, stratify <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> y, random_state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb9-3"></span>
<span id="cb9-4">knn5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> KNeighborsClassifier(n_neighbors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb9-5">knn19 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> KNeighborsClassifier(n_neighbors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>)</span>
<span id="cb9-6"></span>
<span id="cb9-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># fit our 'model' with either '5' or '19' Nearest Neighbors</span></span>
<span id="cb9-8">knn5.fit(X_train, y_train)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</a></style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>KNeighborsClassifier()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;KNeighborsClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.neighbors.KNeighborsClassifier.html">?<span>Documentation for KNeighborsClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>KNeighborsClassifier()</pre></div> </div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">knn19.fit(X_train, y_train)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-3 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-3 {
  color: var(--sklearn-color-text);
}

#sk-container-id-3 pre {
  padding: 0;
}

#sk-container-id-3 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-3 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-3 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-3 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-3 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-3 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-3 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-3 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-3 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-3 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-3 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-3 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-3 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-3 div.sk-label label.sk-toggleable__label,
#sk-container-id-3 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-3 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-3 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-3 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-3 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-3 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-3 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-3 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-3 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-3 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</a></style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>KNeighborsClassifier(n_neighbors=19)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" checked=""><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;KNeighborsClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.neighbors.KNeighborsClassifier.html">?<span>Documentation for KNeighborsClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>KNeighborsClassifier(n_neighbors=19)</pre></div> </div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># apply prediction on our test set</span></span>
<span id="cb11-2">y_pred_5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> knn5.predict(X_test)</span>
<span id="cb11-3">y_pred_19 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> knn19.predict(X_test)</span>
<span id="cb11-4"></span>
<span id="cb11-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.metrics <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> accuracy_score</span>
<span id="cb11-6"></span>
<span id="cb11-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Accuracy with K = 5 is'</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(accuracy_score(y_test, y_pred_5)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'%'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy with K = 5 is 89.0 %</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Accuracy with k = 19 is'</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(accuracy_score(y_test, y_pred_19)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'%'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy with k = 19 is 89.0 %</code></pre>
</div>
</div>
<p>Let’s visualize both ‘models’ and the impact of the choice of K.</p>
<div class="cell" data-hash="index_cache/html/scatterplot4_d01cc97b0bf7f705d5704f8fd2db7f38">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#using subplots to compare</span></span>
<span id="cb15-2">plt.figure(figsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb15-3"></span>
<span id="cb15-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># first subplot</span></span>
<span id="cb15-5">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb15-6">plt.scatter(X_test[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X_test[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> y_pred_5, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb15-7">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Predictions with K=5'</span>)</span>
<span id="cb15-8"></span>
<span id="cb15-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># second subplot</span></span>
<span id="cb15-10">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb15-11">plt.scatter(X_test[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X_test[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> y_pred_19, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb15-12">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Prediction with K=19'</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/machine-learning-part1/knn/index_files/figure-html/scatterplot4-3.png" class="img-fluid" width="864"></p>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" aria-labelledby="tabset-2-2-tab">
<div class="cell" data-hash="index_cache/html/scatterplot3_r_61cb76f19342d20c9510ddca99371f7f">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create our synthetic data</span></span>
<span id="cb16-2">df1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, </span>
<span id="cb16-3">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, </span>
<span id="cb16-4">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">classes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb16-5">df2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, </span>
<span id="cb16-6">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, </span>
<span id="cb16-7">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">classes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb16-8">df3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, </span>
<span id="cb16-9">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, </span>
<span id="cb16-10">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">classes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span>
<span id="cb16-11">df4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, </span>
<span id="cb16-12">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, </span>
<span id="cb16-13">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">classes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb16-14">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(df1, df2, df3, df4) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb16-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">classes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(classes))</span>
<span id="cb16-16"></span>
<span id="cb16-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># visualizing the dataset </span></span>
<span id="cb16-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> classes)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb16-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb16-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'none'</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/machine-learning-part1/knn/index_files/figure-html/scatterplot3_r-5.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This time, we split the data in a training / testing set.<br>
Also because the data were already scaled during the generative process; there is no need to redo that step.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-9_e61cbed499bed6834b5ee1c76136567e">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rsample)</span>
<span id="cb17-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(yardstick)</span>
<span id="cb17-3"></span>
<span id="cb17-4">df_split <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">initial_split</span>(df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prop =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strata =</span> classes)</span>
<span id="cb17-5">df_train <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">training</span>(df_split)</span>
<span id="cb17-6">df_test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">testing</span>(df_split)</span>
<span id="cb17-7"></span>
<span id="cb17-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#let's first try the ideal model</span></span>
<span id="cb17-9">knn_model_5 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nearest_neighbor</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">neighbors =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb17-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_engine</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'kknn'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb17-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_mode</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'classification'</span>)</span>
<span id="cb17-12"></span>
<span id="cb17-13">knn_model_19 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nearest_neighbor</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">neighbors =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb17-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_engine</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'kknn'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb17-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_mode</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'classification'</span>)</span>
<span id="cb17-16"></span>
<span id="cb17-17">knn_fit_5 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> knn_model_5 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fit</span>(classes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_train) </span>
<span id="cb17-18">knn5 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> knn_fit_5 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(df_test) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb17-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_cols</span>(df_test) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'knn5'</span>)</span>
<span id="cb17-20">knn5 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metrics</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">truth =</span> classes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">estimate =</span> .pred_class)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy multiclass     0.825
2 kap      multiclass     0.767</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">knn_fit_19 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> knn_model_19 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fit</span>(classes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_train)</span>
<span id="cb19-2">knn19 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> knn_fit_19 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(df_test) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb19-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_cols</span>(df_test) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'knn19'</span>)</span>
<span id="cb19-4">knn19 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span>  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">metrics</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">truth =</span> classes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">estimate =</span> .pred_class)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy multiclass     0.8  
2 kap      multiclass     0.733</code></pre>
</div>
</div>
<p>Let’s visualize both ‘models’ and the impact of the choice of K.</p>
<div class="cell" data-hash="index_cache/html/scatterplot5_r_36cf410316aec579bd98b891245a44ae">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">df_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(knn5, knn19)</span>
<span id="cb21-2"></span>
<span id="cb21-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df_pred, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> .pred_class)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb21-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> model, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb21-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb21-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'none'</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/machine-learning-part1/knn/index_files/figure-html/scatterplot5_r-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
<p>Because the data are already pretty well separated, the only changes we see easily are the ones in the junction between 2 clusters of observations.</p>
</section>
<section id="example-with-a-financial-time-series-dataset" class="level1">
<h1>Example with a financial / time-series dataset</h1>
<p>This time, we are going to use a stock price to perform KNN.</p>
<section id="loading-the-data-setting-up-and-feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-data-setting-up-and-feature-engineering">Loading the data, setting up and feature engineering</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" aria-controls="tabset-3-1" aria-selected="true">Python</a></li><li class="nav-item"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" aria-controls="tabset-3-2" aria-selected="false">R</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" aria-labelledby="tabset-3-1-tab">
<p>Loading and checking the data</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-11_aeeb9f57e291d4067b324ce330bb3c74">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb22-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb22-3"></span>
<span id="cb22-4">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'../../../raw_data/AA.csv'</span>)</span>
<span id="cb22-5">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'date'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'date'</span>])</span>
<span id="cb22-6">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.sort_values(by <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'date'</span>, inplace <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb22-7">df.set_index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'date'</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb22-8"></span>
<span id="cb22-9">df.shape</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(5821, 12)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1">df.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             open   high    low  ...   vwap           label  changeOverTime
date                             ...                                       
2001-01-02  80.50  80.95  76.60  ...  78.35  January 02, 01         -0.0373
2001-01-03  77.50  80.50  75.24  ...  78.10  January 03, 01          0.0135
2001-01-04  78.55  81.25  77.65  ...  80.00  January 04, 01          0.0325
2001-01-05  81.10  81.70  78.85  ...  80.05  January 05, 01         -0.0185
2001-01-08  79.60  85.91  79.00  ...  81.90  January 08, 01          0.0151

[5 rows x 12 columns]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1">plt.plot(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'adjClose'</span>])</span>
<span id="cb26-2">plt.show()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/machine-learning-part1/knn/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#only keep useful columns</span></span>
<span id="cb27-2">df1a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.drop([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'unadjustedVolume'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'change'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'changePercent'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'vwap'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'label'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'changeOverTime'</span>], axis <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb27-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#or easier actually ;-) </span></span>
<span id="cb27-4">df1b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.iloc[:, :<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>]</span>
<span id="cb27-5"></span>
<span id="cb27-6">df1a.describe()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              open         high  ...     adjClose        volume
count  5821.000000  5821.000000  ...  5821.000000  5.821000e+03
mean     46.372343    47.097133  ...    40.404558  6.519558e+06
std      24.755757    25.075361  ...    18.945874  5.452542e+06
min       5.500000     5.950000  ...     5.360000  4.254680e+05
25%      24.990000    25.420000  ...    23.620000  2.656970e+06
50%      38.260000    38.780000  ...    36.270000  5.129900e+06
75%      69.210000    69.980000  ...    56.910000  8.773242e+06
max     115.010000   117.190000  ...    96.360000  1.007518e+08

[8 rows x 6 columns]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check missing values</span></span>
<span id="cb29-2">df1a.isnull().<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>open        0
high        0
low         0
close       0
adjClose    0
volume      0
dtype: int64</code></pre>
</div>
</div>
<p>No missing values and we can go ahead!</p>
<p>Setting up a few predictors.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-12_e95c275259fccae74fa96979d4dfeecb">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb31-2">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o_c'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'open'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>]</span>
<span id="cb31-3">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'h_l'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'high'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'low'</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>]</span>
<span id="cb31-4">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ret_21d'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.log(df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>].shift(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>))</span>
<span id="cb31-5">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'roll_sd_ret21d_1Y'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ret_21d'</span>].rolling(window <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">251</span>).std()</span>
<span id="cb31-6">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'volum_sma200'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'volume'</span>].rolling(window <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>).mean()</span>
<span id="cb31-7">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'perc_above_volu_sma200'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.log(df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'volume'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'volum_sma200'</span>])</span>
<span id="cb31-8">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'roll_sd_volum_1Y'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'volume'</span>].rolling(window <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">251</span>).std()</span>
<span id="cb31-9">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sma50'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>].rolling(window <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>).mean()</span>
<span id="cb31-10">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'perc_above_sma50'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.log(df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sma50'</span>])</span>
<span id="cb31-11">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sma200'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>].rolling(window <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>).mean()</span>
<span id="cb31-12">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'perc_above_sma200'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.log(df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sma200'</span>])</span>
<span id="cb31-13">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'roll_corr_sma50_sma200'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sma200'</span>].rolling(window <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">252</span>).corr(df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sma50'</span>])</span>
<span id="cb31-14"></span>
<span id="cb31-15">df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'target'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.where(df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>].shift(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb31-16"></span>
<span id="cb31-17">df1a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a.drop([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'open'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'high'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'low'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'close'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'adjClose'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'volume'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sma50'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sma200'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'volum_sma200'</span>], axis <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb31-18">df1a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a.dropna()</span>
<span id="cb31-19">target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'target'</span>]</span>
<span id="cb31-20">df1a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1a.drop([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'target'</span>], axis <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb31-21"></span>
<span id="cb31-22"></span>
<span id="cb31-23">df1a.shape</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(5371, 9)</code></pre>
</div>
</div>
<p>Splitting the dataset for training and testing</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-13_546052e1516641d9bc82bb67bf065a62">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.model_selection <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> (train_test_split, GridSearchCV)</span>
<span id="cb33-2"></span>
<span id="cb33-3">x_train, x_test, y_train, y_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train_test_split(df1a, target, test_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, shuffle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb33-4"></span>
<span id="cb33-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"The size for the train and test dataset are </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(x_train)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(x_test)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> observations"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The size for the train and test dataset are 4296, 1075 observations</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" aria-labelledby="tabset-3-2-tab">
<div class="cell" data-hash="index_cache/html/unnamed-chunk-14_371b7915989f0ba0e0eac2dbc23e3f4a">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readr)</span>
<span id="cb35-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb35-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb35-4"></span>
<span id="cb35-5">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'../../../raw_data/AA.csv'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb35-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(date, open, high, low, close, volume)</span>
<span id="cb35-7"></span>
<span id="cb35-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> close)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb35-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/machine-learning-part1/knn/index_files/figure-html/unnamed-chunk-14-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check for missing values </span></span>
<span id="cb36-2">df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize_all</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">funs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(.))))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
   date  open  high   low close volume
  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;
1     0     0     0     0     0      0</code></pre>
</div>
</div>
<p>No missing values, we can go ahead!</p>
</div>
</div>
</div>
</section>
<section id="base-model" class="level2">
<h2 class="anchored" data-anchor-id="base-model">Base Model</h2>
<p>This is when we create the model and create the predictions.</p>
<p>Now we will start building our KNN model using a pipeline or a workflow (for R), First, we need to scale the data then we can go on the classification task.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" aria-controls="tabset-4-1" aria-selected="true">Python</a></li><li class="nav-item"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" aria-controls="tabset-4-2" aria-selected="false">R</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" aria-labelledby="tabset-4-1-tab">
<div class="cell" data-hash="index_cache/html/unnamed-chunk-15_d9ac8be33124b53d70ee9c624638c1ca">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.pipeline <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Pipeline</span>
<span id="cb38-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.preprocessing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> MinMaxScaler</span>
<span id="cb38-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.neighbors <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> KNeighborsClassifier</span>
<span id="cb38-4"></span>
<span id="cb38-5">knn_model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Pipeline([</span>
<span id="cb38-6">  (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'scaler'</span>, MinMaxScaler()), </span>
<span id="cb38-7">  (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'classifier'</span>, KNeighborsClassifier())</span>
<span id="cb38-8">])</span>
<span id="cb38-9"></span>
<span id="cb38-10">knn_model.fit(x_train, y_train)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-4 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-4 {
  color: var(--sklearn-color-text);
}

#sk-container-id-4 pre {
  padding: 0;
}

#sk-container-id-4 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-4 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-4 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-4 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-4 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-4 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-4 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-4 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-4 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-4 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-4 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-4 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-4 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-4 div.sk-label label.sk-toggleable__label,
#sk-container-id-4 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-4 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-4 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-4 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-4 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-4 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-4 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-4 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-4 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-4 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</a></style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('scaler', MinMaxScaler()),
                ('classifier', KNeighborsClassifier())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox"><label for="sk-estimator-id-4" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[('scaler', MinMaxScaler()),
                ('classifier', KNeighborsClassifier())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox"><label for="sk-estimator-id-5" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;MinMaxScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.MinMaxScaler.html">?<span>Documentation for MinMaxScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>MinMaxScaler()</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox"><label for="sk-estimator-id-6" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;KNeighborsClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.neighbors.KNeighborsClassifier.html">?<span>Documentation for KNeighborsClassifier</span></a></label><div class="sk-toggleable__content fitted"><pre>KNeighborsClassifier()</pre></div> </div></div></div></div></div></div>
</div>
</div>
<p>Go onto predictions</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-16_30b414048280bce04768f8dc7e9d1877">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.metrics <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> (accuracy_score, ConfusionMatrixDisplay, classification_report)</span>
<span id="cb39-2"></span>
<span id="cb39-3">y_pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> knn_model.predict(x_test)</span>
<span id="cb39-4"></span>
<span id="cb39-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># or we can also use a probability model </span></span>
<span id="cb39-6">y_pred_proba <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> knn_model.predict_proba(x_test)</span>
<span id="cb39-7"></span>
<span id="cb39-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># few checking</span></span>
<span id="cb39-9">knn_model.classes_</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([-1,  1])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1">y_pred_proba[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>:, ]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>array([[0.4, 0.6],
       [1. , 0. ],
       [0.8, 0.2],
       [0.4, 0.6],
       [0.8, 0.2],
       [0.6, 0.4],
       [0.8, 0.2],
       [0.8, 0.2],
       [1. , 0. ],
       [1. , 0. ]])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># checking accuracy</span></span>
<span id="cb43-2">acc_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> accuracy_score(y_train, knn_model.predict(x_train))</span>
<span id="cb43-3">acc_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> accuracy_score(y_test, knn_model.predict(x_test))</span>
<span id="cb43-4"></span>
<span id="cb43-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Accuracy for training set is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>acc_train<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:0.3}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> and Accuracy for testing set is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>acc_test<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:0.3}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy for training set is 0.886 and Accuracy for testing set is 0.582</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" aria-labelledby="tabset-4-2-tab">

</div>
</div>
</div>
</section>
<section id="checking-quality-of-predictions" class="level2">
<h2 class="anchored" data-anchor-id="checking-quality-of-predictions">Checking quality of predictions</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" aria-controls="tabset-5-1" aria-selected="true">Python</a></li><li class="nav-item"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" aria-controls="tabset-5-2" aria-selected="false">R</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" aria-labelledby="tabset-5-1-tab">
<div class="cell" data-hash="index_cache/html/unnamed-chunk-18_f827089f751f3f5acc21986f5256513f">
<div class="sourceCode cell-code" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1">conf_mat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ConfusionMatrixDisplay.from_estimator(</span>
<span id="cb45-2">  knn_model, x_test, y_test, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>plt.cm.Blues</span>
<span id="cb45-3">)</span>
<span id="cb45-4"></span>
<span id="cb45-5">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Confusion Matrix'</span>)</span>
<span id="cb45-6">plt.show()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/machine-learning-part1/knn/index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-19_6cdf5e2987935d7a193380af375a0579">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(classification_report(y_test, y_pred))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

          -1       0.64      0.81      0.71       687
           1       0.35      0.18      0.24       388

    accuracy                           0.58      1075
   macro avg       0.49      0.49      0.48      1075
weighted avg       0.53      0.58      0.54      1075</code></pre>
</div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-20_bfdfd564e06be7d321e6bf49bf69e953">
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.metrics <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> (roc_curve, RocCurveDisplay)</span>
<span id="cb48-2"></span>
<span id="cb48-3">rocCurve <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RocCurveDisplay.from_estimator(knn_model, x_test, y_test, name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Tuned KNN'</span>)</span>
<span id="cb48-4">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ROC Curve'</span>)</span>
<span id="cb48-5">plt.plot([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], linestyle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--'</span>, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Random 50:50'</span>)</span>
<span id="cb48-6">plt.legend()</span>
<span id="cb48-7">plt.show()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/machine-learning-part1/knn/index_files/figure-html/unnamed-chunk-20-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" aria-labelledby="tabset-5-2-tab">

</div>
</div>
</div>
</section>
<section id="hyperparameter-tuning" class="level2">
<h2 class="anchored" data-anchor-id="hyperparameter-tuning">Hyperparameter Tuning</h2>
<p>We can always try to fine tune our KNN algorithm to see if we can get a better result on our test set.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" aria-controls="tabset-6-1" aria-selected="true">Python</a></li><li class="nav-item"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" aria-controls="tabset-6-2" aria-selected="false">R</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" aria-labelledby="tabset-6-1-tab">
<div class="cell" data-hash="index_cache/html/unnamed-chunk-22_34b104a392745eb0d73bdd53a7f325e9">
<div class="sourceCode cell-code" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.model_selection <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> TimeSeriesSplit</span>
<span id="cb49-2"></span>
<span id="cb49-3">tscv <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TimeSeriesSplit(n_splits<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, gap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb49-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#for train, test in tscv.split(df1a): </span></span>
<span id="cb49-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  print(train, test)</span></span></code></pre></div>
</div>
<p>Let’s find the best parameters through a grid search</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-23_29c05172425caca39846f46e77942205">
<div class="sourceCode cell-code" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.model_selection <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> GridSearchCV</span>
<span id="cb50-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.metrics <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> roc_auc_score, auc</span>
<span id="cb50-3"></span>
<span id="cb50-4">knn_model.get_params()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'memory': None, 'steps': [('scaler', MinMaxScaler()), ('classifier', KNeighborsClassifier())], 'verbose': False, 'scaler': MinMaxScaler(), 'classifier': KNeighborsClassifier(), 'scaler__clip': False, 'scaler__copy': True, 'scaler__feature_range': (0, 1), 'classifier__algorithm': 'auto', 'classifier__leaf_size': 30, 'classifier__metric': 'minkowski', 'classifier__metric_params': None, 'classifier__n_jobs': None, 'classifier__n_neighbors': 5, 'classifier__p': 2, 'classifier__weights': 'uniform'}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1">param_grid <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'classifier__n_neighbors'</span>: np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)}</span>
<span id="cb52-2"></span>
<span id="cb52-3">gs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> GridSearchCV(knn_model, param_grid, scoring <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'roc_auc'</span>, n_jobs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, cv <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tscv, verbose <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb52-4">gs.fit(x_train, y_train)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-5 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-5 {
  color: var(--sklearn-color-text);
}

#sk-container-id-5 pre {
  padding: 0;
}

#sk-container-id-5 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-5 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-5 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-5 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-5 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-5 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-5 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-5 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-5 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-5 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-5 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-5 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-5 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-5 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-5 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-5 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-5 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-5 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-5 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-5 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-5 div.sk-label label.sk-toggleable__label,
#sk-container-id-5 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-5 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-5 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-5 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-5 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-5 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-5 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-5 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-5 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-5 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-5 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</a></style><div id="sk-container-id-5" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=TimeSeriesSplit(gap=10, max_train_size=None, n_splits=10, test_size=None),
             estimator=Pipeline(steps=[('scaler', MinMaxScaler()),
                                       ('classifier', KNeighborsClassifier())]),
             n_jobs=-1,
             param_grid={'classifier__n_neighbors': array([ 2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
       19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,
       36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50])},
             scoring='roc_auc', verbose=1)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox"><label for="sk-estimator-id-7" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;GridSearchCV<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.model_selection.GridSearchCV.html">?<span>Documentation for GridSearchCV</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>GridSearchCV(cv=TimeSeriesSplit(gap=10, max_train_size=None, n_splits=10, test_size=None),
             estimator=Pipeline(steps=[('scaler', MinMaxScaler()),
                                       ('classifier', KNeighborsClassifier())]),
             n_jobs=-1,
             param_grid={'classifier__n_neighbors': array([ 2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18,
       19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,
       36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50])},
             scoring='roc_auc', verbose=1)</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox"><label for="sk-estimator-id-8" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">estimator: Pipeline</label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[('scaler', MinMaxScaler()),
                ('classifier', KNeighborsClassifier())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox"><label for="sk-estimator-id-9" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;MinMaxScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.MinMaxScaler.html">?<span>Documentation for MinMaxScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>MinMaxScaler()</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox"><label for="sk-estimator-id-10" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;KNeighborsClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.neighbors.KNeighborsClassifier.html">?<span>Documentation for KNeighborsClassifier</span></a></label><div class="sk-toggleable__content fitted"><pre>KNeighborsClassifier()</pre></div> </div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb53" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Optimal Neighbours: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>gs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>best_params_[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'classifier__n_neighbors'</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, Best, Score: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(gs.best_score_,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal Neighbours: 49, Best, Score: 0.4906</code></pre>
</div>
</div>
<p>Let’s now use the best parameter found for our model.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-24_c1a04004a0f279156fe61713e3070afc">
<div class="sourceCode cell-code" id="cb55" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1">tuned_knn_model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> KNeighborsClassifier(n_neighbors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gs.best_params_[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'classifier__n_neighbors'</span>])</span>
<span id="cb55-2"></span>
<span id="cb55-3">tuned_knn_model.fit(x_train, y_train)</span></code></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-6 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-6 {
  color: var(--sklearn-color-text);
}

#sk-container-id-6 pre {
  padding: 0;
}

#sk-container-id-6 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-6 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-6 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-6 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-6 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-6 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-6 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-6 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-6 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-6 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-6 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-6 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-6 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-6 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-6 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-6 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-6 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-6 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-6 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-6 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-6 div.sk-label label.sk-toggleable__label,
#sk-container-id-6 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-6 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-6 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-6 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-6 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-6 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-6 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-6 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-6 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-6 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-6 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</a></style><div id="sk-container-id-6" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>KNeighborsClassifier(n_neighbors=49)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" checked=""><label for="sk-estimator-id-11" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;KNeighborsClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.neighbors.KNeighborsClassifier.html">?<span>Documentation for KNeighborsClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>KNeighborsClassifier(n_neighbors=49)</pre></div> </div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1">y_pred_tuned <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tuned_knn_model.predict(x_test)</span>
<span id="cb56-2"></span>
<span id="cb56-3">acc_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> accuracy_score(y_train, tuned_knn_model.predict(x_train))</span>
<span id="cb56-4">acc_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> accuracy_score(y_test, y_pred_tuned)</span>
<span id="cb56-5"></span>
<span id="cb56-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> Training Accuracy </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>acc_train <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:0.4}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> Test Accuracy </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t\t</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>acc_test <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:0.4}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Training Accuracy  : 0.7691 
 Test Accuracy      : 0.6186</code></pre>
</div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-25_0e1d45e5697feddcec3109646b9ea6c7">
<div class="sourceCode cell-code" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1">disp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ConfusionMatrixDisplay.from_estimator(</span>
<span id="cb58-2">        tuned_knn_model,</span>
<span id="cb58-3">        x_test,</span>
<span id="cb58-4">        y_test,</span>
<span id="cb58-5">        display_labels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tuned_knn_model.classes_,</span>
<span id="cb58-6">        cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>plt.cm.Blues</span>
<span id="cb58-7">    )</span>
<span id="cb58-8">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Confusion matrix'</span>)</span>
<span id="cb58-9">plt.show()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/machine-learning-part1/knn/index_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-26_76e9cf58831fce7232d9709bea7d3492">
<div class="sourceCode cell-code" id="cb59" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(classification_report(y_test, y_pred_tuned))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

          -1       0.63      0.95      0.76       687
           1       0.27      0.03      0.06       388

    accuracy                           0.62      1075
   macro avg       0.45      0.49      0.41      1075
weighted avg       0.50      0.62      0.51      1075</code></pre>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" aria-labelledby="tabset-6-2-tab">

</div>
</div>
</div>
</section>
</section>
<section id="example-with-the-adult-dataset-from-kaggle" class="level1">
<h1>Example with the adult dataset (from Kaggle)</h1>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-28_44993e3b8779934eed892382e414d9b1">
<div class="sourceCode cell-code" id="cb61" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb61-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb61-3"></span>
<span id="cb61-4">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'../../../raw_data/adult.csv'</span>)</span>
<span id="cb61-5">data.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   age  workclass  fnlwgt  ... hours-per-week  native-country income
0   25    Private  226802  ...             40   United-States  &lt;=50K
1   38    Private   89814  ...             50   United-States  &lt;=50K
2   28  Local-gov  336951  ...             40   United-States   &gt;50K
3   44    Private  160323  ...             40   United-States   &gt;50K
4   18          ?  103497  ...             30   United-States  &lt;=50K

[5 rows x 15 columns]</code></pre>
</div>
</div>
<p>Doing some cleaning of data. All the cleaning ideas come from the Kaggle notebooks (I have not deeply analysed the data)</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-29_ffd2829ce62a06ef12c86c2b0f4b3f10">
<div class="sourceCode cell-code" id="cb63" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># in a few columns, many cells have '?', let's replace those with Nan</span></span>
<span id="cb63-2">data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'workclass'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'workclass'</span>].replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'?'</span>, np.nan)</span>
<span id="cb63-3">data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'occupation'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'occupation'</span>].replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'?'</span>, np.nan)</span>
<span id="cb63-4">data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'native-country'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'native-country'</span>] .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'?'</span>, np.nan)</span>
<span id="cb63-5"></span>
<span id="cb63-6">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.copy()</span>
<span id="cb63-7"></span>
<span id="cb63-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dropping row with NA</span></span>
<span id="cb63-9">df.dropna(how <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'any'</span>, inplace <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb63-10"></span>
<span id="cb63-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dropping dupplicates rows</span></span>
<span id="cb63-12">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.drop_duplicates()</span>
<span id="cb63-13"></span>
<span id="cb63-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># drop columns </span></span></code></pre></div>
</div>


</section>

 ]]></description>
  <category>ML</category>
  <category>KNN</category>
  <guid>https://fderyckel.github.io/blog.html/posts/machine-learning-part1/knn/index.html</guid>
  <pubDate>Mon, 13 Nov 2023 17:00:00 GMT</pubDate>
</item>
<item>
  <title>Discrete Probability Simulations in R</title>
  <dc:creator>Francois de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/proba-quant/discrete-simulations/index.html</link>
  <description><![CDATA[ 




<p>The idea behind this post is to collect various numerical methods to simulate discrete probability problems.</p>
<section id="expectation-of-a-uniform-variable." class="level1">
<h1>Expectation of a uniform variable.</h1>
<p>Question: what is the expectation if one square a number that is picked at random out of a hat (with replacement) that contains the numbers 1 to 100.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">expec <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(expec)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3376.422</code></pre>
</div>
</div>
<p>The calculated expectation should be: <img src="https://latex.codecogs.com/png.latex?%5Csum_%7Bx=1%7D%5E%7B100%7D%20x%5E2%20P(X=x)%20=%20%5Csum_%7Bx=1%7D%5E%7B100%7D%20x%5E2%20%5Cfrac%7B1%7D%7Bn%7D%20=%20%5Cfrac%7B101%20%5Ccdot%20201%7D%7B6%7D%20=%203383.5"></p>
<p>We could connect this to the <a href="../../../posts/proba-quant/jensen-inequality/index.html">Jensen’s inequality</a> (as we are dealing with a convex function) and show that indeed the expectation of the function is greater than the function of the expectation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">exp_square <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb3-2">square_exp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(exp_square)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3389.124</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(square_exp)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2550.72</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>statistics</category>
  <category>code</category>
  <category>analysis</category>
  <guid>https://fderyckel.github.io/blog.html/posts/proba-quant/discrete-simulations/index.html</guid>
  <pubDate>Mon, 13 Nov 2023 17:00:00 GMT</pubDate>
</item>
<item>
  <title>Jensen’s Inequality</title>
  <dc:creator>Francois de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/proba-quant/jensen-inequality/index.html</link>
  <description><![CDATA[ 




<p>Jensen’s inequality from <a href="https://en.wikipedia.org/wiki/Johan_Jensen_(mathematician)">Johan Jensen</a>, Danish Mathematician, has popped up several times through my quantitative finance journey. As I never explicitly dealt with it, I thought I’ll make a post about it.</p>
<p>The question Jensen’s inequality address is how does the mean of a function relate the function of the mean. First, we’ll check how in the case of linear functions, there are no difference there. Then we’ll go on more complex functions where their concavity (aka second derivative) matters.</p>
<section id="linear-transformations-of-random-variables" class="level1">
<h1>Linear transformations of Random Variables</h1>
<p>What happen when we transform in a linear way a random variable?</p>
<p>We claim that as long as <em>f</em> is linear: <strong>mean(f(x)) == f(mean(x))</strong></p>
<p>Let’s use an easy &amp; simple example. A fair dice is thrown. Let’s imagine a payoff which is a linear function: say, the payoff is <img src="https://latex.codecogs.com/png.latex?2%20*%20%5Ctext%7B(face%20of%20the%20die)%7D%20+%203">.</p>
<p>In this case <img src="https://latex.codecogs.com/png.latex?X"> is a discrete random variable that can take the values <img src="https://latex.codecogs.com/png.latex?%7B1,%202,%203,%204,%205,%206%7D">.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># function to define the payoff</span></span>
<span id="cb1-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> payoff(x): </span>
<span id="cb1-5">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># let's define the outcome of our discrete random variable. </span></span>
<span id="cb1-8">outcomes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># let's calculate the payoff for each outcome</span></span>
<span id="cb1-11">payoffs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [payoff(outcome) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> outcome <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> outcomes]</span></code></pre></div>
</div>
<p>With linear transformations and in this example, we have <strong>the mean of the payoff that is equal to the payoff of the mean</strong>.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"The mean of the outcomes [1, 2, 3, 4, 5, 6] is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>mean(outcomes)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb2-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"The payoff of the mean is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>payoff(np.mean(outcomes))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb2-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"The payoffs are </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>payoffs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> and the mean of the payoffs is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>mean(payoffs)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The mean of the outcomes [1, 2, 3, 4, 5, 6] is 3.5
The payoff of the mean is 10.0
The payoffs are [5, 7, 9, 11, 13, 15] and the mean of the payoffs is 10.0</code></pre>
</div>
</div>
<p>Now this equality doesn’t hold anymore when it comes to non-linear function.</p>
</section>
<section id="convex-transformations-of-random-variables" class="level1">
<h1>Convex transformations of Random Variables</h1>
<p>The <strong>Jensen’s inequality</strong> is in regards to <strong>convex</strong> functions (aka its second derivative is positive on an interval) and states that <em>the mean of the transformation is always greater or equal to the transformation of the mean</em>.</p>
<p>Using the language of probability, we can write that for any convex functions <span id="eq-jensineq"><img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5Bf(X)%5D%20%5Cgeq%20f(%5Cmathbb%7BE%7D%5BX%5D)%20%5Ctag%7B1%7D"></span></p>
<p>Again let’s take an easy example with the convex function <img src="https://latex.codecogs.com/png.latex?f(x)%20=%20X%5E2">. We will use the same inputs (the roll of a die) as the above example.</p>
<p>The intuition is that the mean of squared numbers is greater than the square of the mean numbers. This is because bigger number squared will add extreme value (on the high side) to the mean.</p>
<p>Using a small Python script.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">outcomes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]</span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># defining our transform functions. </span></span>
<span id="cb4-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> payoff(x): </span>
<span id="cb4-5">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb4-6"></span>
<span id="cb4-7">payoffs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [payoff(outcome) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> outcome <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> outcomes]</span>
<span id="cb4-8">payoffs</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>[1, 4, 9, 16, 25, 36]</code></pre>
</div>
</div>
<p>Let’s now calculate both <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5Bf(X)%5D"> and <img src="https://latex.codecogs.com/png.latex?f(%5Cmathbb%7BE%7D%5BX%5D)"></p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"The mean of the transformed outcomes is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(np.mean(payoffs), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"The transformed of the mean is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>payoff(np.mean(outcomes))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The mean of the transformed outcomes is 15.167
The transformed of the mean is 12.25</code></pre>
</div>
</div>
<p>When is it an equality then? When all the observations in the sets have the exact same values, then <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5Bf(X)%5D%20=%20f(%5Cmathbb%7BE%7D%5BX%5D)">.</p>
<p>Visually, we could see this on the parabola. <img src="https://fderyckel.github.io/blog.html/posts/proba-quant/jensen-inequality/jensen-parabola.png" class="img-fluid" alt="The mean of the squares greater than the square of the mean"></p>
<section id="simulation" class="level2">
<h2 class="anchored" data-anchor-id="simulation">Simulation</h2>
<p>To make our experiment a bit more realistic, we could simulate 50 roll of dice and check that the Jensen’s inequality still hold. Our convex function is stil <img src="https://latex.codecogs.com/png.latex?f(x)=X%5E2">.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">outcomes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.randint(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb8-2"></span>
<span id="cb8-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> payoff(x): </span>
<span id="cb8-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb8-5"></span>
<span id="cb8-6">payoffs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [payoff(outcome) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> outcome <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> outcomes]</span></code></pre></div>
</div>
<p>And let’s again compare the mean of the transformed vs the transformed of the mean.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"The mean of the transformed outcomes is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>mean(payoffs)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb9-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"The transformed of the mean is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>payoff(np.mean(outcomes))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The mean of the transformed outcomes is 14.2
The transformed of the mean is 11.0224</code></pre>
</div>
</div>
</section>
</section>
<section id="jensens-inequality-in-finance" class="level1">
<h1>Jensen’s inequality in finance</h1>
<section id="arithmetic-mean-vs-geometric-mean" class="level2">
<h2 class="anchored" data-anchor-id="arithmetic-mean-vs-geometric-mean">Arithmetic mean vs Geometric mean</h2>
<p>One way, the Jensen’s inequality is used in finance is when it comes to returns. We can indeed compute the average returns as a arithmetic average or as a geometric average.</p>
<p>Let’s say, we have a data set with n observations. Then we define, the arithmetic mean as <img src="https://latex.codecogs.com/png.latex?AM%20=%20%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bi=1%7D%5En%20i"> and the geometric mean as <img src="https://latex.codecogs.com/png.latex?GM%20=%20%5Cleft(%20%5Cprod_%7Bi=1%7D%5En%20i%20%5Cright)%5E%7B%5Cfrac%7B1%7D%7Bn%7D%7D"></p>
<p>Using logarithms, and starting with the arithmetic mean, we have: <span id="eq-logAM"><img src="https://latex.codecogs.com/png.latex?log(AM)%20=%20log%20%5Cleft(%20%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bi=1%7D%5En%20i%20%5Cright)%20%5Ctag%7B2%7D"></span></p>
<p>Continuing with the geometric mean, we have: <span id="eq-logGM"><img src="https://latex.codecogs.com/png.latex?log%20(GM)%20=%20log%20%5Cleft(%20%5Cprod_%7Bi=1%7D%5En%20i%20%5Cright)%5E%7B%5Cfrac%7B1%7D%7Bn%7D%7D%20=%20%5Cfrac%7B1%7D%7Bn%7D%20log%20%5Cleft(%20%5Cprod_%7Bi=1%7D%5En%20i%20%5Cright)%20=%20%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bi=1%7D%5En%20log(i)%20%5Ctag%7B3%7D"></span></p>
<p>We could transform Equation&nbsp;3 saying that the geometric mean is the exponential of the arithmetic mean. <span id="eq-logGM2"><img src="https://latex.codecogs.com/png.latex?GM%20=%20exp%20%5Cleft(%20%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bi=1%7D%5En%20i%20%5Cright)%20%5Ctag%7B4%7D"></span></p>
<p>Back to Jensens’s inequality.<br>
The log function is a concave function. We just re-write Equation&nbsp;1 changing the inequality sign: <em>the mean of the transformation is less or equal to the transformation of the mean</em>. On probabilistic terms, <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5Bf(X)%5D%20%5Cleq%20f(%5Cmathbb%7BE%7D%5BX%5D)"></p>
<p><img src="https://latex.codecogs.com/png.latex?log(GM)%20=%20%5Ctext%7Bmean%20of%20the%20transformation%20(log)%7D"> <img src="https://latex.codecogs.com/png.latex?log(AM)%20=%20%5Ctext%7Btransformation%20(log)%20of%20the%20mean%7D"></p>
<p>If we go back to our dice throwing example, we should see that the <img src="https://latex.codecogs.com/png.latex?log(GM)%20%3C=%20log(AM)">. Let’s model that</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">outcomes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>]</span>
<span id="cb11-2">mean_outcomes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(outcomes)</span>
<span id="cb11-3"></span>
<span id="cb11-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> payoff(x): </span>
<span id="cb11-5">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> np.log(x)</span>
<span id="cb11-6"></span>
<span id="cb11-7">payoffs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [payoff(outcome) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> outcome <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> outcomes]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Log(GM) - The mean of the transformed (log) is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>mean(payoffs)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Log(AM) - The transformed (log) of the mean is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>log(np.mean(outcomes))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Log(GM) - The mean of the transformed (log) is 1.0965418686683501
Log(AM) - The transformed (log) of the mean is 1.252762968495368</code></pre>
</div>
</div>
<p>This match our initial statement. mean of the transformed being smaller than the transformed of the mean as the transformation is concave!</p>
<p>And we can undo that log using an exponent (which will preserve the inequality sign). Hence GM &lt; AM. In finance, especially portfolio management, GM means are preferred as it is taking into account the compounding effect of the returns.</p>
</section>
<section id="options-convexity" class="level2">
<h2 class="anchored" data-anchor-id="options-convexity">Options convexity</h2>
<p>We are talking about the convexity of options to draw the attention on the non-linear relationship (in this case convex relationship … duh!) between the option’s price and the price of its underlying asset.<br>
This comes from the second order derivative of the option’s price in regards to the price of the underlying. In the Black-Schole Merton equation, this can be seen as: <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%7BV%7D%7D%7B%5Cpartial%7Bt%7D%7D%20+%20%5Ccolor%7Bblue%7D%7B%5Cfrac%7B1%7D%7B2%7D%20%5Csigma%5E2%20S%5E2%20%5Cfrac%7B%5Cpartial%5E2%7BV%7D%7D%7B%5Cpartial%7BS%7D%5E2%7D%7D%20+%20r%20S%20%5Cfrac%7B%5Cpartial%7BV%7D%7D%7B%5Cpartial%7BS%7D%7D%20-%20rV%20=%200"></p>
<p>Recall the value of a vanilla European call option at expiration is <img src="https://latex.codecogs.com/png.latex?C(S)%20=%20max(S-K,%200)"> where:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?K"> is the strike price</li>
<li><img src="https://latex.codecogs.com/png.latex?S"> is the price of the underlying</li>
<li><img src="https://latex.codecogs.com/png.latex?C(S)"> is the value of the option price at expiry</li>
<li><img src="https://latex.codecogs.com/png.latex?S-K"> is a linear relationship</li>
</ul>
<p>But the rate of change of the option price in regards to its underlying is not linear.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb14-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> norm</span>
<span id="cb14-3"></span>
<span id="cb14-4">S0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initial stock price</span></span>
<span id="cb14-5">K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Strike price</span></span>
<span id="cb14-6">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Risk-free rate</span></span>
<span id="cb14-7">T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Time to maturity</span></span>
<span id="cb14-8">sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Volatility</span></span>
<span id="cb14-9"></span>
<span id="cb14-10">S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb14-11"></span>
<span id="cb14-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Black-Scholes call option price formula</span></span>
<span id="cb14-13">d1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (np.log(S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> K) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> T) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(T))</span>
<span id="cb14-14">d2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> d1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(T)</span>
<span id="cb14-15"></span>
<span id="cb14-16">C <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.cdf(d1) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> T) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.cdf(d2)</span>
<span id="cb14-17"></span>
<span id="cb14-18">delta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.gradient(C, S)</span>
<span id="cb14-19">gamma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.gradient(delta, S)</span>
<span id="cb14-20"></span>
<span id="cb14-21">plt.figure(figsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb14-22"></span>
<span id="cb14-23">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">131</span>)</span>
<span id="cb14-24">plt.plot(S, C, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Option Price'</span>)</span>
<span id="cb14-25">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Asset Price'</span>)</span>
<span id="cb14-26">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Option Value'</span>)</span>
<span id="cb14-27"></span>
<span id="cb14-28">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">132</span>)</span>
<span id="cb14-29">plt.plot(S, delta, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Delta'</span>)</span>
<span id="cb14-30">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Asset Price'</span>)</span>
<span id="cb14-31">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Delta'</span>)</span>
<span id="cb14-32"></span>
<span id="cb14-33">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">133</span>)</span>
<span id="cb14-34">plt.plot(S, gamma, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gamma'</span>)</span>
<span id="cb14-35">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Asset Price'</span>)</span>
<span id="cb14-36">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gamma'</span>)</span>
<span id="cb14-37"></span>
<span id="cb14-38">plt.tight_layout()</span>
<span id="cb14-39">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/proba-quant/jensen-inequality/index_files/figure-html/cell-10-output-1.png" width="1141" height="566"></p>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>Probability</category>
  <category>Jensen&#39;s inequality</category>
  <category>arithmetic mean</category>
  <category>geometric mean</category>
  <guid>https://fderyckel.github.io/blog.html/posts/proba-quant/jensen-inequality/index.html</guid>
  <pubDate>Fri, 20 Oct 2023 17:00:00 GMT</pubDate>
  <media:content url="https://fderyckel.github.io/blog.html/posts/proba-quant/jensen-inequality/jensen-parabola.png" medium="image" type="image/png" height="168" width="144"/>
</item>
<item>
  <title>Modeling Option prices using Monte-Carlo simulations</title>
  <dc:creator>Francois de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/quant-part3/monte-carlo-sim/index.html</link>
  <description><![CDATA[ 




<p>Recall Monte-Carlo method exploits the relationship between options prices and expectation under a risk-neutral measure. It is the present value of the expectation (under a risk-neutral measure) of the payoff. In this sense <img src="https://latex.codecogs.com/png.latex?V(S,%20t)%20=%20%5Ctext%7BPV%7D%20%5Cspace%20%5Cspace%20%5Cmathbb%7BE%7D%5E%5Cmathbb%7BQ%7D%20(Payoff)"></p>
<p>We start with the usual SDE (except we use <img src="https://latex.codecogs.com/png.latex?r"> instead of <img src="https://latex.codecogs.com/png.latex?%5Cmu"> as we are under the risk-neutral framework). <img src="https://latex.codecogs.com/png.latex?dS_t%20=%20r%20S_t%20dt%20+%20%5Csigma%20S_t%20dW_t"> Using the Euler discretization <img src="https://latex.codecogs.com/png.latex?S_%7Bt%20+%20%5Cdelta%20t%7D%20=%20S_t%20%5Ccdot%20(1%20+%20r%20%5Cdelta%20t%20+%20%5Csigma%20%5Csqrt%7B%5Cdelta%20t%7D%20%5Cphi)"></p>
<section id="using-python" class="level2">
<h2 class="anchored" data-anchor-id="using-python">Using Python</h2>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> simulate_path(s0, mu, sigma, Time, num_timestep, n_sim): </span>
<span id="cb1-5">  </span>
<span id="cb1-6">  np.random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20230902</span>)</span>
<span id="cb1-7">  </span>
<span id="cb1-8">  S0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s0</span>
<span id="cb1-9">  r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mu</span>
<span id="cb1-10">  T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Time</span>
<span id="cb1-11">  t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> num_timestep </span>
<span id="cb1-12">  n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n_sim </span>
<span id="cb1-13">  </span>
<span id="cb1-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#defining dt</span></span>
<span id="cb1-15">  dt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>t</span>
<span id="cb1-16">  </span>
<span id="cb1-17">  S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((t, n))</span>
<span id="cb1-18">  S[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> S0</span>
<span id="cb1-19">  </span>
<span id="cb1-20">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>): </span>
<span id="cb1-21">    w <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.standard_normal(n)</span>
<span id="cb1-22">    S[i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> S[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(dt) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> w)</span>
<span id="cb1-23">  </span>
<span id="cb1-24">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> S</span></code></pre></div>
</div>
<p>Let’s create a simulation for a quarter of a year (3 months or 63 trading days).</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">simulate_path(s0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, mu<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.045</span>, sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.17</span>, Time<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>, num_timestep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63</span>, n_sim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>array([[100.        , 100.        , 100.        , ..., 100.        ,
        100.        , 100.        ],
       [ 99.39825714, 100.88405395, 100.17361119, ..., 100.79029332,
         98.89439673,  99.86236711],
       [ 99.50936214, 100.97945468,  99.7824842 , ...,  98.66331487,
         98.67131431, 100.50278255],
       ...,
       [100.32398459, 110.16941406,  95.79494772, ..., 101.76681189,
         91.43131552,  98.94795092],
       [100.93630069, 111.0365789 ,  94.89177952, ..., 101.32109813,
         93.37392012,  98.42725475],
       [101.17836924, 110.76099538,  95.51591487, ..., 101.28364139,
         92.50938162,  96.80815562]])</code></pre>
</div>
</div>
<p>Let’s put that into a data frame for further plotting and manipulation</p>
<p>Note each column of the data frame is a simulation. The number of rows is the number of time steps.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">simulated_paths <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(simulate_path(s0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, mu<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.045</span>, sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.17</span>, Time<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>, num_timestep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63</span>, n_sim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))</span></code></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">simulated_paths.iloc[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].hist(bins <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>&lt;Axes: &gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part3/monte-carlo-sim/index_files/figure-html/cell-5-output-2.png" width="558" height="411"></p>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb7-2">plt.plot(simulated_paths)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#plot the first 100 paths</span></span>
<span id="cb7-3">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'time steps'</span>)</span>
<span id="cb7-4">plt.xlim(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>)</span>
<span id="cb7-5">plt.ylim(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">135</span>)</span>
<span id="cb7-6">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Pries'</span>)</span>
<span id="cb7-7">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Monte-Carlo Simulation of an Asset Price'</span>)</span>
<span id="cb7-8">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part3/monte-carlo-sim/index_files/figure-html/cell-6-output-1.png" width="593" height="449"></p>
</div>
</div>
<p>Under the risk-neutral measure, the value of the option is the discounted value of the expected payoff. <img src="https://latex.codecogs.com/png.latex?C%20=%20e%5E%7BrT%7D%20%5Ccdot%20%5Cmathbb%7BE%7D%5Bmax(S_T%20-%20K,%200)%5D"></p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?K"> is the strike price</li>
</ul>
<p>For this simulation, we let <img src="https://latex.codecogs.com/png.latex?K=100"> as well!</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb8-2">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.045</span></span>
<span id="cb8-3">T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span> </span>
<span id="cb8-4"></span>
<span id="cb8-5">S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> simulate_path(s0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, mu<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.045</span>, sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.17</span>, Time<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>, num_timestep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63</span>, n_sim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>)</span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## calculate payoff for call options </span></span>
<span id="cb8-8">Co <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>T) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.mean(np.maximum(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, S[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>K))</span>
<span id="cb8-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## calculate payoff for put options </span></span>
<span id="cb8-10">Po <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>T) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.mean(np.maximum(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> S[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]))</span>
<span id="cb8-11"></span>
<span id="cb8-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"European Call Option value is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>Co<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: 0.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"European Put Option value is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>Po<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: 0.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>European Call Option value is  3.8587
European Put Option value is  2.7757</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb10-2"></span>
<span id="cb10-3">sT<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb10-4"></span>
<span id="cb10-5">figure, axes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>), sharey <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb10-6">title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Call payoff'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Put payoff'</span>]</span>
<span id="cb10-7">payoff <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [np.maximum(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, sT<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>K), np.maximum(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, K<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>sT)] </span>
<span id="cb10-8">color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'green'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>] </span>
<span id="cb10-9">label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Call'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Put'</span>]</span>
<span id="cb10-10"></span>
<span id="cb10-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>): </span>
<span id="cb10-12">  axes[i].plot(sT, payoff[i], color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> color[i], label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> label[i])</span>
<span id="cb10-13">  axes[i].set_title(title[i])</span>
<span id="cb10-14">  axes[i].legend()</span>
<span id="cb10-15"></span>
<span id="cb10-16">figure.suptitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Option Payoff at Maturity'</span>)</span>
<span id="cb10-17"></span>
<span id="cb10-18">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part3/monte-carlo-sim/index_files/figure-html/cell-8-output-1.png" width="1533" height="543"></p>
</div>
</div>
</section>
<section id="asian-options" class="level1">
<h1>Asian Options</h1>
<p>We are taking the averages of a given asset prices.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">A <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(S, axis <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># axis = 0, mean is over the columns ==&gt; results is 1000 means. We had a 1000 simulations of 63 steps. </span></span>
<span id="cb11-2">B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(S, axis <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># axis = 1, mean is row by row  ==&gt; results is 63 means</span></span>
<span id="cb11-3"></span>
<span id="cb11-4">K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb11-5">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.045</span></span>
<span id="cb11-6">T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span> </span>
<span id="cb11-7">S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> simulate_path(s0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, mu<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.045</span>, sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.17</span>, Time<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>, num_timestep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63</span>, n_sim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>)</span>
<span id="cb11-8"></span>
<span id="cb11-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># do not use S[-1] anymore (the last prices), but the average instead (here it is A)</span></span>
<span id="cb11-10">Co <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> T) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.mean(np.maximum(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, A <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> K))</span>
<span id="cb11-11">Po <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> T) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.mean(np.maximum(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> A))</span>
<span id="cb11-12"></span>
<span id="cb11-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Asian Call Option value is: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>Co<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: 0.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb11-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Asian Put Option Value is: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>Po<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:0.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span></code></pre></div>
</div>
</section>
<section id="barrier-options." class="level1">
<h1>Barrier options.</h1>
<p>Barrier options are path dependent. They’ll need another argument</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In a paper titled A Continuity Correction for Discrete Barrier Option, Mark Broadie, Paul Glasser- man and Steven Kou have shown us that the discrete barrier options can be priced using continuous barrier formulas by applying a simple continuity correction to the barrier. The correction shifts the barrier away from the underlying by a factor of <img src="https://latex.codecogs.com/png.latex?exp(%5Cbeta%20%5Csigma%20%5Csqrt%7B%5Cdelta_t%7D)"> where <img src="https://latex.codecogs.com/png.latex?%5Cbeta%20%5Capprox%200.5826"></p>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb12-2">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.045</span></span>
<span id="cb12-3">sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.17</span></span>
<span id="cb12-4">T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span> </span>
<span id="cb12-5">num_timestep <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63</span></span>
<span id="cb12-6">num_sim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb12-7">S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> simulate_path(s0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, mu<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.045</span>, sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>sigma, Time<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>T, num_timestep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_timestep, n_sim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>num_sim)</span>
<span id="cb12-8"></span>
<span id="cb12-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Let's put the barrier at 117 !  we call it B</span></span>
<span id="cb12-10">B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">117</span></span>
<span id="cb12-11">delta_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> num_timestep</span>
<span id="cb12-12">rebate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb12-13">value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb12-14">beta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5826</span></span>
<span id="cb12-15"></span>
<span id="cb12-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Barrier shift - continuity correction for discrete monitoring</span></span>
<span id="cb12-17">B_shift <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.exp(beta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(delta_t))</span>
<span id="cb12-18"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(B_shift)</span>
<span id="cb12-19"></span>
<span id="cb12-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># finding discounted value of expected payoff</span></span>
<span id="cb12-21"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(num_sim): </span>
<span id="cb12-22">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># if final price of one simulation is less that the Barrier shift</span></span>
<span id="cb12-23">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> S[:,i].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> B_shift: </span>
<span id="cb12-24">    value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> np.maximum(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, S[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> K)</span>
<span id="cb12-25">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>: </span>
<span id="cb12-26">    value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> rebate</span>
<span id="cb12-27">    </span>
<span id="cb12-28">Co <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> T) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (value<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>num_sim)</span>
<span id="cb12-29"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'The up-and-out Barrier Option value is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>Co<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:04f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>117.73225187428132
The up-and-out Barrier Option value is 3.369172</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">figure, axes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>), constrained_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb14-2">title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Visualising the Barrier Condition'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Spot Touched Barrier'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Spot Below Barrier'</span>]</span>
<span id="cb14-3">axes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].plot(S[:,:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>])</span>
<span id="cb14-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>):</span>
<span id="cb14-5">    axes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].plot(S[:,i]) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> S[:,i].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> B_shift <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> axes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>].plot(S[:,i])</span>
<span id="cb14-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>):</span>
<span id="cb14-7">    axes[i].set_title(title[i])</span>
<span id="cb14-8">    axes[i].hlines(B_shift, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>, colors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>, linestyles<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'dashed'</span>)</span>
<span id="cb14-9">figure.supxlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'time steps'</span>)</span>
<span id="cb14-10">figure.supylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'index levels'</span>)</span>
<span id="cb14-11">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part3/monte-carlo-sim/index_files/figure-html/cell-11-output-1.png" width="1931" height="587"></p>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb15-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb15-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb15-4"></span>
<span id="cb15-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> create_price_path(S0, rfr, sigma, time_horizon, num_steps, num_sim): </span>
<span id="cb15-6">  </span>
<span id="cb15-7">  np.random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18092023</span>)</span>
<span id="cb15-8"></span>
<span id="cb15-9">  dt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time_horizon <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> num_steps</span>
<span id="cb15-10"></span>
<span id="cb15-11">  S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((num_steps, num_sim))</span>
<span id="cb15-12">  S[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> S0</span>
<span id="cb15-13"></span>
<span id="cb15-14">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,num_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>): </span>
<span id="cb15-15">    phi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.standard_normal(num_sim)</span>
<span id="cb15-16">    S[i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> S[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> rfr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> phi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(dt))</span>
<span id="cb15-17">  </span>
<span id="cb15-18">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> S</span>
<span id="cb15-19"></span>
<span id="cb15-20">S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> create_price_path(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.045</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.17</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">252</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>)</span>
<span id="cb15-21"></span>
<span id="cb15-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for a european option.  </span></span>
<span id="cb15-23"></span>
<span id="cb15-24">K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb15-25">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span></span>
<span id="cb15-26">T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.55</span></span>
<span id="cb15-27"></span>
<span id="cb15-28">C0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>T) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.mean(np.maximum(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, S[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>K))</span>
<span id="cb15-29"></span>
<span id="cb15-30">C0</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>9.038910855148245</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>Black-Schole</category>
  <category>Risk Neutrality</category>
  <category>Exotic Options</category>
  <category>Monte-Carlo</category>
  <guid>https://fderyckel.github.io/blog.html/posts/quant-part3/monte-carlo-sim/index.html</guid>
  <pubDate>Sat, 26 Aug 2023 17:00:00 GMT</pubDate>
  <media:content url="https://fderyckel.github.io/blog.html/posts/quant-part3/monte-carlo-sim/mc-simulation.png" medium="image" type="image/png" height="103" width="144"/>
</item>
<item>
  <title>02 - Stochastic Differential Equation - Part II</title>
  <dc:creator>Francois de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/quant-part2/02-SDE-part2/index.html</link>
  <description><![CDATA[ 




<section id="vs-when-s-is-a-sde---itô-iii" class="level1">
<h1><img src="https://latex.codecogs.com/png.latex?V(S)"> when S is a SDE - Itô III</h1>
<p>Let <img src="https://latex.codecogs.com/png.latex?V"> be a function of <img src="https://latex.codecogs.com/png.latex?S"> where <img src="https://latex.codecogs.com/png.latex?S"> satisfies the stochastic differential equation <img src="https://latex.codecogs.com/png.latex?dS%20=%20%5Cmu%20S%20%5Cspace%20dt%20+%20%5Csigma%20S%20%5Cspace%20dX(t)"> Note how in this case <img src="https://latex.codecogs.com/png.latex?%5Cmu"> and <img src="https://latex.codecogs.com/png.latex?%5Csigma"> are constants. In more elaborate models, both can be time-dependent variables and be stochastic themselves.</p>
<p>Using a one-dimension Taylor Series expansion, we can write <img src="https://latex.codecogs.com/png.latex?V(S%20+%20dS)%20%5Capprox%20V(S)%20+%20%5Cfrac%7BdV%7D%7BdS%7D%20%5Cspace%20dS%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7Bd%5E2V%7D%7BdS%5E2%7D%20%5Cspace%20dS%5E2"></p>
<p>To express <img src="https://latex.codecogs.com/png.latex?dS%5E2">? <img src="https://latex.codecogs.com/png.latex?dS%5E2%20=%20(dS)%5E2%20=%20%5Cmu%5E2%20S%5E2%20%5Cspace%20dt%5E2%20+%202%20%5Cmu%20%5Csigma%20S%5E2%20%20%5Cspace%20dt%20dX(t)%20+%20%5Csigma%5E2%20S%5E2%20%5Cspace%20dX(t)%5E2"></p>
<p><span id="eq-ds-squared"><img src="https://latex.codecogs.com/png.latex?dS%5E2%20=%20%5Csigma%5E2%20S%5E2%20%5Cspace%20dX(t)%5E2%20=%20%5Csigma%5E2%20S%5E2%20%5Cspace%20dt%20%5Ctag%7B1%7D"></span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>We could generalize this a bit further Let’s have a function <img src="https://latex.codecogs.com/png.latex?dG_t%20=%20A(t,%20X_t)%20%5Cspace%20dt%20+%20B(t,%20X_t)%20%5Cspace%20dW_t"></p>
<p>Then <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5BdG_t%5D%20=%20%5Cmathbb%7BE%7D%5BA%20%5Cspace%20dt%5D%20+%20%5Cmathbb%7BE%7D%5BB%20%5Cspace%20dW_t%5D%20=%20A%20%5Cspace%20%5Cmathbb%7BE%7D%5Bdt%5D%20+%20B%20%5Cspace%20%5Cmathbb%7BE%7D%5BdW_t%5D"></p>
<p>Recall that <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5BdW_t%5D%20=%200">, hence <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5BdG_t%5D%20=%20A%20%5Cspace%20%5Cmathbb%7BE%7D%5Bdt%5D"> Considering the variance, we can write <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BV%7Dar%5BdG_t%5D%20=%20%5Cmathbb%7BV%7Dar%5BA%20%5Cspace%20dt%5D%20+%20%5Cmathbb%7BV%7Dar%5BB%20%5Cspace%20dW_t%5D%20=%20A%5E2%20%5Cspace%20%5Cmathbb%7BV%7Dar%5Bdt%5D%20+%20B%5E2%20%5Cspace%20%5Cmathbb%7BV%7Dar%5BdW_t%5D%20=%20B%5E2%20%5Cspace%20dt"> Recall that <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BV%7Dar%5Bdt%5D%20=%200">, hence <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BV%7Dar%5BdG_t%5D%20=%20B%5E2%20%5Cspace%20%5Cmathbb%7BV%7Dar%5BdW_t%5D"></p>
</div>
</div>
<p>Going back to our expansion and considering <img src="https://latex.codecogs.com/png.latex?dV%20=%20V(S+dS)%20-%20V(S)">: <img src="https://latex.codecogs.com/png.latex?dV%20=%20%5Cfrac%7BdV%7D%7BdS%7D%20%5Cspace%20(%5Cmu%20S%20%5Cspace%20dt%20+%20%5Csigma%20S%20%5Cspace%20dX(t))%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7Bd%5E2V%7D%7BdS%5E2%7D%20%5Cspace%20(%5Csigma%5E2%20S%5E2%20%5Cspace%20dt)"> <span id="eq-ito3"><img src="https://latex.codecogs.com/png.latex?dV%20=%20%5Cleft(%20%5Cmu%20S%20%5Cfrac%7BdV%7D%7BdS%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Csigma%5E2%20S%5E2%20%5Cfrac%7Bd%5E2V%7D%7BdS%5E2%7D%20%5Cright)%20%5Ccdot%20dt%20+%20%5Cleft(%20%5Csigma%20S%20%5Cfrac%7BdV%7D%7BdS%7D%20%5Cright)%20%5Ccdot%20dX(t)%20%5Ctag%7B2%7D"></span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let <img src="https://latex.codecogs.com/png.latex?V(S)%20=%20log(S)"> with S satisfies the usual SDE: <img src="https://latex.codecogs.com/png.latex?dS%20=%20%5Cmu%20S%20dt%20+%20%5Csigma%20S%20dX_t">. We can then use the above SDE form.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7BdV%7D%7BdS%7D%20=%20%5Cfrac%7B1%7D%7BS%7D"> <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7Bd%5E2V%7D%7BdS%5E2%7D%20=%20-%20%5Cfrac%7B1%7D%7BS%5E2%7D"></p>
<p>Using above Equation&nbsp;2: <img src="https://latex.codecogs.com/png.latex?dV%20=%20%5Cleft(%20%5Cmu%20S%20%5Cfrac%7B1%7D%7BS%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Csigma%5E2%20S%5E2%20%5Cfrac%7B-1%7D%7BS%5E2%7D%20%5Cright)%20%5Ccdot%20dt%20+%20%5Cleft(%20%5Csigma%20S%20%5Cfrac%7B1%7D%7BS%7D%20%5Cright)%20%5Ccdot%20dX(t)"> <img src="https://latex.codecogs.com/png.latex?dV%20=%20%5Cleft(%20%5Cmu%20-%20%5Cfrac%7B1%7D%7B2%7D%20%5Csigma%5E2%20%20%5Cright)%20%5Ccdot%20dt%20+%20%5Csigma%20%20%5Ccdot%20dX(t)"> Using the integral form:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cint_0%5Et%20d(log%20%5Cspace%20S)%20=%20%5Cint_0%5Et%20%5Cmu%20-%20%5Cfrac%7B1%7D%7B2%7D%20%5Csigma%5E2%20%5Cspace%20d%5Ctau%20+%20%5Cint_0%5Et%20%5Csigma%20%5Cspace%20dX(%5Ctau)"> <img src="https://latex.codecogs.com/png.latex?log(S_t)%20-%20log(S_0)%20=%20%5Cmu%20t%20-%20%5Cfrac%7B1%7D%7B2%7D%20%5Csigma%5E2%20t%20+%20%5Csigma%20(X_t%20-%20X_0)"> <img src="https://latex.codecogs.com/png.latex?log%20%5Cleft(%20%5Cfrac%7BS_t%7D%7BS_0%7D%20%5Cright)%20=%20%5Cmu%20t%20-%20%5Cfrac%7B1%7D%7B2%7D%20%5Csigma%5E2%20t%20+%20%5Csigma%20(X_t%20-%20X_0)"> <img src="https://latex.codecogs.com/png.latex?S_t%20=%20S_0%20%5Ccdot%20e%5E%7B%5Cmu%20t%20-%20%5Cfrac%7B1%7D%7B2%7D%20%5Csigma%5E2%20t%20+%20%5Csigma%20(X_t%20-%20X_0)%7D"></p>
<p>Using <img src="https://latex.codecogs.com/png.latex?X_0%20=%200"> and <img src="https://latex.codecogs.com/png.latex?X_t%20=%20%5Cphi%20%5Csqrt%7Bt%7D">: <img src="https://latex.codecogs.com/png.latex?S_t%20=%20S_0%20%5Ccdot%20e%5E%7B%5Cmu%20t%20-%20%5Cfrac%7B1%7D%7B2%7D%20%5Csigma%5E2%20t%20+%20%5Csigma%20%5Cphi%20%5Csqrt%7Bt%7D%7D"></p>
</div>
</div>
<p>Another example with interest rate</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Vasicek model
</div>
</div>
<div class="callout-body-container callout-body">
<p>This model developed in 1978 by Vasicek is about interest rate.</p>
<p>The basic SDE takes this form <span id="eq-vasicek1"><img src="https://latex.codecogs.com/png.latex?dr%20=%20(%5Ceta%20-%20%5Cgamma%20r)%20dt%20+%20%5Csigma%20dX%20%5Ctag%7B3%7D"></span> In this model, <img src="https://latex.codecogs.com/png.latex?%5Ceta">, <img src="https://latex.codecogs.com/png.latex?%5Cgamma"> and <img src="https://latex.codecogs.com/png.latex?%5Csigma"> are all constant.</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5Cgamma"> is the speed of reversion to the (long term) mean rate. It’s the rate of reversion.</li>
<li>we demote <img src="https://latex.codecogs.com/png.latex?%5Cbar%7Br%7D"> the mean interest rate such that <img src="https://latex.codecogs.com/png.latex?%5Cbar%7Br%7D%20=%20%5Cfrac%7B%5Ceta%7D%7B%5Cgamma%7D"></li>
</ul>
<p><span id="eq-vasicek2"><img src="https://latex.codecogs.com/png.latex?dr%20=%20%5Cgamma%20(%5Cbar%7Br%7D%20-%20r)%20%5Cspace%20dt%20+%20%5Csigma%20%5Cspace%20dX%20%5Ctag%7B4%7D"></span></p>
<p>If we let <img src="https://latex.codecogs.com/png.latex?u%20=%20r%20-%20%5Cbar%7Br%7D">, then <img src="https://latex.codecogs.com/png.latex?du%20=%20dr"> because we consider <img src="https://latex.codecogs.com/png.latex?%5Cbar%7Br%7D"> as a constant. Hence <img src="https://latex.codecogs.com/png.latex?du%20=%20-%20%5Cgamma%20u%20%5Cspace%20dt%20+%20%5Csigma%20dX"> <img src="https://latex.codecogs.com/png.latex?du%20+%20%5Cgamma%20u%20dt%20=%20%5Csigma%20dX"><br>
<img src="https://latex.codecogs.com/png.latex?e%5E%7B%5Cgamma%20t%7D%20du%20+%20%5Cgamma%20u%20e%5E%7B%5Cgamma%20t%7D%20dt%20=%20e%5E%7B%5Cgamma%20t%7D%20%5Csigma%20dX"> <img src="https://latex.codecogs.com/png.latex?d(u%20e%5E%7B%5Cgamma%20t%7D)%20=%20%5Csigma%20e%5E%7B%5Cgamma%20t%7D%20dX"> <img src="https://latex.codecogs.com/png.latex?%5Cint_0%5Et%20d(u_s%20e%5E%7B%5Cgamma%20s%7D)%20=%20%5Csigma%20%5Cint_0%5Et%20e%5E%7B%5Cgamma%20s%7D%20dX_s"> <img src="https://latex.codecogs.com/png.latex?u(t)%20e%5E%7B%5Cgamma%20t%7D%20-%20u(0)%20=%20%5Csigma%20%5Cint_0%5Et%20e%5E%7B%5Cgamma%20s%7D%20dX_s"> <img src="https://latex.codecogs.com/png.latex?u(t)%20=%20u(0)%20e%5E%7B-%5Cgamma%20t%7D%20+%20%20%5Csigma%20%5Cint_0%5Et%20e%5E%7B%5Cgamma%20(s%20-%20t)%7D%20dX_s"></p>
</div>
</div>
</section>
<section id="vt-s-when-s-is-a-sde---itô-iv" class="level1">
<h1><img src="https://latex.codecogs.com/png.latex?V(t,%20S)"> when S is a SDE - Itô IV</h1>
<p>This time <img src="https://latex.codecogs.com/png.latex?V"> is a function of both time <img src="https://latex.codecogs.com/png.latex?t"> and <img src="https://latex.codecogs.com/png.latex?S"> which satisfies the usual SDE: <img src="https://latex.codecogs.com/png.latex?dS%20=%20%5Cmu%20S%20dt%20+%20%5Csigma%20S%20dX_t"></p>
<p>We can also do a Taylor Series expansion on this. And recall Equation&nbsp;1 when dealing with <img src="https://latex.codecogs.com/png.latex?dS%5E2"></p>
<p><img src="https://latex.codecogs.com/png.latex?V(S%20+%20dS,%20t%20+%20dt)%20%5Capprox%20V(S,%20t)%20+%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20S%7D%20dS%20+%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20t%7D%20dt%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%5E2%20V%7D%7B%5Cpartial%20S%5E2%7D%20dS%5E2"> <img src="https://latex.codecogs.com/png.latex?V(S%20+%20dS,%20t%20+%20dt)%20-%20V(S,%20t)%20%5Capprox%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20S%7D%20dS%20+%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20t%7D%20dt%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%5E2%20V%7D%7B%5Cpartial%20S%5E2%7D%20%5Csigma%5E2%20S%5E2%20dt"></p>
<p><img src="https://latex.codecogs.com/png.latex?dV%20=%20%5Cleft(%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20t%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%5E2%20V%7D%7B%5Cpartial%20S%5E2%7D%20%5Csigma%5E2%20S%5E2%20%5Cright)%20dt%20+%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20S%7D%20dS"></p>
<p><img src="https://latex.codecogs.com/png.latex?dV%20=%20%5Cleft(%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20t%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%5E2%20V%7D%7B%5Cpartial%20S%5E2%7D%20%5Csigma%5E2%20S%5E2%20%5Cright)%20dt%20+%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20S%7D%20(%5Cmu%20S%20dt%20+%20%5Csigma%20S%20dX_t)"> <span id="eq-ito4"><img src="https://latex.codecogs.com/png.latex?dV%20=%20%5Cleft(%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20t%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%5E2%20V%7D%7B%5Cpartial%20S%5E2%7D%20%5Csigma%5E2%20S%5E2%20+%20%5Cmu%20S%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20S%7D%20%20%5Cright)%20dt%20+%20%5Csigma%20S%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20S%7D%20dX_t%20%5Ctag%7B5%7D"></span></p>
</section>
<section id="transition-probabilty-function-as-ode" class="level1">
<h1>Transition probabilty function as ODE</h1>
<p>For background on the transition probability function, check <a href="../../../posts/quant-part1/trinomial-model/index.html">this post</a></p>
<p>Recall from the above linked post that <img src="https://latex.codecogs.com/png.latex?y,%20t"> are current state and <img src="https://latex.codecogs.com/png.latex?y',%20t'"> are future values.<br>
The transition probabilty function was expressed as a partial differential equation of the form <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20P%7D%7B%5Cpartial%20t'%7D%20=%20C%5E2%20%5Cfrac%7B%5Cpartial%5E2%20P%7D%7B%5Cpartial%20y'%5E2%7D"> which was the FKE.</p>
<p>In the case of our usual Stochastic Differential Equation, which we write under a more general form like <img src="https://latex.codecogs.com/png.latex?dY%20=%20A(y,%20t)%20%5Cspace%20dt%20+%20B(y,%20t)%20%5Cspace%20dW_t"> We can find that the transition probability function satisfies the following Partial differential equation: <span id="eq-FKE1"><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20P%7D%7B%5Cpartial%20t'%7D%20=%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%5E2%20%5Cleft(B(y',%20t')%5E2%20p%20%5Cright)%7D%7B%5Cpartial%20y'%5E2%7D%20-%20%5Cfrac%7B%5Cpartial%20%5Cleft(%20A(y',%20t')%20p%20%5Cright)%7D%7B%5Cpartial%20y'%7D%20%5Ctag%7B6%7D"></span></p>
<p>In our financial model, we’ll apply Equation&nbsp;6 with the usual SDE <img src="https://latex.codecogs.com/png.latex?dS=%5Cmu%20S%20%5Cspace%20dt+%5Csigma%20S%20%5Cspace%20dW_t">. Remember that <img src="https://latex.codecogs.com/png.latex?%5Cmu"> and <img src="https://latex.codecogs.com/png.latex?%5Csigma"> are constant here.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20P%7D%7B%5Cpartial%20t'%7D%20=%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%5E2%20(%5Csigma%5E2%20S'%5E2%20p)%7D%7B%5Cpartial%20S'%5E2%7D%20-%20%5Cfrac%7B%5Cpartial%20(%5Cmu%20S'%20p)%7D%7B%5Cpartial%20S'%7D"></p>
<p>The solution to this partial differential equation has been developed <a href="../../../posts/quant-part1/trinomial-model/index.html">in the trinomial post</a>:</p>
<p><span id="eq-FKE1b"><img src="https://latex.codecogs.com/png.latex?p(S,%20t;%20S',%20t')%20=%20%5Cfrac%7B1%7D%7B%5Csigma%20S'%20%5Csqrt%7B2%20%5Cpi%20(t'-t)%7D%7D%20e%5E%7B%5Cfrac%7B-log%5Cleft(%20%5Cfrac%7BS%7D%7BS'%7D%20%5Cright)%20+%20(%5Cmu%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Csigma%5E2)%7D%7B2%20%5Csigma%5E2(t'-t)%7D%7D%20%5Ctag%7B7%7D"></span></p>
<section id="steady-state" class="level2">
<h2 class="anchored" data-anchor-id="steady-state">Steady-state</h2>
<p>In some case, there are situation (random-walk) with a long term mean reversal - we say that they have a <strong>steady state distribution</strong>. This means that in the long run, the <img src="https://latex.codecogs.com/png.latex?p(y,%20t;%20y',%20t')"> doesn’t depend of the starting point <img src="https://latex.codecogs.com/png.latex?y,%20t">; the probability becomes time independent. Think of situations such as interest rate and volatility.</p>
<p>In the case of a steady state situation, <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20P%7D%7B%5Cpartial%20t'%7D%20=%200"> since the process becomes time independent in the long run. And the probability (now written $p_{} (y’) $) satisfies the ordinary differential equation: <span id="eq-FKE2"><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7Bd%20%5Cleft(B(y')%5E2%20p_%7B%5Cinfty%7D%20%5Cright)%7D%7Bd%20y'%5E2%7D%20-%20%5Cfrac%7Bd%20%5Cleft(%20A(y')%20p_%7B%5Cinfty%7D%20%5Cright)%7D%7Bd%20y'%7D%20=%200%20%5Ctag%7B8%7D"></span> It isn’t anymore a partial differential equation as the time component vanishes (aka steady-state, long-term reversal)</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Vasicek revisited
</div>
</div>
<div class="callout-body-container callout-body">
<p>Recall from above the Vasicek model <img src="https://latex.codecogs.com/png.latex?dr%20=%20%5Cgamma%20(%5Cbar%7Br%7D%20-%20r)%20%5Cspace%20dt%20+%20%5Csigma%20%5Cspace%20dW_t"> Using Equation&nbsp;8, we can write the steady state distribution <img src="https://latex.codecogs.com/png.latex?p_%7B%5Cinfty%7D%20r'"> following ordinary differential equation. <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7B2%7D%20%5Csigma%5E2%20%5Cfrac%7Bd%5E2%20%20p_%7B%5Cinfty%7D%20%7D%7Bd%20r'%5E2%7D%20-%20%5Cgamma%20%5Cfrac%7Bd(%20%5Cleft(%5Cbar%7Br%7D%20-%20r)%20p_%7B%5Cinfty%7D%20%5Cright)%7D%7Bd%20r'%7D%20=%200"> Integrating both sides, we get: <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7B2%7D%20%5Csigma%5E2%20%5Cfrac%7Bd%20%20p_%7B%5Cinfty%7D%20%7D%7Bd%20r'%7D%20+%20%5Cgamma%20(r%20-%20%5Cbar%7Br%7D)%20p_%7B%5Cinfty%7D%20=%20K"> K being a constant. <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7B2%7D%20%5Csigma%5E2%20%5Cfrac%7Bd%20%20p_%7B%5Cinfty%7D%20%7D%7Bd%20r'%7D%20=%20-%20%5Cgamma%20(r%20-%20%5Cbar%7Br%7D)%20p_%7B%5Cinfty%7D%20+%20K"> Letting the constant be 0 (need explanation here) Letting the <img src="https://latex.codecogs.com/png.latex?%7B%5Cinfty%7D"> just for convenience purposes.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7Bp%7D%20dp%20=%20%5Cfrac%7B-2%20%5Cgamma%7D%7B%5Csigma%5E2%7D%20(r%20-%20%5Cbar%7Br%7D)%20%5Cspace%20dr'"> Integrating both sides, <img src="https://latex.codecogs.com/png.latex?%5Cint%20%5Cfrac%7B1%7D%7Bp%7D%20dp%20=%20%5Cfrac%7B-2%20%5Cgamma%7D%7B%5Csigma%5E2%7D%20%5Cint%20(r%20-%20%5Cbar%7Br%7D)%20%5Cspace%20dr'"> <img src="https://latex.codecogs.com/png.latex?log(p)%20=%20%5Cfrac%7B-2%20%5Cgamma%7D%7B%5Csigma%5E2%7D%20%5Cfrac%7B1%7D%7B2%7D%20(r%20-%20%5Cbar%7Br%7D)%5E2%20+%20K"> Using a normalizing constant, as we inverse the log <span id="eq-vasicek2"><img src="https://latex.codecogs.com/png.latex?p(r)%20=%20A%20%5Ccdot%20e%5E%7B-%20%5Cfrac%7B%5Cgamma%7D%7B%5Csigma%5E2%7D%20(r%20-%20%5Cbar%7Br%7D)%5E2%7D%20%5Ctag%7B9%7D"></span></p>
<p>We know that <img src="https://latex.codecogs.com/png.latex?%5Cint_%7B%5Cmathbb%7BR%7D%7D%20p(r)%20dr=%201">, hence <img src="https://latex.codecogs.com/png.latex?A%20%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cinfty%7D%20e%5E%7B-%20%5Cfrac%7B%5Cgamma%7D%7B%5Csigma%5E2%7D%20(r%20-%20%5Cbar%7Br%7D)%5E2%7D%20dr%20=%201"> We can integrate this using substitution <img src="https://latex.codecogs.com/png.latex?u%20=%20%5Cfrac%7B%5Csqrt%7B%5Cgamma%7D%20%5Cspace%20(r%20-%20%5Cbar%7Br%7D)%7D%7B%5Csigma%7D"> with <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7Bdu%7D%7Bdr%7D%20=%20%5Cfrac%7B%5Csqrt%7B%5Cgamma%7D%7D%7B%5Csigma%7D"> <img src="https://latex.codecogs.com/png.latex?A%20%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cinfty%7D%20e%5E%7B-u%5E2%7D%20%5Cfrac%7B%5Csigma%7D%7B%5Csqrt%7B%5Cgamma%7D%7D%20du%20=%201"> <img src="https://latex.codecogs.com/png.latex?A%20%5Cfrac%7B%5Csigma%7D%7B%5Csqrt%7B%5Cgamma%7D%7D%20%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cinfty%7D%20e%5E%7B-u%5E2%7D%20du%20=%201"> <img src="https://latex.codecogs.com/png.latex?A%20%5Cfrac%7B%5Csigma%7D%7B%5Csqrt%7B%5Cgamma%7D%7D%20%5Csqrt%7B%5Cpi%7D%20%20=%201"> <img src="https://latex.codecogs.com/png.latex?A%20=%20%5Cfrac%7B%5Csqrt%7B%5Cgamma%7D%7D%7B%5Csigma%20%5Csqrt%7B%5Cpi%7D%7D%20=%20%5Cfrac%7B1%7D%7B%5Csigma%7D%20%5Csqrt%7B%5Cfrac%7B%5Cgamma%7D%7B%5Cpi%7D%7D"></p>
<p>Putting it all back together in Equation&nbsp;9: <img src="https://latex.codecogs.com/png.latex?p_%7B%5Cinfty%7D(r)%20=%20A%20%5Ccdot%20e%5E%7B-%20%5Cfrac%7B%5Cgamma%7D%7B%5Csigma%5E2%7D%20(r%20-%20%5Cbar%7Br%7D)%5E2%7D%20=%20%5Cfrac%7B1%7D%7B%5Csigma%7D%20%5Csqrt%7B%5Cfrac%7B%5Cgamma%7D%7B%5Cpi%7D%7D%20e%5E%7B-%20%5Cfrac%7B%5Cgamma%7D%7B%5Csigma%5E2%7D%20(r%20-%20%5Cbar%7Br%7D)%5E2%7D"> This means: in our case of a steady state stochastic process, the variable <img src="https://latex.codecogs.com/png.latex?r"> follows a normal distribution with mean <img src="https://latex.codecogs.com/png.latex?%5Cbar%7Br%7D%7D"> and standard deviation <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Csigma%7D%7B%5Csqrt%7B2%20%5Ccdot%20%5Cgamma%7D%7D"></p>
</div>
</div>
</section>
</section>
<section id="vt-s_1-s_2-modeling-correlated-random-walks" class="level1">
<h1><img src="https://latex.codecogs.com/png.latex?V(t,%20S_1,%20S_2)"> Modeling correlated random walks</h1>
<p>We have now 2 assets</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Bequation%7D%0A%20%20%5Cbegin%7Bcases%7D%0A%20%20%20%20dS_1%20=%20%5Cmu_1%20S_1%20%5Cspace%20dt%20+%20%5Csigma_1%20S_1%20%5Cspace%20dX_1%20%5C%5C%0A%20%20%20%20dS_2%20=%20%5Cmu_2%20S_2%20%5Cspace%20dt%20+%20%5Csigma_2%20S_2%20%5Cspace%20dX_2%0A%20%20%5Cend%7Bcases%7D%0A%5Cend%7Bequation%7D%20"></p>
<p>Using a Taylor series expansion <img src="https://latex.codecogs.com/png.latex?V(t+dt,%20S_1+dS_1,%20S_2+dS_2)%20%5Capprox%20V(t,%20S1,%20S2)%20+%0A%20%20%20%20%20%20%20%20%20%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20t%7D%20dt%20+%0A%20%20%20%20%20%20%20%20%20%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20S_1%7D%20dS_1%20+%0A%20%20%20%20%20%20%20%20%20%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20S_2%7D%20dS_2%20+%0A%20%20%20%20%20%20%20%20%20%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%5E2%20V%7D%7B%5Cpartial%20S_1%5E2%7D%20dS_1%5E2%20+%0A%20%20%20%20%20%20%20%20%20%20%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%5E2%20V%7D%7B%5Cpartial%20S_2%5E2%7D%20dS_2%5E2%20+%0A%20%20%20%20%20%20%20%20%20%20%20%5Cfrac%7B%5Cpartial%5E2%20V%7D%7B%5Cpartial%20S_1%20%5Cpartial%20S_2%7D%20dS_1%20dS_2"> <span id="eq-dv1"><img src="https://latex.codecogs.com/png.latex?dV%20=%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20t%7D%20dt%20+%0A%20%20%20%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20S_1%7D%20dS_1%20+%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20S_2%7D%20dS_2%20+%0A%20%20%20%20%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%5E2%20V%7D%7B%5Cpartial%20S_1%5E2%7D%20dS_1%5E2%20+%0A%20%20%20%20%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%5E2%20V%7D%7B%5Cpartial%20S_2%5E2%7D%20dS_2%5E2%20+%0A%20%20%20%20%20%5Cfrac%7B%5Cpartial%5E2%20V%7D%7B%5Cpartial%20S_1%20%5Cpartial%20S_2%7D%20dS_1%20dS_2%20%5Ctag%7B10%7D"></span></p>
<p>Now we can write down some results we’ll plug into that expansion</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?dS_i%20=%20%5Cmu_i%20S_i%20%5Cspace%20dt%20+%20%5Csigma_i%20S_i%20%5Cspace%20dX_i"></li>
<li>Using Equation&nbsp;1, we write <img src="https://latex.codecogs.com/png.latex?dS_i%5E2%20=%20%5Csigma_i%5E2%20S_i%5E2%20dt"></li>
<li>Letting <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5B%5Cphi_1%20%5Cphi_2%5D%20=%20%5Crho">, we write <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5BdX_1%20dX_2%5D%20=%20%5Cmathbb%7BE%7D%5B%5Cphi_1%20%5Csqrt%7Bdt%7D%20%5Cphi_2%20%5Csqrt%7Bdt%7D%5D%20=%20%5Crho%20%5Cspace%20dt"></li>
<li>Recall that all terms less than dt = 0. Hence in the product <img src="https://latex.codecogs.com/png.latex?dS_1%20dS_2%20=%20(%5Cmu_1%20S_1%20%5Cspace%20dt%20+%20%5Csigma_1%20S_1%20%5Cspace%20dX_1)(%5Cmu_2%20S_2%20%5Cspace%20dt%20+%20%5Csigma_2%20S_2%20%5Cspace%20dX_2)">, the only term that we are considering is the outter product <img src="https://latex.codecogs.com/png.latex?%5Csigma_1%20S_1%20%5Cspace%20dX_1%20%5Csigma_2%20S_2%20%5Cspace%20dX_2">. Finally, re-using above result, <img src="https://latex.codecogs.com/png.latex?dS_1%20dS_2%20=%20%5Crho%20%5Csigma_1%20%5Csigma_2%20S_1%20S_2%20dt">.</li>
</ul>
<p>Re-writing Equation&nbsp;10 by substituting <img src="https://latex.codecogs.com/png.latex?dS_1"> and <img src="https://latex.codecogs.com/png.latex?dS_2">, and factoring the terms in dt and those in <img src="https://latex.codecogs.com/png.latex?dX_t">, we get: <img src="https://latex.codecogs.com/png.latex?dV%20=%20%5Cleft(%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20t%7D%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Cmu_1%20S_1%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20S_1%7D%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Cmu_2%20S_2%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20S_2%7D%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Csigma_1%5E2%20S_1%5E2%20%5Cfrac%7B%5Cpartial%5E2%20V%7D%7B%5Cpartial%20S_1%5E2%7D%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Csigma_2%5E2%20S_2%5E2%20%5Cfrac%7B%5Cpartial%5E2%20V%7D%7B%5Cpartial%20S_2%5E2%7D%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Crho%20%5Csigma_1%20%5Csigma_2%20S_1%20S_2%20%5Cfrac%7B%5Cpartial%5E2%20V%7D%7B%5Cpartial%20S_1%20%5Cpartial%20S_2%7D%20%20%5Cright)%20dt%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Cleft(%20%5Csigma_1%20S_1%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20S_1%7D%20dX_1%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Csigma_2%20S_2%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20S_2%7D%20dX_2%20%5Cright)"></p>
<p>Itô</p>


</section>

 ]]></description>
  <category>quant-finance</category>
  <category>ito-integral</category>
  <category>stochastic-calculus</category>
  <guid>https://fderyckel.github.io/blog.html/posts/quant-part2/02-SDE-part2/index.html</guid>
  <pubDate>Fri, 21 Jul 2023 17:00:00 GMT</pubDate>
</item>
<item>
  <title>01 - Stochastic Differential Equation - Part I</title>
  <dc:creator>Francois de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/quant-part2/01-SDE-Part1/index.html</link>
  <description><![CDATA[ 




<section id="function-of-a-stochastic-process-x_t---itô-i" class="level1">
<h1>Function of a stochastic process <img src="https://latex.codecogs.com/png.latex?X_t"> - Itô I</h1>
<p>Let <img src="https://latex.codecogs.com/png.latex?F"> be a function of a stochastic random variable <img src="https://latex.codecogs.com/png.latex?X_t">. So <img src="https://latex.codecogs.com/png.latex?F%20=%20F(X_t)">.</p>
<p>Using a Taylor expansion: <img src="https://latex.codecogs.com/png.latex?F(X%20+%20dX)%20%5Capprox%20F(X)%20+%20%5Cfrac%7BdF%7D%7BdX%7D%20%5Cspace%20dX%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7Bd%5E2F%7D%7BdX%5E2%7D%20dX%5E2"> Using <img src="https://latex.codecogs.com/png.latex?F(X+dX)%20-%20F(X)%20=%20dF">: <img src="https://latex.codecogs.com/png.latex?dF%20=%20%5Cfrac%7BdF%7D%7BdX%7D%20%5Cspace%20dX%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7Bd%5E2F%7D%7BdX%5E2%7D%20dX%5E2"></p>
<p>Now, recall <img src="https://latex.codecogs.com/png.latex?dX"> is a random variable with mean 0 and standard deviation <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7Bt%7D">. Also, for small values of <img src="https://latex.codecogs.com/png.latex?t">, we have <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7Bdt%7D%20%5Cgt%20dt">, hence it is of higher order than dt. Hence, we re-write the previous equation as</p>
<p><img src="https://latex.codecogs.com/png.latex?dF%20=%20%5Cfrac%7BdF%7D%7BdX%7D%20%5Cspace%20dX%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7Bd%5E2F%7D%7BdX%5E2%7D%20dt"> Usually, we write the deterministic part of the equation first.<br>
<span id="eq-ito1"><img src="https://latex.codecogs.com/png.latex?dF%20=%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7Bd%5E2F%7D%7BdX%5E2%7D%20%5Cspace%20dt%20+%20%5Cfrac%7BdF%7D%7BdX%7D%20%5Cspace%20dX%20%5Ctag%7B1%7D"></span></p>
<p>All our <strong>Stochastic Differential Equations</strong> will have in them these 2 different time steps: <img src="https://latex.codecogs.com/png.latex?dt"> and <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7Bdt%7D">. <img src="https://latex.codecogs.com/png.latex?dF%20=%20%5Cunderbrace%20%7B%5Cdots%20%5Cspace%20dt%7D_%7Bdeterministic-drift%7D%20+%20%5Cunderbrace%7B%5Cdots%20%5Cspace%20dX%7D_%7Brandom-diffusion%7D"></p>
<p>The integral form of this Stochastic Differential Equation is <img src="https://latex.codecogs.com/png.latex?%5Cint_0%5Et%20%5Cfrac%7BdF%7D%7BdX_%5Ctau%7D%20%5Cspace%20dX_%5Ctau%20=%20%5Cint_0%5Et%20dF%20-%20%5Cfrac%7B1%7D%7B2%7D%20%5Cint_0%5Et%20%5Cfrac%7Bd%5E2F%7D%7BdX_%5Ctau%5E2%7D%20%5Cspace%20d%5Ctau"></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 1
</div>
</div>
<div class="callout-body-container callout-body">
<p><img src="https://latex.codecogs.com/png.latex?F(X_t)%20=%20X%5E2">, where <img src="https://latex.codecogs.com/png.latex?X_t"> is stochastic random variable. <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7BdF%7D%7BdX%7D%20=%202X"> <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7Bd%5E2F%7D%7BdX%5E2%7D%20=%202"></p>
<p>Hence, using the previous Equation&nbsp;1 (aka itô I): <img src="https://latex.codecogs.com/png.latex?dF%20=%20%5Cfrac%7B1%7D%7B2%7D%20%5Ccdot%202%20%5Cspace%20dt%20+%202X%20%5Cspace%20dX"> <img src="https://latex.codecogs.com/png.latex?dF%20=%20dt%20+%202X%20%5Cspace%20dX"> <strong>Using integral form</strong></p>
<p>We could integrate both side of the previous equation. <img src="https://latex.codecogs.com/png.latex?%5Cint_0%5Et%20dF%20=%20%5Cint_0%5Et%20d%5Ctau%20+%20%5Cint_0%5Et%202X(%5Ctau)%20d%7B%5Ctau%7D"> <img src="https://latex.codecogs.com/png.latex?F(t)%20-%20F(0)%20=%20t%20-%200%20+%202%20%5Cint_0%5Et%20X(%5Ctau)%20d%7B%5Ctau%7D"> And assuming F(0) = 0: <img src="https://latex.codecogs.com/png.latex?F(t)%20=%20t%20+%202%20%5Cint_0%5Et%20X_%7B%5Ctau%7D%20%5Cspace%20d%7B%5Ctau%7D"> <img src="https://latex.codecogs.com/png.latex?X%5E2(t)%20=%20t%20+%202%20%5Cint_0%5Et%20X_%7B%5Ctau%7D%20%5Cspace%20d%7B%5Ctau%7D"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
example 2
</div>
</div>
<div class="callout-body-container callout-body">
<p><img src="https://latex.codecogs.com/png.latex?F(W_t)%20=%20sin%20%5Cspace%20W_t%20+%20cos%20%5Cspace%20W_t">, where <img src="https://latex.codecogs.com/png.latex?X_t"> is stochastic random variable. <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7BdF%7D%7BdW_t%7D%20=%20cos%20%5Cspace%20W_t%20-%20sin%20%5Cspace%20W_t"> <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7Bd%5E2F%7D%7BdW_t%5E2%7D%20=%20-(sin%20%5Cspace%20W_t%20+%20cos%20%5Cspace%20W_t)"> Hence, we can now write</p>
<p><img src="https://latex.codecogs.com/png.latex?dF%20=%20-%20%5Cfrac%7B1%7D%7B2%7D(sin%20%5Cspace%20W_t%20+%20cos%20%5Cspace%20W_t)%20%5Cspace%20dt%20+%20(cos%20%5Cspace%20W_t%20-%20sin%20%5Cspace%20W_t)%20%5Cspace%20dW_t"></p>
</div>
</div>
</section>
<section id="function-of-a-stochastic-process-t-xt---itô-ii" class="level1">
<h1>Function of a stochastic process <img src="https://latex.codecogs.com/png.latex?(t,%20X(t))"> - Itô II</h1>
<p>Let <img src="https://latex.codecogs.com/png.latex?F"> be a function of both time <img src="https://latex.codecogs.com/png.latex?t"> and a stochastic random variable <img src="https://latex.codecogs.com/png.latex?X_t">. So <img src="https://latex.codecogs.com/png.latex?F%20=%20F(t,%20X_t)">.</p>
<p>Using a Taylor expansion: <img src="https://latex.codecogs.com/png.latex?F(t%20+%20dt,%20X%20+%20dX)%20%5Capprox%20F(t,%20X)%20+%20%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20t%7D%20%5Cspace%20dt%20+%20%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20X%7D%20%5Cspace%20dX%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7Bd%5E2F%7D%7BdX%5E2%7D%20dX%5E2"> Using <img src="https://latex.codecogs.com/png.latex?F(t%20+%20dt,%20X+dX)%20-%20F(t,%20X)%20=%20dF"> and factoring the <img src="https://latex.codecogs.com/png.latex?dt"> and recall <img src="https://latex.codecogs.com/png.latex?dX%5E2=dt">:</p>
<p><span id="eq-ito2sde"><img src="https://latex.codecogs.com/png.latex?dF%20=%20%5Cleft(%20%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20t%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%20%5E2F%7D%7B%5Cpartial%20X%5E2%7D%20%5Cright)%20dt%20+%20%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20X%7D%20dX%20%5Ctag%7B2%7D"></span></p>
<p>We can transform this Stochastic Differential Equation (SDE) into an itô integral.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cint_0%5Et%20%20%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20X_%5Ctau%7D%20dX_%5Ctau%20=%20%5Cint_0%5Et%20dF%20-%20%5Cint_0%5Et%20%5Cleft(%20%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20%5Ctau%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%20%5E2F%7D%7B%5Cpartial%20X_%5Ctau%5E2%7D%20%5Cright)%20d%5Ctau"> <span id="eq-ito2-int"><img src="https://latex.codecogs.com/png.latex?%5Cint_0%5Et%20%20%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20X_%5Ctau%7D%20dX_%5Ctau%20=%20F(t,%20X_t)%20-%20F(0,%20X_0)%20-%20%5Cint_0%5Et%20%5Cleft(%20%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20%5Ctau%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%20%5E2F%7D%7B%5Cpartial%20X_%5Ctau%5E2%7D%20%5Cright)%20d%5Ctau%20%5Ctag%7B3%7D"></span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example 3
</div>
</div>
<div class="callout-body-container callout-body">
<p>Express <img src="https://latex.codecogs.com/png.latex?%5Cint_0%5Et%20%5Cleft(%20%5Ctau%20+%20W_%5Ctau%20%5Cright)%20dW_%5Ctau"></p>
<p>Using Equation&nbsp;3, we establish that what is being integrated is <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20W_%5Ctau%7D">, hence <span id="eq-ex31"><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20W_%5Ctau%7D%20=%20%5Ctau%20+%20W_%5Ctau%20%5Ctag%7B4%7D"></span><br>
This allows us to find <img src="https://latex.codecogs.com/png.latex?F"> by integrating both side in regards to <img src="https://latex.codecogs.com/png.latex?W_%5Ctau">. <span id="eq-ex32"><img src="https://latex.codecogs.com/png.latex?F%20=%20%5Ctau%20W_%5Ctau%20+%20%5Cfrac%7B1%7D%7B2%7D%20W_%5Ctau%5E2%20%5Ctag%7B5%7D"></span> and derving Equation&nbsp;5 for <img src="https://latex.codecogs.com/png.latex?%5Ctau">, <span id="eq-ex33"><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20%5Ctau%7D%20=%20W_%5Ctau%20%5Ctag%7B6%7D"></span> and deriving the first derivative Equation&nbsp;4 one more time for <img src="https://latex.codecogs.com/png.latex?dW_%5Ctau">, we get <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20%5E2F%7D%7B%5Cpartial%20W_%5Ctau%5E2%7D%20=%201"> Hence, we can re-write <img src="https://latex.codecogs.com/png.latex?%5Cint_0%5Et%20%5Cleft(%20%5Ctau%20+%20W_%5Ctau%20%5Cright)%20dW_%5Ctau%20=%20%5Cleft(%20%5Ctau%20W_%5Ctau%20+%20%5Cfrac%7B1%7D%7B2%7D%20W_%5Ctau%5E2%20%5Cright)%20-%20%5Cint_0%5Et%20W_%5Ctau%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cspace%20d_%5Ctau"></p>
</div>
</div>


</section>

 ]]></description>
  <category>quant-finance</category>
  <category>stochastic-integrals</category>
  <guid>https://fderyckel.github.io/blog.html/posts/quant-part2/01-SDE-Part1/index.html</guid>
  <pubDate>Fri, 21 Jul 2023 17:00:00 GMT</pubDate>
</item>
<item>
  <title>04 -Martingales</title>
  <dc:creator>Francois de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/quant-part2/04-martingales/index.html</link>
  <description><![CDATA[ 




<p>This post is a collection of notes about Martingales.</p>
<p>A Martingales is a stochastic process that is driftless (aka it is pure randomness or just volatility). We also say that martingales are constant mean stochastic process.</p>
<section id="continuous-time-martingales" class="level1">
<h1>Continuous time martingales</h1>
<p>A continuous time stochastic process <img src="https://latex.codecogs.com/png.latex?%5C%7B%20M_t:%20t%20%5Cin%20%5Cmathbb%7BR%7D%5E+%20%5C%7D"> such that <img src="https://latex.codecogs.com/png.latex?M_t"> is adapted to <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BF%7D_t"> (or is <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BF%7D_t"> measurable) is a martingale if:</p>
<ul>
<li>integrability condition: <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5BM_t%5D%20%5Clt%20%5Cinfty"></li>
<li>conditional expectation condition: <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D_s%5BM_%7Bt%7D%7C%5Cmathcal%7BF%7D_s%5D%20=%20M_s,%20%5Cspace%200%20%5Cleq%20s%20%5Cleq%20t"></li>
</ul>
</section>
<section id="link-between-itô-integrales-and-martingales" class="level1">
<h1>Link between itô integrales and martingales</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Intuitive &amp; Motivating example
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let <img src="https://latex.codecogs.com/png.latex?X"> be a stochastic process and <img src="https://latex.codecogs.com/png.latex?F%20=%20X%5E2(t)">. <a href="../SDE-part1/index.qmd">Recall</a> then <img src="https://latex.codecogs.com/png.latex?F(t)%20=%20t%20+%202%20%5Cint_0%5Et%20X_%7B%5Ctau%7D%20%5Cspace%20d%7B%5Ctau%7D"> <img src="https://latex.codecogs.com/png.latex?X%5E2(t)%20=%20t%20+%202%20%5Cint_0%5Et%20X_%7B%5Ctau%7D%20%5Cspace%20d%7B%5Ctau%7D"> Taking expectation on both side <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%20%5Cleft%5B%20X%5E2(t)%20%5Cright%5D%20=%20t%20+%20%5Cmathbb%7BE%7D%20%5Cleft%5B%202%20%5Cint_0%5Et%20X_%7B%5Ctau%7D%20%5Cspace%20d%7B%5Ctau%7D%20%5Cright%5D"> With the <a href="../../../posts/quant-part1/brownian-motion/index.html">quadratic variation</a> We already know that <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%20%5Cleft%5B%20X%5E2(t)%20%5Cright%5D%20=%20t"> Which means that <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%20%5Cleft%5B%202%20%5Cint_0%5Et%20X_%7B%5Ctau%7D%20%5Cspace%20d%7B%5Ctau%7D%20%5Cright%5D"> should be equal to 0. Which means that the itô integral <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%20%5Cleft%5B%202%20%5Cint_0%5Et%20X_%7B%5Ctau%7D%20%5Cspace%20d%7B%5Ctau%7D%20%5Cright%5D"> is a martingale.</p>
</div>
</div>
<p>Itô integrals are martingales.</p>
<p>Let <img src="https://latex.codecogs.com/png.latex?g(t,%20X_t)"> be a function of a stochastic process, then <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%20%5Cleft%5B%20%5Cint_0%5Et%20g(%5Ctau,%20x_%5Ctau)%20%5Cspace%20dX_%5Ctau%20%5Cright%5D%20=%200"></p>
</section>
<section id="a-continuous-time-stochastic-process-is-a-martingale" class="level1">
<h1>A continuous time stochastic process is a martingale</h1>
<p><img src="https://latex.codecogs.com/png.latex?Yt)"> is a stochastic process that satisfies the following Stochastic Differential Equation <span id="eq-dy1"><img src="https://latex.codecogs.com/png.latex?dY(t)%20=%20f(Y_t,%20t)%20%5Cspace%20dt%20+%20g(Y_t,%20t)%20%5Cspace%20dX(t)%20%5Ctag%7B1%7D"></span> with initial condition <img src="https://latex.codecogs.com/png.latex?Y(0)%20=%200">.</p>
<p>How to tell if <img src="https://latex.codecogs.com/png.latex?Y(t)"> is martingale? We will use the fact, from above, that <em>Itô integrals</em> are martingales. For this, by definition, we need <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D_s%5BY_t%20%7C%20%5Cmathcal%7BF%7D_s%5D%20=%20Y_s%20%5Cspace,%20%5Cspace%200%20%5Cleq%20s%20%5Cleq%20t"></p>
<p>Integrating Equation&nbsp;1 both side, we can get an exact form for <img src="https://latex.codecogs.com/png.latex?Y(t)"> <img src="https://latex.codecogs.com/png.latex?Y(t)%20=%20Y(s)%20+%20%5Cint_s%5Et%20f(Y_u,%20u)%20%5Cspace%20du%20+%20%5Cint_s%5Et%20g(Y_u,%20u)%20%5Cspace%20dX(u)"></p>
<p>Taking the expectation on both side: <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D(Y_t%20%7C%20%5Cmathcal%7BF%7D_s)=%20%5Cmathbb%7BE%7D%20%5Cleft%5BY(s)%20+%20%5Cint_s%5Et%20f(Y_u,%20u)%20%5Cspace%20du%20+%20%5Cint_s%5Et%20g(Y_u,%20u)%20%5Cspace%20dX(u)%20%5Cspace%20%7C%20%5Cmathcal%7BF%7D%20%5Cright%5D"></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D(Y_t%20%7C%20%5Cmathcal%7BF%7D_s)%20=%20Y(s)%20+%20%5Cmathbb%7BE%7D%20%5Cleft%5B%5Cint_s%5Et%20f(Y_u,%20u)%20%5Cspace%20du%20%5Cspace%20%7C%20%5Cmathcal%7BF_s%7D%20%5Cright%5D"></p>
<p>This is because, see above, ito integrals are martingales and <img src="https://latex.codecogs.com/png.latex?%5Cint_s%5Et%20g(Y_u,%20u)%20%5Cspace%20dX(u)"> is an ito integral. Hence, its expectation is 0 ==&gt; <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%20%5Cleft%5B%20%5Cint_s%5Et%20g(Y_u,%20u)%20%5Cspace%20dX(u)%20%5Cright%5D%20=%200"></p>
<p>In order for <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D(Y_t%20%7C%20%5Cmathcal%7BF%7D_s)%20=%20Y(s)">, we now need <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%20%5Cleft%5B%5Cint_s%5Et%20f(Y_u,%20u)%20%5Cspace%20du%20%5Cspace%20%7C%20%5Cmathcal%7BF%7D_s%20%5Cright%5D%20=%200">. This means that <img src="https://latex.codecogs.com/png.latex?f(Y_t,%20t)%20=%200,%20%5Cspace%20%5Cforall%20t">.</p>
<p>Going back to the SDE, we can say that <img src="https://latex.codecogs.com/png.latex?dY(t)"> is a martingale iff <img src="https://latex.codecogs.com/png.latex?dY(t)%20=%20g(Y_t,%20t)%20%5Cspace%20dX(t)"></p>
</section>
<section id="exponential-martingales" class="level1">
<h1>Exponential martingales</h1>
<p>LEt’s consider a stochastic process <img src="https://latex.codecogs.com/png.latex?Y(t)"> that satisfies the following Stochastic Differential Equation: <img src="https://latex.codecogs.com/png.latex?dY(t)%20=%20f(t)%20%5Cspace%20dt%20+%20g(t)%20%5Cspace%20dX(t)"> with initial condition <img src="https://latex.codecogs.com/png.latex?Y(0)%20=%200">. <img src="https://latex.codecogs.com/png.latex?X(t)"> is a Brownian Motion, <img src="https://latex.codecogs.com/png.latex?f(t)"> and <img src="https://latex.codecogs.com/png.latex?g(t)"> are time-dependent functions.</p>
<p>We can now define a new process such that <img src="https://latex.codecogs.com/png.latex?Z(t)%20=%20e%5E%7BY(t)%7D"></p>
<p>How can we ensure <img src="https://latex.codecogs.com/png.latex?Z(t)"> is a martingale? How should we choose <img src="https://latex.codecogs.com/png.latex?f(t)"> such that <img src="https://latex.codecogs.com/png.latex?Z(t)"> is a martingale?</p>


</section>

 ]]></description>
  <category>Stochastic Calculus</category>
  <category>Martingales</category>
  <guid>https://fderyckel.github.io/blog.html/posts/quant-part2/04-martingales/index.html</guid>
  <pubDate>Wed, 19 Jul 2023 17:00:00 GMT</pubDate>
</item>
<item>
  <title>03 - Random-walks &amp; Brownian Motions</title>
  <dc:creator>Francois de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/quant-part1/brownian-motion/index.html</link>
  <description><![CDATA[ 




<p>This post is a collection of notes about Random Walk and Brownian Motions as well as their properties.</p>
<p>This <a href="../../../posts/quant-part1/random-behavior-assets/index.html">post on the random behavior of financial assets</a> might be of interest before to go through this.</p>
<section id="the-probabilty-of-random-walk" class="level1">
<h1>The probabilty of Random Walk</h1>
<p>In the context of quantitative finance, the easiest way to model a random walk is to consider a head/tail type of example which constitutes a <strong>symmetric random walk</strong>.</p>
<section id="expected-returns" class="level2">
<h2 class="anchored" data-anchor-id="expected-returns">Expected Returns</h2>
<p>So let’s define a Discrete Random Variable <img src="https://latex.codecogs.com/png.latex?R_i"> as the i-th toss of a coin. And <img src="https://latex.codecogs.com/png.latex?R"> takes the value <img src="https://latex.codecogs.com/png.latex?1"> if it’s a tail and <img src="https://latex.codecogs.com/png.latex?-1"> if it’s a head.</p>
<p>The expectation of <img src="https://latex.codecogs.com/png.latex?R_i"> is then: <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5BR_i%5D%20=%20%5Cfrac%7B1%7D%7B2%7D%20%5Ccdot%201%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Ccdot%20-1%20=%200"></p>
<p>The variance of <img src="https://latex.codecogs.com/png.latex?R_i"> is then: <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BV%7Dar%5BR_i%5D%20=%20%5Cmathbb%7BE%7D%5BR_i%5E2%5D%20-%20%5Cmathbb%7BE%7D%5BR_i%5D%5E2%20=%20%5Cleft(%20%5Cfrac%7B1%7D%7B2%7D%20%5Ccdot%20(1)%5E2%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Ccdot%20(-1)%5E2%20%5Cright)%20-%200%5E2%20=%201"></p>
</section>
<section id="expected-sum-of-returns" class="level2">
<h2 class="anchored" data-anchor-id="expected-sum-of-returns">Expected Sum of Returns</h2>
<p>Let’s now define another Discrete Random Variable <img src="https://latex.codecogs.com/png.latex?S_i"> which is the sum of the returns after n toss. Hence, <img src="https://latex.codecogs.com/png.latex?S_i%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20R_i"> with an initial condition that <img src="https://latex.codecogs.com/png.latex?S_0=0">. This initial condition not only makes sense (we did not win any money before to start the game) but it will also constitutes an important initial condition in the definition of Brownian Motion (or Wiener Process)</p>
<p>The expectation of <img src="https://latex.codecogs.com/png.latex?S_i"> is then: <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5BS_i%5D%20=%20%5Cmathbb%7BE%7D%20%5Cleft%5B%20%5Csum_%7Bi=0%7D%5E%7Bn%7D%20R_i%20%5Cright%5D%20=%20%5Cmathbb%7BE%7D%20%5Cleft%5B%20R_0%20+%20R_1%20+%20%5Cdots%20+%20R_n%20%5Cright%5D%20=%20%5Cmathbb%7BE%7D%5BR_0%5D%20+%20%5Cmathbb%7BE%7D%5BR_1%5D%20+%20%5Cdots%20+%20%5Cmathbb%7BE%7D%5BR_n%5D%20=%200%20+%200%20+%20%5Cdots%20+%200%20=%200%20"></p>
<p>And the variance of <img src="https://latex.codecogs.com/png.latex?S_i"> is then: <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BV%7Dar%5BS_i%5D%20=%20%5Cmathbb%7BE%7D%5BS_i%5E2%5D%20-%20%5Cmathbb%7BE%7D%5BS_i%5D%5E2"></p>
<p>Note how the second term <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5BS_i%5D%5E2%20=%200"></p>
<p><span id="eq-var1"><img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BV%7Dar%5BS_i%5D%20=%20%5Cmathbb%7BE%7D%20%5Cleft%5B%20%5Cleft(%20%5Csum_%7Bi=0%7D%5E%7Bn%7D%20R_i%20%5Cright)%5E2%20%5Cright%5D%20=%20%5Cmathbb%7BE%7D%20%5Cleft%5B%20R_0%5E2%20+%20R_1%5E2%20+%20%5Cdots%20+%20R_n%5E2%20+%202R_1R_2%20+%202R_1R_3%20+%20%5Ccdots%20%5Cright%5D%20%5Ctag%7B1%7D"></span></p>
<p>Because the events are independents, <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5BR_i%20R_j%5D%20=%200">. Hence all the double terms in Equation&nbsp;1 above are equals to 0 and <span id="eq-var2"><img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BV%7Dar%5BS_i%5D%20=%20%5Cmathbb%7BE%7D%5BR_0%5E2%5D%20+%20%5Cmathbb%7BE%7D%5BR_1%5E2%5D%20+%20%5Cdots%20+%20%5Cmathbb%7BE%7D%5BR_n%5E2%5D%20=%201%20+%201%20+%20%5Cdots%20+%201%20=%20n%20%5Ccdot%201%20=%20n%20%5Ctag%7B2%7D"></span></p>
</section>
<section id="the-markov-property" class="level2">
<h2 class="anchored" data-anchor-id="the-markov-property">The Markov Property</h2>
<p>Imagine, we already threw the coin a few times, let’s say 10 times. Now, we have some additional information as we know <img src="https://latex.codecogs.com/png.latex?S_%7B10%7D">. We could ask ourselves the question what is the expectation for the next toss considering that additional information. It would make sense to say that we will get no more no less that what we already have since <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5BR_i%5D%20=%200">. Mathematically, we can write this: <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5Cleft%5B%20S_%7Bi+1%7D%20%7C%20R_1,%20R_2,%20%5Cdots,%20R_i%20%5Cright%5D%20=%20S_i"></p>
<p>The expected value of <img src="https://latex.codecogs.com/png.latex?S_i"> is only dependent of the previous value <img src="https://latex.codecogs.com/png.latex?s_%7Bi-1%7D"> and not of any previous values (no memory beyond the one prior value)</p>
<p>The idea of the <em>Markov Property</em> is to say that the Random Walk Stochastic Process has no memory beyond the point where it (the walker) is now.</p>
</section>
<section id="the-martingale-property" class="level2">
<h2 class="anchored" data-anchor-id="the-martingale-property">The Martingale Property</h2>
<p>The conditional probability of any point in the future is what you already have.</p>
<p>And actually, we can generalize this further and state that: <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5Cleft%5B%20S_i%20%7C%20S_j%20%5Cspace%20%5Cforall%20i%20%5Cgt%20j%20%5Cright%5D%20=%20S_j"></p>
<p>In a ‘fair game’, knowledge of the past will be of no value in predicting future events.</p>
</section>
<section id="the-quadratic-variation" class="level2">
<h2 class="anchored" data-anchor-id="the-quadratic-variation">The Quadratic Variation</h2>
<p>The quadratic variation of a random walk is defined as <img src="https://latex.codecogs.com/png.latex?%5Csum_%7Bi=1%7D%5En%20(S_i%20-%20S_%7Bi-1%7D)%5E2"></p>
<p>The quadratic variation will be an extremely important concept as we extend the random-walk from a discrete time model to a continuous time model (aka to a Brownian Motion or Wiener process).</p>
<p>Intuitively, it makes sense to say that <img src="https://latex.codecogs.com/png.latex?(S_i%20-%20S_%7Bi-1%7D)%20=%20%5Cpm%201"> Hence <img src="https://latex.codecogs.com/png.latex?(S_i%20-%20S_%7Bi-1%7D)%5E2%20=%201"> Hence <img src="https://latex.codecogs.com/png.latex?%5Csum_%7Bi=1%7D%5En%20(S_i%20-%20S_%7Bi-1%7D)%5E2%20=%20n"></p>
</section>
</section>
<section id="quadratic-variation-and-transition-to-continuous-time" class="level1">
<h1>Quadratic variation and transition to continuous time</h1>
<p>In the previous setting, each unit of time was 1 unit and bet sizes were <img src="https://latex.codecogs.com/png.latex?%5Cpm%201">. We are making 2 changes to this situation.</p>
<ul>
<li>Now, we think of a time as <em>a certain amount of time</em> that we call <img src="https://latex.codecogs.com/png.latex?t">. That ‘certain amount of time’ is continuous and we can chunk it down into <img src="https://latex.codecogs.com/png.latex?n"> pieces. In this context, each piece of time is <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7Bt%7D%7Bn%7D"> long. The goal will be to increase the size of <img src="https://latex.codecogs.com/png.latex?n"> until <img src="https://latex.codecogs.com/png.latex?n%20%5CRightarrow%20%5Cinfty"></li>
<li>the bet size are now <img src="https://latex.codecogs.com/png.latex?%5Csqrt%20%5Cfrac%7Bt%7D%7Bn%7D"></li>
</ul>
<p>To feel why are we making these changes, let’s revisit the quadratic variation on these new units of time and bet sizes. <img src="https://latex.codecogs.com/png.latex?S_%7Bi+1%7D%20-%20S_i%20=%20%5Cpm%20%5Csqrt%7B%5Cfrac%7Bt%7D%7Bn%7D%7D"> Quadratic variation is now <span id="eq-quad-variation"><img src="https://latex.codecogs.com/png.latex?%5Csum_%7Bi=1%7D%5En%20%5Cleft(%20%5Cpm%20%5Csqrt%7B%5Cfrac%7Bt%7D%7Bn%7D%7D%20%5Cright)%5E2%20=%20n%20%5Ccdot%20%5Cfrac%7Bt%7D%7Bn%7D%20=%20t%20%5Ctag%7B3%7D"></span></p>
<p>In this way, the quadratic variation is the total time of the coin tossing. This time is still finite.</p>
<p>In this experiment, both the markov and martingale properties are still valid.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Notes
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that:</p>
<ul>
<li>as n increases, the time decreases by a factor of <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7Bn%7D"></li>
<li>as n increases, the bet size decreases by a factor of <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7B%5Cfrac%7B1%7D%7Bn%7D%7D"></li>
<li>as n increases to <img src="https://latex.codecogs.com/png.latex?%5Cinfty">, both the time and the bets size will decrease to <img src="https://latex.codecogs.com/png.latex?0"> but not in the same way (by the same order)</li>
<li>as n increases to <img src="https://latex.codecogs.com/png.latex?%5Cinfty">, the random walk stays finite! The random-walk stays continuous everywhere but differentiable nowhere</li>
<li>the limiting process as n tends to <img src="https://latex.codecogs.com/png.latex?%5Cinfty"> and time tends to <img src="https://latex.codecogs.com/png.latex?0"> (think <img src="https://latex.codecogs.com/png.latex?dt">) creates a Brownian Motion (the Continuous random variable is called <img src="https://latex.codecogs.com/png.latex?B_t">) or Wiener process (variable called <img src="https://latex.codecogs.com/png.latex?W_t">)</li>
</ul>
</div>
</div>
<p>Why does it matter that the time-step is <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7Bt%7D%7Bn%7D"> and the bet-size is <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7B%5Cfrac%7B1%7D%7Bn%7D%7D">? Any other choice would have not made the random-walk finite (it could have gone to infinity into a finite time or not move at all)</p>
</section>
<section id="the-probability-of-wiener-processes-or-brownian-motions" class="level1">
<h1>The probability of Wiener Processes or Brownian Motions</h1>
<p>Although Brownian motions and Weiner processes are often used interchangeably, there is semantic difference, one could make. Brownian motion is the physical phenomenon of random movement of microscopic particles suspended in a fluid, such as dust in air or pollen in water. Wiener process is a mathematical model of Brownian motion, which is a continuous-time stochastic process that satisfies the following properties. The Weiner process models the standard Brownian motion. They are other type of Brownian motions that are not modeled by the Weiner process like geometric brownian motion, fractional brownian motion and Ornstein-Uhlenbeck process.</p>
<p>We denotes a Wiener Process as <img src="https://latex.codecogs.com/png.latex?W_t"> or <img src="https://latex.codecogs.com/png.latex?W(t)"> with initial condition that <img src="https://latex.codecogs.com/png.latex?W_0%20=%200"> or <img src="https://latex.codecogs.com/png.latex?W(0)%20=%200"></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
definition of a Weiner process
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><img src="https://latex.codecogs.com/png.latex?W_0%20=%200"></li>
<li><img src="https://latex.codecogs.com/png.latex?W_t"> is a continuous path (continuous everywhere, differentiable nowhere)</li>
<li>independent increments. For <img src="https://latex.codecogs.com/png.latex?t_1%20%3C%20t_2%20%3C%20t_3%20%3C%20t_4%20%3C%20%5Ccdots">, <img src="https://latex.codecogs.com/png.latex?W_%7Bt_4%7D%20-%20W_%7Bt_3%7D"> and <img src="https://latex.codecogs.com/png.latex?W_%7Bt_2%7D%20-%20W_%7Bt_1%7D"> are independent. In other words, the change in the process over any time interval is independent of its past and future values.</li>
<li>normally distributed increments. <img src="https://latex.codecogs.com/png.latex?%7CW_t%20-%20W_s%7C%20%5Csim%20N(0,%20%7Ct-s%7C)"> The variance is equivalent to the length of the interval.</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example. Show that <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D_s%20%5Cleft%5B%20W_t%20%7C%20%5Cmathcal%7BF_s%7D%20%5Cright%5D%20=%20W_s">
</div>
</div>
<div class="callout-body-container callout-body">
<p>In other words, let’s show that the expectation of the stochastic process <img src="https://latex.codecogs.com/png.latex?W_t"> upon the condition that we know everything up to the point <img src="https://latex.codecogs.com/png.latex?s"> [<img src="https://latex.codecogs.com/png.latex?W_t"> is <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BF%7D_s"> measurable] is <img src="https://latex.codecogs.com/png.latex?W_s"></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D_s%20%5Cleft%5B%20W_t%20%7C%20%5Cmathcal%7BF_s%7D%20%5Cright%5D%20=%20%5Cmathbb%7BE%7D_s%20%5Cleft%5B%20W_t%20-%20W_s%20+%20W_S%20%7C%20%5Cmathcal%7BF_s%7D%20%5Cright%5D%20=%20%5Cmathbb%7BE%7D_s%20%5Cleft%5B%20W_t%20-W_s%7C%20%5Cmathcal%7BF_s%7D%20%5Cright%5D%20+%20%5Cmathbb%7BE%7D_s%20%5Cleft%5B%20W_s%20%7C%20%5Cmathcal%7BF_s%7D%20%5Cright%5D"> Because (bullet point #4) increments of a Brownian motion are normally distributed with mean 0: <img src="https://latex.codecogs.com/png.latex?%7CW_t%20-%20W_s%7C%20%5Csim%20N(0,%20%7Ct-s%7C)">, we can establish that <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D_s%20%5Cleft%5B%20W_t%20-W_s%7C%20%5Cmathcal%7BF_s%7D%20%5Cright%5D%20=%200"></p>
<p>Hence: <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D_s%20%5Cleft%5B%20W_t%20%7C%20%5Cmathcal%7BF_s%7D%20%5Cright%5D%20%20=%20%5Cmathbb%7BE%7D_s%20%5Cleft%5B%20W_s%20%7C%20%5Cmathcal%7BF_s%7D%20%5Cright%5D%20=%20W_s"></p>
</div>
</div>
<section id="properties-of-weiner-processes" class="level2">
<h2 class="anchored" data-anchor-id="properties-of-weiner-processes">Properties of Weiner processes</h2>
<ul>
<li>They are <strong>finite</strong> - thanks to the increment (y-axis) scale with the square root of the time-steps</li>
<li>they are <strong>continuous</strong> - limit when time-steps are infinitely small and the random-walk is becoming continuous</li>
<li>follow <strong>Markov property</strong></li>
<li>follow <strong>Martingale property</strong></li>
<li>the quadratic variation from 0 to t is <img src="https://latex.codecogs.com/png.latex?t"> itself - see Equation&nbsp;3</li>
<li><strong>normality</strong>. <img src="https://latex.codecogs.com/png.latex?W(t_i)%20-%20W(t_%7Bi-1%7D)"> is normally distributed with mean 0 and variance <img src="https://latex.codecogs.com/png.latex?t_i%20-%20t_%7Bi-1%7D"></li>
</ul>
</section>
<section id="expectation-of-w_t" class="level2">
<h2 class="anchored" data-anchor-id="expectation-of-w_t">Expectation of <img src="https://latex.codecogs.com/png.latex?W_t"></h2>
<p>Expectation is the same as in the random-walk except this time we are using the limit when <img src="https://latex.codecogs.com/png.latex?n%20%5Cto%200">. <span id="eq-exp-bm"><img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5BW_t%5D%20=%20%5Cmathbb%7BE%7D%20%5Cleft%5B%5Clim_%7Bn%20%5Cto%20%5Cinfty%7D%20%5Csum_%7Bi=1%7D%5En%20R_i%5Cright%5D%20=%20%5Clim_%7Bn%20%5Cto%20%5Cinfty%7D%20%5Csum_%7Bi=1%7D%5En%20%5Cmathbb%7BE%7D%5BR_i%5D%20=%20n%20%5Ccdot%200%20=%200%20%5Ctag%7B4%7D"></span></p>
<p>In this sense, the mean of <img src="https://latex.codecogs.com/png.latex?W_t%20=%200">.</p>
</section>
<section id="variance-of-w_t" class="level2">
<h2 class="anchored" data-anchor-id="variance-of-w_t">Variance of <img src="https://latex.codecogs.com/png.latex?W_t"></h2>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BV%7Dar%5BW_t%5D%20=%20%5Cmathbb%7BE%5BW_t%5E2%5D%7D%20-%20%5Cmathbb%7BE%7D%5BW_t%5D%5E2"></p>
<p>From Equation&nbsp;4, we already know that <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5BW_t%5D%20=%200">; hence <img src="https://latex.codecogs.com/png.latex?%5Cleft(%20%5Cmathbb%7BE%7D%5BW_t%5D%20%5Cright)%5E2"> is also <img src="https://latex.codecogs.com/png.latex?0"></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5BW_t%5E2%5D%20=%20%5Cmathbb%7BE%7D%5Cleft%5B%5Clim_%7Bn%20%5Cto%20%5Cinfty%7D%20%5Csum_%7Bi=1%7D%5En%20R_i%5E2%20%5Cright%5D%20=%20%5Clim_%7Bn%20%5Cto%20%5Cinfty%7D%20%5Csum_%7Bi=1%7D%5En%20%5Cmathbb%7BE%7D%5BR_i%5E2%5D%20=%20%5Clim_%7Bn%20%5Cto%20%5Cinfty%7D%20n%20%5Ccdot%20%5Cleft(%20%5Csqrt%7B%5Cfrac%7Bt%7D%7Bn%7D%7D%20%5Cright)%5E2%20=%20t"></p>


</section>
</section>

 ]]></description>
  <category>Random Walk</category>
  <category>Brownian Motion</category>
  <category>Weiner Process</category>
  <category>Quadratic Variation</category>
  <guid>https://fderyckel.github.io/blog.html/posts/quant-part1/brownian-motion/index.html</guid>
  <pubDate>Wed, 19 Jul 2023 17:00:00 GMT</pubDate>
  <media:content url="https://fderyckel.github.io/blog.html/posts/quant-part1/brownian-motion/random-walk.png" medium="image" type="image/png" height="165" width="144"/>
</item>
<item>
  <title>Black-Schole Equation</title>
  <dc:creator>Francois de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/quant-part3/black-schole/index.html</link>
  <description><![CDATA[ 




<section id="deriving-the-black-schole-equation" class="level1">
<h1>Deriving the Black-Schole Equation</h1>
</section>
<section id="solving-the-black-schole-equation" class="level1">
<h1>Solving the Black-Schole Equation</h1>
</section>
<section id="recap" class="level1">
<h1>Recap</h1>
<section id="european-vanilla" class="level2">
<h2 class="anchored" data-anchor-id="european-vanilla">European Vanilla</h2>
<p><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20t%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Csigma%5E2%20S%20%5Cfrac%7B%5Cpartial%5E2%20V%7D%7B%5Cpartial%20S%5E2%7D%20+%20r%20S%20%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20S%7D%20-%20rV%20=%200"></p>
<ul>
<li>V is the option price at the time <img src="https://latex.codecogs.com/png.latex?t">. So <img src="https://latex.codecogs.com/png.latex?V%20=%20V(S,%20t)"><br>
</li>
<li>S is the asset spot price</li>
<li>t is the time to expiry (in years)</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Csigma"> is the asset diffusion term (its stochastic element)</li>
<li><img src="https://latex.codecogs.com/png.latex?r"> is the annualized continuously compounded risk-free rate (imaginary friend)</li>
</ul>
<p>In the case of a <strong>European Call Option with no-dividend</strong>, the BSE has solution:</p>
<p><img src="https://latex.codecogs.com/png.latex?C%20=%20S%20N(d_1)%20-%20K%20e%5E%7B-r(T-t)%7D%20N(d_2)"></p>
<p>And in the case of a <strong>European Put Option with no-dividend</strong>, the BSE has solution: <img src="https://latex.codecogs.com/png.latex?P%20=%20K%20e%5E%7B-r(T-t)%7DN(-d_2)%20-%20SN(-d_1)"></p>
<p>where, <img src="https://latex.codecogs.com/png.latex?d_1%20=%20%5Cfrac%7B1%7D%7B%5Csigma%20%5Csqrt%7BT-t%7D%7D%20%5Cleft%5B%20ln%20%5Cleft(%20%5Cfrac%7BS%7D%7BK%7D%20%5Cright)%20+%20%5Cleft(%20r%20+%20%5Cfrac%7B%5Csigma%5E2%7D%7B2%7D%20%5Cright)%20(T-t)%20%5Cright%5D"></p>
<p><img src="https://latex.codecogs.com/png.latex?d_2%20=%20%5Cfrac%7B1%7D%7B%5Csigma%20%5Csqrt%7BT-t%7D%7D%20%5Cleft%5B%20ln%20%5Cleft(%20%5Cfrac%7BS%7D%7BK%7D%20%5Cright)%20+%20%5Cleft(%20r%20-%20%5Cfrac%7B%5Csigma%5E2%7D%7B2%7D%20%5Cright)%20(T-t)%20%5Cright%5D%20=%20d1%20-%20%5Csigma%20%5Csqrt%7BT-t%7D"></p>
<p><img src="https://latex.codecogs.com/png.latex?N(x)%20=%20%5Cfrac%7B1%7D%7B%5Csqrt%7B2%20%5Cpi%7D%7D%20%5Cint_%7B-%5Cinfty%7D%5E%7Bx%7D%20e%5E%7B%5Cfrac%7B-1%7D%7B2%7D%20x%5E2%7D%20dx"></p>
<ul>
<li>K is the strike price</li>
</ul>
</section>
<section id="european-vanilla-with-dividends" class="level2">
<h2 class="anchored" data-anchor-id="european-vanilla-with-dividends">European Vanilla with Dividends</h2>
<p>And in the case of a dividend (ok … assuming continuous dividend yield):</p>
<p><img src="https://latex.codecogs.com/png.latex?C%20=%20S%20e%5E%7B-D(T-t)%7D%20N(d_1)%20-%20K%20e%5E%7B-r(T-t)%7D%20N(d_2)"></p>
<p><img src="https://latex.codecogs.com/png.latex?P%20=%20K%20e%5E%7B-r(T-t)%7DN(-d_2)%20-%20Se%5E%7B-D(T-t)%7DN(-d_1)"></p>
<p><img src="https://latex.codecogs.com/png.latex?d_1%20=%20%5Cfrac%7B1%7D%7B%5Csigma%20%5Csqrt%7BT-t%7D%7D%20%5Cleft%5B%20ln%20%5Cleft(%20%5Cfrac%7BS%7D%7BK%7D%20%5Cright)%20+%20%5Cleft(%20r%20-%20D%20+%20%5Cfrac%7B%5Csigma%5E2%7D%7B2%7D%20%5Cright)%20(T-t)%20%5Cright%5D"></p>
<p><img src="https://latex.codecogs.com/png.latex?d_2%20=%20%5Cfrac%7B1%7D%7B%5Csigma%20%5Csqrt%7BT-t%7D%7D%20%5Cleft%5B%20ln%20%5Cleft(%20%5Cfrac%7BS%7D%7BK%7D%20%5Cright)%20+%20%5Cleft(%20r%20-%20D%20-%20%5Cfrac%7B%5Csigma%5E2%7D%7B2%7D%20%5Cright)%20(T-t)%20%5Cright%5D%20=%20d1%20-%20%5Csigma%20%5Csqrt%7BT-t%7D"></p>
</section>
</section>
<section id="the-greeks" class="level1">
<h1>The Greeks</h1>
<table class="table">
<colgroup>
<col style="width: 14%">
<col style="width: 56%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th>Greek</th>
<th>Description</th>
<th>Formula</th>
<th>Call Option</th>
<th>Put Option</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Delta</td>
<td>Sensitivity of option value to changes in asset price</td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20S%7D"></td>
<td><img src="https://latex.codecogs.com/png.latex?N(d_1)"></td>
<td><img src="https://latex.codecogs.com/png.latex?-N(-d_!)"></td>
</tr>
<tr class="even">
<td>Gamma</td>
<td>Sensitivity of Delta to changes in asset price</td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%5E2%20V%7D%7B%5Cpartial%20S%5E2%7D"></td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7BN(d_1)%7D%7BS%20%5Csigma%20%5Csqrt%7Bt%7D%7D"></td>
<td></td>
</tr>
<tr class="odd">
<td>Vega</td>
<td>Sensitivity of option value to changes in volatility</td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20%5Csigma%7D"></td>
<td><img src="https://latex.codecogs.com/png.latex?S%20N(d_1)%20%5Csqrt%7Bt%7D"></td>
<td></td>
</tr>
<tr class="even">
<td>Theta</td>
<td>Sensitivity of option value to changes in time</td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20t%7D"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Rho</td>
<td>Sensitivity of option value to change in risk-free rate</td>
<td><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20V%7D%7B%5Cpartial%20r%7D"></td>
<td><img src="https://latex.codecogs.com/png.latex?Kte%5E%7B-rt%7D%20N(d_2)"></td>
<td><img src="https://latex.codecogs.com/png.latex?-Kte%5E%7B-rt%7D%20N(-d_2)"></td>
</tr>
</tbody>
</table>
</section>
<section id="create-a-function-for-numerical-computation" class="level1">
<h1>Create a function for numerical computation</h1>
<section id="using-python" class="level2">
<h2 class="anchored" data-anchor-id="using-python">Using Python</h2>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> norm</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt </span>
<span id="cb1-5"></span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> option_pricing: </span>
<span id="cb1-8">  </span>
<span id="cb1-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  To price European Style options without dividends</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  """</span></span>
<span id="cb1-12">  </span>
<span id="cb1-13">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, spot, strike, rate, dte, sigma): </span>
<span id="cb1-14">    </span>
<span id="cb1-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># assign our variables</span></span>
<span id="cb1-16">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.spot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> spot</span>
<span id="cb1-17">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.strike <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> strike</span>
<span id="cb1-18">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rate</span>
<span id="cb1-19">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.dte <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dte    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># days to expiration (in years)</span></span>
<span id="cb1-20">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sigma</span>
<span id="cb1-21">    </span>
<span id="cb1-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># to avoid zero division, let not allow strike of 0</span></span>
<span id="cb1-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.strike <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>: </span>
<span id="cb1-24">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ZeroDivisionError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'The Strike Price cannot be 0'</span>)</span>
<span id="cb1-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>: </span>
<span id="cb1-26">      <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._d1_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (np.log(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.spot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.strike) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dte) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.dte<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb1-27">      <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._d2_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._d1_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.dte<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) </span>
<span id="cb1-28">    </span>
<span id="cb1-29">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'callPrice'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'putPrice'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'callDelta'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'putDelta'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gamma'</span>]: </span>
<span id="cb1-30">      <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.__dict__[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb1-31">      </span>
<span id="cb1-32">    [<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.callPrice, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.putPrice] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._price() </span>
<span id="cb1-33">    [<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.callDelta, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.putDelta] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._delta()</span>
<span id="cb1-34">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.gamma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._gamma()</span>
<span id="cb1-35">    </span>
<span id="cb1-36">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _price(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>): </span>
<span id="cb1-37">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">or</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.dte <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>: </span>
<span id="cb1-38">        call <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> maximum(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.spot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.strike)</span>
<span id="cb1-39">        put <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> maximum(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.strike <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.spot) </span>
<span id="cb1-40">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>: </span>
<span id="cb1-41">        call <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.spot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.cdf(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._d1_)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.strike <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.e<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.dte) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.cdf(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._d2_))</span>
<span id="cb1-42">        put <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.strike <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.e<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.dte) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.cdf(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._d2_)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.spot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.cdf(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._d1_))</span>
<span id="cb1-43">      <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> [call, put] </span>
<span id="cb1-44">    </span>
<span id="cb1-45">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _delta(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>): </span>
<span id="cb1-46">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">or</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.dte <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>: </span>
<span id="cb1-47">      call <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.spot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.strike <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb1-48">      put <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.spot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.strike <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb1-49">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>: </span>
<span id="cb1-50">      call <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> norm.cdf(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._d1_)</span>
<span id="cb1-51">      put <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>norm.cdf(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._d1_)</span>
<span id="cb1-52">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> [call, put]</span>
<span id="cb1-53">  </span>
<span id="cb1-54">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> _gamma(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>): </span>
<span id="cb1-55">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> norm.cdf(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>._d1_) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.spot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.dte<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> tabulate <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tabulate</span>
<span id="cb2-2"></span>
<span id="cb2-3">option <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> option_pricing(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span>
<span id="cb2-4"></span>
<span id="cb2-5">header <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Call Price'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Put Price'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Call Delta'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gamma'</span>]</span>
<span id="cb2-6">table <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [[option.callPrice, option.putPrice, option.callDelta, option.gamma]]</span>
<span id="cb2-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(tabulate(table, header))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Call Price    Put Price    Call Delta      Gamma
------------  -----------  ------------  ---------
     7.96557      7.96557      0.539828  0.0269914</code></pre>
</div>
</div>
</section>
<section id="retrieving-option-data-using-yahoo-finance" class="level2">
<h2 class="anchored" data-anchor-id="retrieving-option-data-using-yahoo-finance">Retrieving option data using Yahoo finance</h2>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> yfinance <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> yf </span>
<span id="cb4-2"></span>
<span id="cb4-3">amd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> yf.Ticker(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'AMD'</span>)</span>
<span id="cb4-4">amd_hist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> amd.history(start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2022-01-01'</span>)</span>
<span id="cb4-5">options <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> amd.option_chain(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2023-12-15'</span>)</span>
<span id="cb4-6"></span>
<span id="cb4-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime</span>
<span id="cb4-8">dte <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (datetime(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> datetime.today()).days </span>
<span id="cb4-9"></span>
<span id="cb4-10">log_returns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.log(amd_hist[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Close'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> amd_hist[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Close'</span>].shift(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)).dropna()</span>
<span id="cb4-11">historical_vol <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> log_returns.std() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(dte)</span>
<span id="cb4-12"></span>
<span id="cb4-13">spot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">116</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> strike <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span></span>
<span id="cb4-14"></span>
<span id="cb4-15">amd_opt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> option_pricing(spot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>spot, strike<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>strike, rate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>rate, dte<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dte<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>, sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>historical_vol)</span>
<span id="cb4-16"></span>
<span id="cb4-17"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'The BS model for AMD 147 days ahead is </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>amd_opt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>callPrice<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:0.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The BS model for AMD 147 days ahead is 2.7995</code></pre>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> options.calls[(options.calls[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'strike'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> (options.calls[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'strike'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>)]</span>
<span id="cb6-2">df.reset_index(drop <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, inplace <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb6-3"></span>
<span id="cb6-4">df1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'strike'</span>: df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'strike'</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'price'</span>: df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lastPrice'</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'impl_vol'</span>: df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'impliedVolatility'</span>]})</span>
<span id="cb6-5">df1[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'delta'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gamma'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.</span></span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(df1)): </span>
<span id="cb6-8">  df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'delta'</span>].iloc[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> option_pricing(spot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>spot, strike<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'strike'</span>].iloc[i], rate, dte<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dte, sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df1[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'impl_vol'</span>].iloc[i]).callDelta</span></code></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(df1)):</span>
<span id="cb7-2">    </span>
<span id="cb7-3">    df1[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Delta'</span>].iloc[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> option_pricing(spot,df1[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'strike'</span>].iloc[i],rate,dte,df1[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'impl_vol'</span>].iloc[i]).callDelta</span>
<span id="cb7-4">    df1[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gamma'</span>].iloc[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> option_pricing(spot,df1[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'strike'</span>].iloc[i],rate,dte,df1[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'impl_vol'</span>].iloc[i]).gamma</span></code></pre></div>
</div>


</section>
</section>

 ]]></description>
  <category>Black-Schole</category>
  <category>Risk Neutrality</category>
  <category>Greeks</category>
  <guid>https://fderyckel.github.io/blog.html/posts/quant-part3/black-schole/index.html</guid>
  <pubDate>Mon, 17 Jul 2023 17:00:00 GMT</pubDate>
  <media:content url="https://fderyckel.github.io/blog.html/posts/quant-part3/black-schole/blacl-scholes.jpeg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>03 - Stochastic Calculus - Part III</title>
  <dc:creator>Francois de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/quant-part2/03-SDE-part3/index.html</link>
  <description><![CDATA[ 




<section id="recall" class="level1">
<h1>Recall</h1>
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 88%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Itô Lemma</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="https://latex.codecogs.com/png.latex?F(X_t)"></td>
<td><img src="https://latex.codecogs.com/png.latex?dF%20=%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7Bd%5E2F%7D%7BdX%5E2%7D%20%5Cspace%20dt%20+%20%5Cfrac%7BdF%7D%7BdX%7D%20%5Cspace%20dx"></td>
</tr>
<tr class="even">
<td><img src="https://latex.codecogs.com/png.latex?F(t,%20X_t)"></td>
<td><img src="https://latex.codecogs.com/png.latex?dF%20=%20%5Cleft(%20%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20t%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%5E2%20F%7D%7B%5Cpartial%20X%5E2%7D%20%5Cright)%20dt%20+%20%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20X%7D%20dX"></td>
</tr>
<tr class="odd">
<td><img src="https://latex.codecogs.com/png.latex?V(S)"> when <img src="https://latex.codecogs.com/png.latex?dS%20=%20%5Cmu%20S%20dt%20+%20%5Csigma%20S%20dX"></td>
<td><img src="https://latex.codecogs.com/png.latex?dV%20=%20%5Cleft(%20%5Cmu%20S%20%5Cfrac%7BdV%7D%7BdS%7D%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Csigma%5E2%20S%5E2%20%5Cfrac%7Bd%5E2V%7D%7BdS%5E2%7D%20%5Cright)dt%20+%20%5Cleft(%20%5Csigma%20S%20%5Cfrac%7BdV%7D%7BdS%7D%5Cright)%20dX"></td>
</tr>
</tbody>
</table>
</section>
<section id="itô-integrals-as-non-anticipatory" class="level1">
<h1>Itô Integrals as non-anticipatory</h1>
<p>Let’s consider the stochastic integral of the form <img src="https://latex.codecogs.com/png.latex?%5Cint_0%5ET%20f(t,%20X(t))%20dX(t)"> where <img src="https://latex.codecogs.com/png.latex?X_t"> is a Brownian motion. We’ll shorten this form to <img src="https://latex.codecogs.com/png.latex?%5Cint_0%5ET%20f(t,%20X)%20dX"></p>
<p>We define this integral as <img src="https://latex.codecogs.com/png.latex?%5Cint_0%5ET%20f(t,%20X)%20dX%20=%20%5Clim_%7BN%20%5Cto%20%5Cinfty%7D%20%5Csum_%7Bi=0%7D%5E%7BN-1%7D%20f(t_i,%20X_i)%20%5Ccdot%20%5Cunderbrace%7B%20(X_%7Bi+1%7D%20-%20X_i)%20%7D_%7BdX%7D"></p>
<p>It’s important to define it this way in order for the itô integral to stay <strong>non-anticipatory</strong>. We know everything up to time <img src="https://latex.codecogs.com/png.latex?t_i"> and so the only uncertainties left is <img src="https://latex.codecogs.com/png.latex?X_%7Bi+1%7D%20-%20X_i"> which is <img src="https://latex.codecogs.com/png.latex?dX"></p>
</section>
<section id="product-rule-within-stochastic-calculus" class="level1">
<h1>Product rule within Stochastic Calculus</h1>
<p>When dealing with Stochastic Differential Equations, we can adapt some of the rules of classical calculus such as the product rule: <img src="https://latex.codecogs.com/png.latex?d(xy)%20=%20xdy%20+%20ydx"></p>
<p>Let’s say we have 2 stochastic processes: <img src="https://latex.codecogs.com/png.latex?d(X(t))%20=%20%5Cmu_1%20X(t)%20dt%20+%20%5Csigma_1%20X(t)%20%20dW_t"> <img src="https://latex.codecogs.com/png.latex?d(Y(t))%20=%20%5Cmu_2%20Y(t)%20dt%20+%20%5Csigma_2%20Y(t)%20dW_t"></p>
<p>And we define a function <img src="https://latex.codecogs.com/png.latex?F"> which is a product of these 2 stochastic processes such that <img src="https://latex.codecogs.com/png.latex?F%20=%20F(X,Y)%20=%20XY">.</p>
<p>Using a Taylor Series Expansion, we can write: <img src="https://latex.codecogs.com/png.latex?F(X%20+%20dX,%20Y%20+%20dY)%20%5Capprox%20F(X,Y)%20+%20%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20X%7D%20dX%20+%20%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20Y%7D%20dY%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%5E2F%7D%7B%5Cpartial%20X%5E2%7D%20dX%5E2%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%5E2F%7D%7B%5Cpartial%20Y%5E2%7D%20dY%5E2%20+%20%5Cfrac%7B%5Cpartial%5E2F%7D%7B%5Cpartial%20X%20%5Cpartial%20Y%7D%20dXdY%20+%20%5Cdots"></p>
<p>Hence, <span id="eq-product-TS-expan"><img src="https://latex.codecogs.com/png.latex?dF%20=%20%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20X%7D%20dX%20+%20%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20Y%7D%20dY%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%5E2F%7D%7B%5Cpartial%20X%5E2%7D%20dX%5E2%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B%5Cpartial%5E2F%7D%7B%5Cpartial%20Y%5E2%7D%20dY%5E2%20+%20%5Cfrac%7B%5Cpartial%5E2F%7D%7B%5Cpartial%20X%20%5Cpartial%20Y%7D%20dXdY%20+%20%5Cdots%20%5Ctag%7B1%7D"></span></p>
<p>Now, we can calculate all these partial derivatives and plugged them back in the above equation. <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20X%7D%20=%20Y"> and <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%5E2%20F%7D%7B%5Cpartial%20X%5E2%7D%20=%200">.</p>
<p>Similarly <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20Y%7D%20=%20X"> and <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%5E2%20F%7D%7B%5Cpartial%20Y%5E2%7D%20=%200">.</p>
<p>Finally: <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%5E2F%7D%7B%5Cpartial%20X%20%5Cpartial%20Y%7D%20=%201"></p>
<p>Plugging it all back in Equation&nbsp;1: <span id="eq-product-rule"><img src="https://latex.codecogs.com/png.latex?dF%20=%20Y%20dX%20+%20X%20dY%20+%20dXdY%20%5Ctag%7B2%7D"></span></p>
</section>
<section id="integral-by-parts" class="level1">
<h1>Integral by parts</h1>
<p>In classical calculus, we re-use the product rule to come up with the integration by part: <img src="https://latex.codecogs.com/png.latex?d(xy)%20=%20xdy%20+%20ydx">. That is <img src="https://latex.codecogs.com/png.latex?xdy%20=%20d(xy)%20-%20ydx"> which we can integrate for and get: <img src="https://latex.codecogs.com/png.latex?%5Cint%20xdy%20=%20%5Cint%20d(xy)%20-%20%5Cint%20y%20dx"> which is the same as <img src="https://latex.codecogs.com/png.latex?%5Cint%20x%20dy%20=%20xy%20-%20%5Cint%20y%20dx">.</p>
<p>Let’s bring this to stochastic calculus. Again <img src="https://latex.codecogs.com/png.latex?F"> is a function of the product of 2 stochastic processes: <img src="https://latex.codecogs.com/png.latex?F%20=%20F(X,Y)%20=%20XY"> Using the same logic and our previous result Equation&nbsp;2, we write <img src="https://latex.codecogs.com/png.latex?d(XY)%20=%20Y%20dX%20+%20X%20dY%20+%20dXdY"> <img src="https://latex.codecogs.com/png.latex?X%20dY%20=%20d(XY)%20-%20Y%20dX%20-%20dXdY%20"> <img src="https://latex.codecogs.com/png.latex?%5Cint_0%5Et%20X_s%20dY_s%20=%20%5Cint_0%5Et%20d(X_sY_s)%20-%20%5Cint_0%5Et%20Y_s%20dX_s%20-%20%5Cint_0%5Et%20dX_sdY_s"> <img src="https://latex.codecogs.com/png.latex?%5Cint_0%5Et%20X_s%20dY_s%20=%20X_tY_t%20-%20X_0Y_0%20-%20%5Cint_0%5Et%20Y_s%20dX_s%20-%20%5Cint_o%5Et%20dX_sdY_s"></p>
</section>
<section id="quotient-rule-within-stochastic-calculus" class="level1">
<h1>Quotient Rule within Stochastic Calculus</h1>
<p>We will re-use the Taylor Series Expansion (Equation&nbsp;1) except this time the function <img src="https://latex.codecogs.com/png.latex?F"> is a function of the quotient of 2 stochastic processes: <img src="https://latex.codecogs.com/png.latex?F%20=%20F(X,%20Y)%20=%20%5Cfrac%7BX%7D%7BY%7D">. Calculating all the partial derivatives: <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20X%7D%20=%20%5Cfrac%7B1%7D%7BY%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%5E2%20F%7D%7B%5Cpartial%20X%5E2%7D%20=%200">.</p>
<p>Similarly <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%20F%7D%7B%5Cpartial%20Y%7D%20=%20%5Cfrac%7B-X%7D%7BY%5E2%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%5E2%20F%7D%7B%5Cpartial%20Y%5E2%7D%20=%20%5Cfrac%7B2X%7D%7BY%5E3%7D">.</p>
<p>Finally: <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%5E2F%7D%7B%5Cpartial%20X%20%5Cpartial%20Y%7D%20=%20%5Cfrac%7B-1%7D%7BY%5E2%7D"></p>
<p>Putting it all back together: <img src="https://latex.codecogs.com/png.latex?dF%20=%20%5Cfrac%7B1%7D%7BY%7D%20dX%20+%20%5Cfrac%7B-X%7D%7BY%5E2%7D%20dY%20+%20%5Cfrac%7B1%7D%7B2%7D%20%5Cfrac%7B2X%7D%7BY%5E3%7D%20dY%5E2+%20%5Cfrac%7B-1%7D%7BY%5E2%7D%20dXdY"> Which we can re-write as: <span id="eq-quotient-rule"><img src="https://latex.codecogs.com/png.latex?dF%20=%20d%20%5Cleft(%20%5Cfrac%7BX%7D%7BY%7D%20%5Cright)%20=%20%5Cfrac%7BX%7D%7BY%7D%20%5Ccdot%20%5Cleft(%20%5Cfrac%7B1%7D%7BX%7D%20dX%20-%20%5Cfrac%7B1%7D%7BY%7D%20dY%20-%20%5Cfrac%7B1%7D%7BXY%7D%20dXdY%20+%20%5Cfrac%7B1%7D%7BY%5E2%7D%20dY%5E2%5Cright)%20%5Ctag%7B3%7D"></span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
In the quant world.
</div>
</div>
<div class="callout-body-container callout-body">
<p>we can word these results in the following way - taken from <a href="https://fermatslastspreadsheet.com/2011/12/28/itos-product-and-quotient-rules-as-described-by-a-trader/">here</a>:</p>
<ul>
<li><strong>Itô product rule:</strong> we buy correlation when we have a product</li>
<li><strong>Itô quotient rule:</strong> we sell correlation when we have a ratio, and we are long vol of the denominator.</li>
</ul>
</div>
</div>


</section>

 ]]></description>
  <category>time-series</category>
  <guid>https://fderyckel.github.io/blog.html/posts/quant-part2/03-SDE-part3/index.html</guid>
  <pubDate>Sun, 02 Jul 2023 17:00:00 GMT</pubDate>
</item>
<item>
  <title>Quant Puzzle #01</title>
  <dc:creator>Francois de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/quant-puzzle-01/index.html</link>
  <description><![CDATA[ 




<p>This is attempt to start a series of puzzles for quant. The source for these puzzles is <a href="https://ntquant.substack.com/p/quant-puzzles-week-1-portfolio-theory">this noteworthy substack on quant finance</a></p>
<section id="puzzle-1" class="level1">
<h1>Puzzle 1</h1>
<blockquote class="blockquote">
<p>An investment strategy has an annualized expected return of 3% and an annualized volatility of 10%. Assume returns are normally distributed and independent from one year to the next. After how many years will the mean annualized returns of a portfolio be positive with at least 91.3% probability? What about the compounded returns?</p>
</blockquote>
<p>Our previous post on the <a href="../../posts/quant-part1/random-behavior-assets/index.html">random behavior of assets</a> is a good start.</p>
<p>To calculate the mean annualized returns, we will use <img src="https://latex.codecogs.com/png.latex?Ret%20=%20%5Cfrac%20%7B%5Csum_%7Bi=1%7D%5E%7Bn%7D%20R_i%7D%7Bn%7D"></p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?R_i"> is the annual return for the year i</li>
<li><img src="https://latex.codecogs.com/png.latex?n"> is the number of year.</li>
</ul>
<section id="solving-using-r" class="level2">
<h2 class="anchored" data-anchor-id="solving-using-r">Solving using R</h2>
<section id="using-the-mean-annualized-returns" class="level3">
<h3 class="anchored" data-anchor-id="using-the-mean-annualized-returns">Using the mean annualized returns</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mutate(), tibble(), if_else(), group_by(), summarize()</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pmap()</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># unnest()</span></span>
<span id="cb1-4"></span>
<span id="cb1-5">num_sim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a function to get yearly return (both average and compounded)</span></span>
<span id="cb1-8">create_simul_ret <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(mu, sigma, num_year) { </span>
<span id="cb1-9">  df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">year_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_year, </span>
<span id="cb1-10">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ret =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(num_year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> sigma)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ann_ret =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> ret, </span>
<span id="cb1-12">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cum_ret =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(ann_ret) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> year_num,           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function for mean annualized returns </span></span>
<span id="cb1-13">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">compounded_ret =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumprod</span>(ann_ret)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>year_num), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to get compounded returns</span></span>
<span id="cb1-14">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">posit_cum_ret =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(cum_ret <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), </span>
<span id="cb1-15">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">posit_comp_ret =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(compounded_ret <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb1-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(df)</span>
<span id="cb1-17">}</span>
<span id="cb1-18"></span>
<span id="cb1-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># To get all different random return numbers, I need to fetch the data from the row</span></span>
<span id="cb1-20"></span>
<span id="cb1-21">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sim_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_sim, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">num_year =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sim_ret =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(mu, sigma, num_year), create_simul_ret)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(sim_ret)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span>      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># large df with 30 rows/year per simulation</span></span>
<span id="cb1-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(year_num) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span>             <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># group by year to calculate average returns</span></span>
<span id="cb1-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avg_num_pos_ret =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(posit_cum_ret), </span>
<span id="cb1-26">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">avg_num_comp_pos_ret =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(posit_comp_ret))</span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">

<div id="nagbzeudmx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#nagbzeudmx table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#nagbzeudmx thead, #nagbzeudmx tbody, #nagbzeudmx tfoot, #nagbzeudmx tr, #nagbzeudmx td, #nagbzeudmx th {
  border-style: none;
}

#nagbzeudmx p {
  margin: 0;
  padding: 0;
}

#nagbzeudmx .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#nagbzeudmx .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#nagbzeudmx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#nagbzeudmx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#nagbzeudmx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nagbzeudmx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nagbzeudmx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nagbzeudmx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#nagbzeudmx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#nagbzeudmx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#nagbzeudmx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#nagbzeudmx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#nagbzeudmx .gt_spanner_row {
  border-bottom-style: hidden;
}

#nagbzeudmx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#nagbzeudmx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#nagbzeudmx .gt_from_md > :first-child {
  margin-top: 0;
}

#nagbzeudmx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#nagbzeudmx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#nagbzeudmx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#nagbzeudmx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#nagbzeudmx .gt_row_group_first td {
  border-top-width: 2px;
}

#nagbzeudmx .gt_row_group_first th {
  border-top-width: 2px;
}

#nagbzeudmx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nagbzeudmx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#nagbzeudmx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#nagbzeudmx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nagbzeudmx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nagbzeudmx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#nagbzeudmx .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#nagbzeudmx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#nagbzeudmx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nagbzeudmx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nagbzeudmx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nagbzeudmx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nagbzeudmx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nagbzeudmx .gt_left {
  text-align: left;
}

#nagbzeudmx .gt_center {
  text-align: center;
}

#nagbzeudmx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#nagbzeudmx .gt_font_normal {
  font-weight: normal;
}

#nagbzeudmx .gt_font_bold {
  font-weight: bold;
}

#nagbzeudmx .gt_font_italic {
  font-style: italic;
}

#nagbzeudmx .gt_super {
  font-size: 65%;
}

#nagbzeudmx .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#nagbzeudmx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#nagbzeudmx .gt_indent_1 {
  text-indent: 5px;
}

#nagbzeudmx .gt_indent_2 {
  text-indent: 10px;
}

#nagbzeudmx .gt_indent_3 {
  text-indent: 15px;
}

#nagbzeudmx .gt_indent_4 {
  text-indent: 20px;
}

#nagbzeudmx .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="year_num">year_num</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_num_pos_ret">avg_num_pos_ret</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_num_comp_pos_ret">avg_num_comp_pos_ret</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="year_num" class="gt_row gt_right">1</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.6091</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.6091</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">2</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.6605</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.6475</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">3</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.6962</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.6759</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">4</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.7210</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.6948</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">5</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.7429</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.7126</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">6</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.7660</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.7332</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">7</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.7830</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.7481</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">8</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.7982</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.7581</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">9</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.8114</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.7733</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">10</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.8254</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.7828</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">11</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.8374</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.7974</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">12</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.8489</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.8077</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">13</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.8613</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.8188</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">14</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.8680</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.8257</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">15</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.8742</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.8334</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">16</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.8803</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.8410</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">17</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.8896</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.8484</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">18</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.8950</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.8540</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">19</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.8990</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.8601</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">20</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.9083</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.8662</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right" style="background-color: rgba(128,188,216,0.8); color: #000000; font-weight: normal;">21</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right" style="background-color: rgba(128,188,216,0.8); color: #000000; font-weight: normal;">0.9109</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right" style="background-color: rgba(128,188,216,0.8); color: #000000; font-weight: normal;">0.8700</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">22</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.9156</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.8758</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">23</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.9201</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.8809</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">24</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.9295</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.8872</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">25</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.9325</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.8939</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">26</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.9355</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.8997</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">27</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.9400</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.9036</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">28</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.9431</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.9062</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right">29</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right">0.9447</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right">0.9110</td></tr>
    <tr><td headers="year_num" class="gt_row gt_right" style="background-color: rgba(128,188,216,0.8); color: #000000; font-weight: normal;">30</td>
<td headers="avg_num_pos_ret" class="gt_row gt_right" style="background-color: rgba(128,188,216,0.8); color: #000000; font-weight: normal;">0.9464</td>
<td headers="avg_num_comp_pos_ret" class="gt_row gt_right" style="background-color: rgba(128,188,216,0.8); color: #000000; font-weight: normal;">0.9136</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</section>
</section>
<section id="solving-using-python" class="level2">
<h2 class="anchored" data-anchor-id="solving-using-python">Solving Using Python</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> random</span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Computes a moving average from a gaussian sample over n trials</span></span>
<span id="cb2-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> gauss_moving_average(mu,sigma,n):</span>
<span id="cb2-4">    moving_average_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb2-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n):</span>
<span id="cb2-6">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb2-7">            moving_average_list.append(random.gauss(mu,sigma))</span>
<span id="cb2-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span>:</span>
<span id="cb2-9">            moving_average_list.append((moving_average_list[i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>random.gauss(mu,sigma))<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb2-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> moving_average_list</span>
<span id="cb2-11"></span>
<span id="cb2-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Outputs a list of guassian moving average time series</span></span>
<span id="cb2-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> run_sims(mu, sigma, n, years):</span>
<span id="cb2-14">    sims <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb2-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n):</span>
<span id="cb2-16">        sims.append(gauss_moving_average(mu,sigma,years))</span>
<span id="cb2-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> sims</span>
<span id="cb2-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Outputs the percentage of positive entries in a column of a matrix</span></span>
<span id="cb2-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> percent_positive_column(matrix,column):</span>
<span id="cb2-20">    n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(matrix)</span>
<span id="cb2-21">    percent_positive <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb2-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n):</span>
<span id="cb2-23">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> matrix[i][column] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb2-24">            percent_positive<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>n) </span>
<span id="cb2-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> percent_positive<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb2-26"></span>
<span id="cb2-27"></span>
<span id="cb2-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Runs the simulation and checks for our confidence level</span></span>
<span id="cb2-29">matrix <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> run_sims(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb2-30"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>):</span>
<span id="cb2-31">    conf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> percent_positive_column(matrix, i)</span>
<span id="cb2-32">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(conf)</span>
<span id="cb2-33">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span>  conf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">91.3</span>:</span>
<span id="cb2-34">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Year"</span>,i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"has positive returns with probability"</span>, conf)</span>
<span id="cb2-35">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">break</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>61.93999999998159
66.66699999996007
70.11999999994435
72.92899999993158
75.1649999999214
77.24099999991195
79.06299999990367
80.68199999989629
81.95799999989049
83.17599999988494
84.27499999987994
85.2739999998754
86.20499999987116
87.1399999998669
87.92999999986331
88.63799999986009
89.30399999985706
90.13199999985329
90.65399999985091
91.18599999984849
91.68499999984621
Year 21 has positive returns with probability 91.68499999984621</code></pre>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>R-code</category>
  <category>quant-finance</category>
  <guid>https://fderyckel.github.io/blog.html/posts/quant-puzzle-01/index.html</guid>
  <pubDate>Mon, 12 Jun 2023 17:00:00 GMT</pubDate>
</item>
<item>
  <title>Naive-Bayes - Part 1</title>
  <dc:creator>Francois de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/machine-learning-part1/naives-bayes-intro/index.html</link>
  <description><![CDATA[ 




<p>Some very basic ML using Naive-Bayes and the tidymodel framework.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mutate(), row_number()</span></span>
<span id="cb1-3"></span>
<span id="cb1-4">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'../../../raw_data/financial_news.csv'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sentiment'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'text'</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sentiment =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(sentiment))</span></code></pre></div>
</div>
<p>Using the tidyverse, we’ll</p>
<ul>
<li>split the df into a training and testing set.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rsample)    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial_split(), training(), testing()</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(recipes)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(parsnip)    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># naive_bayes(), set_engine()</span></span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(workflows)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># workflow()</span></span>
<span id="cb2-5"></span>
<span id="cb2-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(discrim)</span>
<span id="cb2-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(textrecipes)</span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(yardstick)</span>
<span id="cb2-9"></span>
<span id="cb2-10">list_splits <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">initial_split</span>(df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prop =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strata =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sentiment'</span>)</span>
<span id="cb2-11">df_train <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">training</span>(list_splits)</span>
<span id="cb2-12">df_test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">testing</span>(list_splits)</span>
<span id="cb2-13"></span>
<span id="cb2-14">list_recipe <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">recipe</span>(sentiment <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_train) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_tokenize</span>(text) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_stopwords</span>(text) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_tokenfilter</span>(text, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max_tokens =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_tfidf</span>(text)</span>
<span id="cb2-19">  </span>
<span id="cb2-20"></span>
<span id="cb2-21">mod_nb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">naive_Bayes</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_engine</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'naivebayes'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_mode</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'classification'</span>)</span>
<span id="cb2-22">mod_svm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">svm_poly</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_engine</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'kernlab'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_mode</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'classification'</span>)</span>
<span id="cb2-23">list_cv <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vfold_cv</span>(df_train, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strata =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sentiment'</span>)</span>
<span id="cb2-24"></span>
<span id="cb2-25">wf_nb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">workflow</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_recipe</span>(list_recipe) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_model</span>(mod_nb)</span>
<span id="cb2-26">wf_nb</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: naive_Bayes()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_tokenize()
• step_stopwords()
• step_tokenfilter()
• step_tfidf()

── Model ───────────────────────────────────────────────────────────────────────
Naive Bayes Model Specification (classification)

Computational engine: naivebayes </code></pre>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">wf_svm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">workflow</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_recipe</span>(list_recipe) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_model</span>(mod_svm)</span>
<span id="cb4-2"></span>
<span id="cb4-3">fit_mod_nb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fit</span>(wf_nb, df_train)</span>
<span id="cb4-4">pred_mod_nb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fit_mod_nb, df_test)</span>
<span id="cb4-5">pred_mod_nb_prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fit_mod_nb, df_test, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'prob'</span>)</span>
<span id="cb4-6"></span>
<span id="cb4-7">fit_mod_svm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fit</span>(wf_svm, df_train)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Setting default kernel parameters  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">pred_mod_svm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fit_mod_svm, df_test)</span>
<span id="cb6-2">pred_mod_svm_prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(fit_mod_svm, df_test, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'prob'</span>)</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_cols</span>(df_test, pred_mod_nb) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">conf_mat</span>(sentiment, .pred_class)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction negative neutral positive
  negative       65      55       81
  neutral        53     509      168
  positive        3      12       24</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_cols</span>(df_test, pred_mod_svm) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">conf_mat</span>(sentiment, .pred_class)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction negative neutral positive
  negative       31       6       17
  neutral        71     526      181
  positive       19      44       75</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#roc_nb &lt;- bind_cols(df_test, pred_mod_nb_prob) |&gt; roc_curve()</span></span></code></pre></div>
</div>



 ]]></description>
  <category>ML</category>
  <category>Naive-Bayes</category>
  <category>sentiment analysis</category>
  <guid>https://fderyckel.github.io/blog.html/posts/machine-learning-part1/naives-bayes-intro/index.html</guid>
  <pubDate>Mon, 15 May 2023 17:00:00 GMT</pubDate>
</item>
<item>
  <title>02 - Normality of asset returns</title>
  <dc:creator>Francois de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/quant-part1/normality-returns/index.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>As mentioned in one of our <a href="../../../posts/quant-part1/random-behavior-assets/index.html">previous posts</a>, we know that in quantitative finance, assets returns are assumed to be random. That being said, they are actually not normally distributed. This post digg in a bit further in assessing the normality (or non-normality) of equity returns.</p>
<p>As reminder, a dataset can be said to be normally distributed if its probability density function can be modeled by <img src="https://latex.codecogs.com/png.latex?P(X%20=%20x)%20=%20%5Cfrac%7B1%7D%7B%5Csigma%20%5Csqrt%7B2%20%5Cpi%7D%7D%20%5Ccdot%20e%5E%7B-%5Cfrac%7B(x-%5Cmu)%5E2%7D%7B2%20%5Csigma%5E2%7D%7D"></p>
<p>When testing for normality, there are many ways to get there.</p>
<ul>
<li>Visual ways: histogram, density plot and QQ-plots<br>
</li>
<li>Using Skewness or Kurtosis</li>
<li>Statistical tests such as the Shapiro-Wilk test (small to medium sample size, <img src="https://latex.codecogs.com/png.latex?n%20%5Cleq%20300">) or the Kolmogorov-Smirnov test</li>
</ul>
<p>Let’s start by considering an ETF (low-ish volatility) like the SPY500.<br>
To better illustrate our point and for comparative purposes, we’ll also consider a fictitious stock with the same standard deviation and mean returns as the SPY500 but this time, with random and almost perfectly normally distributed returns.</p>
<p>From previous post, returns can be explained with a drift rate + some randomness: <img src="https://latex.codecogs.com/png.latex?R_i%20=%20%5Cmu%20%5Cdelta%20t%20+%20%5Cphi%20%5Csigma%20%5Cdelta%20t%5E%7B1/2%7D"></p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5Cphi"> is a random number taken from the standard normal distribution.</li>
</ul>
</section>
<section id="comparing-spy-returns-with-a-similar-imaginary-stock" class="level1">
<h1>Comparing SPY returns with a similar imaginary stock</h1>
<p>Let’s make some assumptions on how to get the drift rate and volatility of SPY. Using all the trading sessions since 01 Jan 2020, we’ll use the mean historical returns and standard deviation of returns as drift and volatility.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">df_spy <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'../../../raw_data/SPY.csv'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(date, adjClose) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">return =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(adjClose <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lag</span>(adjClose))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2020-01-01'</span>)</span>
<span id="cb1-6"></span>
<span id="cb1-7">drift <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(df_spy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>return) </span>
<span id="cb1-8">sigma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(df_spy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>return) </span></code></pre></div>
</div>
<p>So over the last 3-ish years, SPY had an annualized drift rate of 9.04% with an volatility of 24.4%. We multiplied the drift rate by 252 and the standard deviation by the square root of time (252).</p>
<p>Let’s consider now an imaginary stock with a similar drift rate and standard deviation as SPY.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21042023</span>)</span>
<span id="cb2-2">phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(df_spy), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create randomness from a normal distribution</span></span>
<span id="cb2-3">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(phi),            </span>
<span id="cb2-4">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> phi, </span>
<span id="cb2-5">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">return =</span> drift <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> phi)    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create the return as drift + randomness </span></span>
<span id="cb2-6"></span>
<span id="cb2-7">prices <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb2-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(df))) {</span>
<span id="cb2-9">  prices[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> prices[i<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>return[i])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#create a vector of prices based on the returns</span></span>
<span id="cb2-10">}</span>
<span id="cb2-11"></span>
<span id="cb2-12">df_dummy <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_column</span>(df, prices)</span></code></pre></div>
</div>
<p>Let’s have a quick check that indeed mean and standard deviation of returns are similar.</p>
<table class="table">
<caption>Summary of first 2 moments for both assets</caption>
<thead>
<tr class="header">
<th></th>
<th>Drift</th>
<th>Volatility</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SPY</td>
<td>3.6^{-4}</td>
<td>0.0152</td>
</tr>
<tr class="even">
<td>Fictitious Asset</td>
<td>7.3^{-4}</td>
<td>0.0154</td>
</tr>
</tbody>
</table>
<p>Let’s have a look at our fictious stock price.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df_dummy, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> prices)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Imaginary Stock'</span>, </span>
<span id="cb3-4">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Same drift as volatility as SPY'</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part1/normality-returns/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df_spy, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> adjClose)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'SPY'</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part1/normality-returns/index_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="visual-checks-on-imaginary-stock-vs-spy" class="level1">
<h1>Visual checks on imaginary stock vs SPY</h1>
<p>Usual visual checks for normality are:</p>
<ul>
<li>the histogram</li>
<li>the QQ-plot.</li>
</ul>
<section id="histograms" class="level2">
<h2 class="anchored" data-anchor-id="histograms">Histograms</h2>
<p>Let’s see how well the returns stack to our imaginary stock (with close to perfect pseudo-randomness)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df_dummy, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(return)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">after_stat</span>(density)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fun =</span> dnorm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(df), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">args =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> drift, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> sigma), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.055</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.055</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n.breaks =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part1/normality-returns/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The black line is the actual density of returns, while the red line is the density of the normal distribution with same drift and volatility as earlier. Lines are pretty close to each other.</p>
<p>And now onto the histogram on SPY (again same drift and volatility) as fictitious stock above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df_spy, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(return)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">after_stat</span>(density)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> drift<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>sigma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> drift<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>sigma),  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fun =</span> dnorm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(df), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">args =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> drift, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> sigma), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.055</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.055</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n.breaks =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part1/normality-returns/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And here, we clearly see the big disconnect from normality: above expected number of returns at the mean (aka too peaked), less returns next to the mean (between 1 and 2 or 2 1/2 sd) and then higher number of observations than expected in the tails (aka fat tails). Distribution of returns for equity are interesting in that sense: both too peaked and fat tails.</p>
</section>
<section id="qq-plots" class="level2">
<h2 class="anchored" data-anchor-id="qq-plots">QQ Plots</h2>
<p>Another way to visually check for normality is to use a quantile-quantile plot (aka QQ-plot). On the y-axis, we have the returns, on the x-axis the theoretical quantiles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df_dummy, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sample =</span> return)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_qq</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_qq_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'QQ-Plot for fictious stock returns'</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part1/normality-returns/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And now the QQ-plot for the returs of SPY.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df_spy, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sample =</span> return)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_qq</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_qq_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'QQ-Plot for SPY returns'</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part1/normality-returns/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Oh boy! Again, our second plot clearly indicate how the returns deviate from normality.</p>
<p>This QQ-plot can also be used to check for asymetry in the distribution of returns. We can see a slightly left skew distribution (a negatively skew distribution).</p>
</section>
</section>
<section id="skewness-and-kurtosis" class="level1">
<h1>Skewness and Kurtosis</h1>
<p>Skewness and Kurtosis are the third and fourth <a href="../../../posts/time-series/02-statistical-moments/index.html">statistical moments</a> of a distribution.</p>
<section id="skewness" class="level2">
<h2 class="anchored" data-anchor-id="skewness">Skewness</h2>
<p>Ideally, skewness as a measure of symmetry should be close to 0 (perfectly symmetric).</p>
<p>Let’s test the symmetry of our 2 sets of returns. Unfortunately, we did not find any function to calculate skewness in base R (seems strange!).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">moments<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">skewness</span>(df_dummy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>return)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0398789</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">moments<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">skewness</span>(df_spy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>return)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.7418496</code></pre>
</div>
</div>
<p>As expected, our fictitious stock has almost 0 skew (symmetric around the mean), while the SPY has a moderate negative skew (which we could see already on the QQ-plot and histogram.)</p>
</section>
<section id="kurtosis" class="level2">
<h2 class="anchored" data-anchor-id="kurtosis">Kurtosis</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">moments<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kurtosis</span>(df_dummy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>return)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.879684</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">moments<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kurtosis</span>(df_spy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>return)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12.75883</code></pre>
</div>
</div>
<p>Again, our fictitious asset has kurtosis pretty close to perfect normality (almost 3). SPY deviate very much from normality and displays leptokurotic kurtosis.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In <a href="../../../posts/time-series/02-statistical-moments/index.html">this post</a> on the statistical moments, we have showed a couple of transformation methods (log transform and Box-Cox transform) to normalize data.</p>
</div>
</div>
</section>
</section>
<section id="statistical-tests" class="level1">
<h1>Statistical tests</h1>
<section id="shapiro-wilk-test" class="level2">
<h2 class="anchored" data-anchor-id="shapiro-wilk-test">Shapiro-Wilk test</h2>
<p>Shapiro-Wilk test should actually not be used on large data set. Although, we use it here for demonstration purposes, results should be interpreted with a big spoon of salt.</p>
<p>Let’s specify our hypothesis:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?H_0">: the data follows a normal distribution</li>
<li><img src="https://latex.codecogs.com/png.latex?H_1">: the data does not follow a normal distribution</li>
</ul>
<p>Let’s first test on our fictitious equity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">shapiro.test</span>(df_dummy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>return)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  df_dummy$return
W = 0.99895, p-value = 0.9215</code></pre>
</div>
</div>
<p>Expected, as the randomness of our fictitious stock was randomly distributed.</p>
<p>And then on the return of SPY</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">shapiro.test</span>(df_spy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>return)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  df_spy$return
W = 0.894, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="jarque-bera-test" class="level2">
<h2 class="anchored" data-anchor-id="jarque-bera-test">Jarque-Bera test</h2>
<p>The Jarque-Bera test is a statistical test used to assess whether a sample of data follows a normal distribution. It is a goodness-of-fit test that compares the skewness and kurtosis of the sample data to the skewness and kurtosis of a normal distribution. The test statistic follows a chi-squared distribution with 2 degrees of freedom under the null hypothesis that the data is normally distributed. So low p-values indicates that the data do not follow a normal distribution.</p>
<p>As oppose to the Shapiro-Wilk test, the Jarque Bera test can be apply to big data set.</p>
<p>Jarque Bera test is defined as <img src="https://latex.codecogs.com/png.latex?JB%20=%20%5Cfrac%7Bn%7D%7B6%7D%20%5Ccdot%20%5Cleft(%20S%5E2%20+%20%5Cfrac%7B(K-3)%5E2%7D%7B4%7D%20%5Cright)"></p>
<ul>
<li>S is the sample skewness</li>
<li>K is the sample kurtosis</li>
<li>n is the sample size</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">moments<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">jarque.test</span>(df_spy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>return)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Jarque-Bera Normality Test

data:  df_spy$return
JB = 3373.7, p-value &lt; 2.2e-16
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>As expected, we have a tiny p-value, hence we reject the <img src="https://latex.codecogs.com/png.latex?H_0"> that the data are normally distributed.</p>
<p>And now for our dummy normal returns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">moments<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">jarque.test</span>(df_dummy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>return)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Jarque-Bera Normality Test

data:  df_dummy$return
JB = 0.72149, p-value = 0.6972
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>p-value is above the 0.05 threshold, we do not reject the <img src="https://latex.codecogs.com/png.latex?H_0"> that data are normally distributed.</p>


</section>
</section>

 ]]></description>
  <category>Normal Distribution</category>
  <category>QQ-plot</category>
  <category>Kurtosis</category>
  <category>Skewness</category>
  <category>Histogram</category>
  <guid>https://fderyckel.github.io/blog.html/posts/quant-part1/normality-returns/index.html</guid>
  <pubDate>Tue, 18 Apr 2023 17:00:00 GMT</pubDate>
  <media:content url="https://fderyckel.github.io/blog.html/posts/quant-part1/normality-returns/qqplot-spy.png" medium="image" type="image/png" height="89" width="144"/>
</item>
<item>
  <title>01 - Random Behavior of Financial Assets</title>
  <dc:creator>Francois de Ryckel</dc:creator>
  <link>https://fderyckel.github.io/blog.html/posts/quant-part1/random-behavior-assets/index.html</link>
  <description><![CDATA[ 




<p>One of the main pillar of quantitative finance is the assumption that assets’ returns behave in a random manner. Assets returns are normally distributed. It is a poor assumption as asset’s return are usually not normally distributed (fat tails, skewness, etc.), but it is one that is considered when approaching finance with a quantitative finance. Check <a href="../../../posts/quant-part1/normality-returns/index.html">this post</a> on the normality of assets returns for a deeper dive into how random (or not) are assets returns.</p>
<section id="discrete-approach" class="level1">
<h1>Discrete approach</h1>
<p><span id="eq-ret1"><img src="https://latex.codecogs.com/png.latex?R_i%20=%20%5Cfrac%7BS_%7Bi+1%7D-S_i%7D%7BS_i%7D%20%5Ctag%7B1%7D"></span> <img src="https://latex.codecogs.com/png.latex?%5Cbar%7BR%7D%20=%20%5Cfrac%7B%5Csum_%7Bi=1%7D%5E%7Bn%7D%20R_i%7D%7Bn%7D"></p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?R_i"> = return of an asset at time i</li>
<li><img src="https://latex.codecogs.com/png.latex?S_i"> = price of an asset at time i</li>
</ul>
<p>If returns are normally distributed, we could re-write Equation&nbsp;1 as <span id="eq-ret2"><img src="https://latex.codecogs.com/png.latex?R_i%20=%20%5Cfrac%7BS_%7Bi+1%7D%20-%20S_i%7D%7BS_i%7D%20=%20%5Cbar%7BR%7D%20+%20std%20%5Ccdot%20%5Cphi%20%5Ctag%7B2%7D"></span></p>
<ul>
<li>Std of returns (std): <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7B%5Cfrac%7B1%7D%7Bn-1%7D%20%5Csum_%7Bi=1%7D%5E%7Bn%7D(R_i%20-%20%5Cbar%7BR%7D)%5E2%7D"></li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cphi"> is just a number taken from the normal distribution with mean = 0 and std = 1</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cphi%20=%20%5Cfrac%7B1%7D%7B%5Csqrt%7B2%20%5Cpi%7D%7D%20%5Ccdot%20e%5E%7B-%20%5Cfrac%7Bx%5E2%7D%7B2%7D%7D"></li>
</ul>
</section>
<section id="continuous-approach" class="level1">
<h1>Continuous approach</h1>
<p>Returns should scale with time.</p>
<p>Mean returns = <img src="https://latex.codecogs.com/png.latex?%5Cmu%20%5Ccdot%20%5Cdelta%20t"></p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5Cmu"> = Annualized means returns on a continuous basis (usually not known, or hard to know)</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cdelta%20t"> = a small time increment</li>
</ul>
<section id="ignoring-randomness" class="level2">
<h2 class="anchored" data-anchor-id="ignoring-randomness">Ignoring randomness</h2>
<p><img src="https://latex.codecogs.com/png.latex?R_i%20=%20%5Cfrac%7BS_%7Bi+1%7D%20-%20S_i%7D%7BS_i%7D%20=%20mean%20%20=%20%5Cmu%20%5Cdelta%20t"> <img src="https://latex.codecogs.com/png.latex?S_%7Bi+1%7D%20-%20S_i=%20S_i%20%5Cmu%20%5Cdelta%20t"> <span id="eq-asset-price1"><img src="https://latex.codecogs.com/png.latex?S_%7Bi+1%7D%20=%20S_i%20%5Ccdot%20(1%20+%20%20%5Cmu%20%5Cdelta%20t)%20%5Ctag%7B3%7D"></span></p>
<p>We could also rewrite Equation&nbsp;3 so it depends of the initial (starting) price, instead of the previous price.</p>
<p><img src="https://latex.codecogs.com/png.latex?S_n%20=%20S_0%20(1+%5Cmu%20%5Cdelta%20t)%5En"></p>
<p>Using natural log:</p>
<p><img src="https://latex.codecogs.com/png.latex?S_n%20=%20S_0%20e%5E%7Blog%20(1+%5Cmu%20%5Cdelta%20t)%5En%7D%20=%20S_0%20e%5E%7Bn%20%5Ccdot%20log%7B(1+%5Cmu%20%5Cdelta%20t)%7D%7D"></p>
<p>We could argue that <img src="https://latex.codecogs.com/png.latex?log(1+%5Cmu%20%5Cdelta%20t)%20%5Capprox%20%5Cmu%20%5Cdelta%20t"> as <img src="https://latex.codecogs.com/png.latex?log(1+x)%20%5Capprox%20x"> for small values of x.</p>
<p><span id="eq-asset-price2"><img src="https://latex.codecogs.com/png.latex?S_n%20%5Capprox%20S_0%20%5Ccdot%20e%5E%7Bn%20%5Cmu%20%5Cdelta%20t%7D%20%5Ctag%7B4%7D"></span></p>
<p>Now, <img src="https://latex.codecogs.com/png.latex?n%20%5Ccdot%20%5Cdelta%20t"> is the same as <img src="https://latex.codecogs.com/png.latex?t">. Hence,</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><img src="https://latex.codecogs.com/png.latex?S(t)%20%5Capprox%20S_0%20%5Ccdot%20e%5E%7B%5Cmu%20t%7D"></p>
</div>
</div>
</div>
</section>
<section id="considering-randomness" class="level2">
<h2 class="anchored" data-anchor-id="considering-randomness">Considering randomness</h2>
<p>Let’s restart with Equation&nbsp;2</p>
<p><img src="https://latex.codecogs.com/png.latex?R_i%20=%20%5Cfrac%7BS_%7Bi+1%7D%20-%20S_i%7D%7BS_i%7D%20=%20%5Cbar%7BR%7D%20+%20std%20%5Ccdot%20%5Cphi%20=%20%5Cmu%20%5Cdelta%20t%20+%20%5Csigma%20%5Cphi%20%5Cdelta%20t%5E%7B1/2%7D"> <span id="eq-asset-price2"><img src="https://latex.codecogs.com/png.latex?S_%7Bi+1%7D%20-%20S_i=%20S_i%20%5Cmu%20%5Cdelta%20t%20+%20S_i%20%5Csigma%20%5Cphi%20%5Cdelta%20t%5E%7B1/2%7D%20%5Ctag%7B5%7D"></span></p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><span id="eq-asset-price3"><img src="https://latex.codecogs.com/png.latex?S_%7Bi+1%7D%20=%20S_i%20%5Ccdot%20(1%20+%20%20%5Cmu%20%5Cdelta%20t%20+%20%20%5Csigma%20%5Cphi%20%5Csqrt%7B%5Cdelta%20t%7D)%20%5Ctag%7B6%7D"></span></p>
<p>This last Equation&nbsp;6 is the basis for Monte-Carlo simulation.</p>
<ul>
<li>Notice the standard deviation of return: <img src="https://latex.codecogs.com/png.latex?%5Csigma%20%5Csqrt%7B%5Cdelta%20t%7D"></li>
<li>unit of <img src="https://latex.codecogs.com/png.latex?%5Cmu%20=%20%5Cfrac%7B1%7D%7Bt%7D"></li>
<li>unit of <img src="https://latex.codecogs.com/png.latex?%5Csigma%20=%20%5Cfrac%7B1%7D%7B%5Csqrt%7Bt%7D%7D"></li>
<li>this is because we can only add variance together (no sd). For independent variable X and Y: <img src="https://latex.codecogs.com/png.latex?Var(X+Y)%20=%20Var(X)%20+%20Var(Y)"></li>
<li>the standard deviation of returns scale up with the square root of the time step.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="going-to-continuous-time" class="level2">
<h2 class="anchored" data-anchor-id="going-to-continuous-time">Going to continuous time</h2>
<p>Restarting from Equation&nbsp;5 : <img src="https://latex.codecogs.com/png.latex?S_%7Bi+1%7D%20-%20S_i=%20S_i%20%5Cmu%20%5Cdelta%20t%20+%20S_i%20%5Csigma%20%5Csqrt%7B%5Cdelta%20t%7D%20%5Cphi"></p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?S_%7Bi+1%7D%20-%20S_i%20=%20dS"></li>
<li><img src="https://latex.codecogs.com/png.latex?S_i%20=%20S(t)"></li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cdelta%20t%20=%20dt"></li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cphi%20%5Csqrt%7B%5Cdelta%20t%7D%20=%20dX"> where <img src="https://latex.codecogs.com/png.latex?dX"> is a random variable with mean = 0 and variance = dt. Hence <img src="https://latex.codecogs.com/png.latex?E%5BdX%5D%20=%200"> and <img src="https://latex.codecogs.com/png.latex?E%5B(dX)%5E2%5D%20=%20dt"></li>
</ul>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p><img src="https://latex.codecogs.com/png.latex?dS%20=%20S%20%5Cmu%20dt%20+%20S%20%5Csigma%20dX"> This stochastic differential equation on the change of prices assume:</p>
<ul>
<li>returns are treated as random</li>
<li>returns are assumed to be normally distributed (again not totally exact)</li>
<li>prices (S) are modelled as a log-normal walk (SDE)</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cmu"> is the drift rate or growth rate</li>
<li>because of the different scaling of time (<img src="https://latex.codecogs.com/png.latex?t"> and <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7Bt%7D">), on a short time frame, drift is negligible and volatility matters.</li>
</ul>
</div>
</div>
</div>
</section>
</section>
<section id="practice-in-r" class="level1">
<h1>Practice in R</h1>
<p>Let’s use the above notes with the ticker SBUX as a financial asset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readr)    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># read_csv()</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># select(), filter(), mutate()</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># drop_na()</span></span>
<span id="cb1-4"></span>
<span id="cb1-5">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'../../../raw_data/SBUX.csv'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(date, adjClose) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb1-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2019-07-01'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">drop_na</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ret =</span> (adjClose <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lag</span>(adjClose)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lag</span>(adjClose))</span>
<span id="cb1-9"></span>
<span id="cb1-10">r_bar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ret, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> T)</span>
<span id="cb1-11">stdev <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ret, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> T)</span>
<span id="cb1-12"></span>
<span id="cb1-13">delta_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">252</span></span>
<span id="cb1-14"></span>
<span id="cb1-15">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> r_bar <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> delta_t</span>
<span id="cb1-16">sigma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> stdev <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(delta_t)</span>
<span id="cb1-17"></span>
<span id="cb1-18">r_bar</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.073652e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">stdev</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02092624</code></pre>
</div>
</div>
<p>Knowing the average daily return of SBUX over the last 3-ish year and using <img src="https://latex.codecogs.com/png.latex?%5Cbar%7BR%7D%20=%20%5Cmu%20%5Cdelta%20t"> , or <img src="https://latex.codecogs.com/png.latex?%5Cmu%20=%20%5Cfrac%7B%5Cbar%7BR%7D%7D%7B%5Cdelta%20t%7D"> and in our case <img src="https://latex.codecogs.com/png.latex?%5Cdelta%20t%20=%20%5Cfrac%7B1%7D%7B252%7D">; we find the average annualized returns <img src="https://latex.codecogs.com/png.latex?%5Cmu"> is: -0.027 % with standard deviation <img src="https://latex.codecogs.com/png.latex?%5Csigma"> of 33.2 % annualized.</p>
<p>We could plot the returns and the std of returns</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">drop_na</span>(), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> ret)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> stdev, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'dotted'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>stdev, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'dotted'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>stdev, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'dotted'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>stdev, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'dotted'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Date'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Daily returns'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Daily returns'</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part1/random-behavior-assets/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We could standardized the returns (aka ensure they have a mean = 0 and std = 1) and compare it to the standard normal distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">df1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">std_ret =</span> (ret <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> r_bar) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> stdev) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">drop_na</span>()</span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df1, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(std_ret)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> ..density..), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stat_function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fun =</span> dnorm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">args =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n.breaks =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part1/random-behavior-assets/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This graph exemplifies what is very common with asset returns: fat tail, and under representation of returns just outside the mean. We discuss this further in our post: <a href="../../../posts/quant-part1/normality-returns/index.html">The normality of asset returns</a></p>
<section id="the-euler-maruyana-method-to-compute-the-sde" class="level2">
<h2 class="anchored" data-anchor-id="the-euler-maruyana-method-to-compute-the-sde">The Euler-Maruyana Method to compute the SDE</h2>
<p>We start with Equation&nbsp;6 : <img src="https://latex.codecogs.com/png.latex?S_%7Bi+1%7D%20=%20S_i%20%5Ccdot%20(1%20+%20%5Cmu%20%5Cdelta%20t%20+%20%5Csigma%20%5Cphi%20%5Csqrt%7B%5Cdelta%20t%7D)"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create one simulation for price </span></span>
<span id="cb7-2">ndays <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">252</span> </span>
<span id="cb7-3">price <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>()</span>
<span id="cb7-4">price[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">last</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>adjClose)</span>
<span id="cb7-5"></span>
<span id="cb7-6">phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(ndays, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb7-7"></span>
<span id="cb7-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>ndays){ </span>
<span id="cb7-9">  price[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> price[i<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> delta_t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> phi[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(delta_t))</span>
<span id="cb7-10">}</span>
<span id="cb7-11"></span>
<span id="cb7-12">yo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>ndays, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">price =</span> price)</span>
<span id="cb7-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(yo, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x, price)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part1/random-behavior-assets/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can now create 100’s such simulations re-using previous code in a function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">create_price_simul <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) {</span>
<span id="cb8-2">  price <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>() </span>
<span id="cb8-3">  price[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">last</span>(df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>adjClose) </span>
<span id="cb8-4">  phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(ndays, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) </span>
<span id="cb8-5">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>ndays){ </span>
<span id="cb8-6">    price[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> price[i<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> delta_t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> phi[i] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(delta_t)) </span>
<span id="cb8-7">    } </span>
<span id="cb8-8">  yo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>ndays, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">price =</span> price)</span>
<span id="cb8-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(yo)</span>
<span id="cb8-10">}</span>
<span id="cb8-11"></span>
<span id="cb8-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># map()</span></span>
<span id="cb8-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(RColorBrewer)</span>
<span id="cb8-14"></span>
<span id="cb8-15">num_of_simul <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb8-16">df1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">simul_num =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>num_of_simul) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb8-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prices =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(simul_num, create_price_simul))</span>
<span id="cb8-18"></span>
<span id="cb8-19">yo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(prices))</span>
<span id="cb8-20"></span>
<span id="cb8-21">getPalette <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brewer.pal</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>))</span>
<span id="cb8-22">colourCount <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> num_of_simul</span>
<span id="cb8-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(yo, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x, price, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> simul_num)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brewer.pal</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Accent"</span>))(colourCount)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> simul_num)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'none'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in brewer.pal(9, "Accent"): n too large, allowed maximum for palette Accent is 8
Returning the palette you asked for with that many colors</code></pre>
</div>
<div class="cell-output-display">
<p><img src="https://fderyckel.github.io/blog.html/posts/quant-part1/random-behavior-assets/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>R-code</category>
  <category>quant-finance</category>
  <guid>https://fderyckel.github.io/blog.html/posts/quant-part1/random-behavior-assets/index.html</guid>
  <pubDate>Mon, 17 Apr 2023 17:00:00 GMT</pubDate>
  <media:content url="https://fderyckel.github.io/blog.html/posts/quant-part1/random-behavior-assets/histogram-of-returns.png" medium="image" type="image/png" height="103" width="144"/>
</item>
</channel>
</rss>
